"use strict";class BaseScene extends Phaser.Scene{create(){console.log("BaseScene loaded"),this.scene.start("Preload")}baseCreate(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1.13;this.add.image(0,0,e).setScale(a).setOrigin(.02,0),this.cameras.main.fadeIn(600,0,0,0),this.input.keyboard.createCursorKeys(),gameConfig.targetingCursor=this.add.image(0,0,"targetingCursor").setDepth(500).setVisible(!1),gameState.turn=0,gameState.redrawPrice=1,gameState.endGameMenyExited=!1,gameState.playingCard=!1,gameState.skipIntro=!1,gameState.fightStarted=!1,gameState.drawPile=[],gameState.discardPile=[],gameState.currentCards=[],gameState.cardImages=[],gameState.summonedEnemies=[],gameState.infoBoxElements=[],gameState.actionTextObjects=[],gameState.redrawButtonObjects=[],gameState.healButtonTextObjects=[],gameState.usesTillDepletionElements=[],gameState.kamishimoUberAlles=0,gameState.chemicalWarfare=0,gameState.shogunsShellCounter=0,gameState.zaibatsuMax=0,gameState.steelToeCount=0,gameState.strengthBushido=0,gameState.lustForLifeCost=1,gameState.kirisuteGomen=!1,gameState.toxicFrets=!1,gameState.ashenEncore=!1,gameState.edoEruption=!1,gameState.gundanSeizai=!1,gameState.noFutureCondition=!1,gameConfig.cardsDealtSound=this.sound.add("cardsDealtSound"),gameConfig.victorySound=this.sound.add("victorySound"),gameConfig.buttonPressedSound=this.sound.add("buttonPressedSound"),gameConfig.attackSound=this.sound.add("attackSound"),gameConfig.powerUpSound=this.sound.add("powerUpSound"),gameConfig.healSound=this.sound.add("healSound"),gameConfig.thunder=this.sound.add("thundersound"),gameConfig.music=this.sound.add("bossTune"),gameConfig.coinSound=this.sound.add("coinSound"),gameConfig.keyboardSound=this.sound.add("keyboardSound"),gameState.extraCards.length&&gameState.bonusCards.push(gameState.extraCards.pop()),gameState.taunts2.length&&"Level1Fight1"!==t&&gameState.taunts.push(gameState.taunts2.pop()),gameState.taunts||(gameState.taunts=gameState.extraTaunts),gameState.permanentSlots&&gameState.permanentSlots.forEach((e=>{e.available=!0})),"1"===t.charAt(t.length-1)&&(gameState.player.health=gameState.player.healthMax)}resetPlayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:360,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:350;const n=gameState.player;n.sprite=this.add.image(t,a,"player").setScale(e).setFlipX(!1).setInteractive(),n.stance="Neutral",n.poison=0,n.stancePoints=0,n.numCards=5,n.numCardsBase=5,n.numCardsStance=0,n.manaBase=3,n.manaStance=0,n.manaCard=0,n.mana=3,n.manaMax=3,n.strengthMax=3,n.strength=0,n.strengthBase=0,n.strengthStance=0,n.strengthCard=0,n.strengthMax=15,n.armor=0,n.armorMax=15,n.armorBase=0,n.armorStance=0,n.armorCard=0,n.lifeStealBase=0,n.lifeStealThisTurn=0,n.lifeStealCounter=0,n.name=gameState.playerName?gameState.playerName:"Punk Rock Samurai"}saveGameState(e){try{const t={player:{healthMax:gameState.player.healthMax,health:gameState.player.health,manaMax:gameState.player.manaMax,gold:gameState.player.gold,name:gameState.player.name,playerNamename:gameState.player.playerName,strengthBase:gameState.player.strengthBase,armorBase:gameState.player.armorBase,manaBase:gameState.player.manaBase},difficulty:gameState.difficulty,playerName:gameState.playerName,version:gameState.version,score:gameState.score,savedScene:e,loadedGame:!0,deck:gameState.deck,bonusCards:gameState.bonusCards,extraCards:gameState.extraCards,latestDraw:gameState.latestDraw,permanents:gameState.permanents,steelToeCards:gameState.steelToeCards,zaibatsuCards:gameState.zaibatsuCards,bouncingSolesCards:gameState.bouncingSolesCards,lustForLifeCost:gameState.lustForLifeCost,activeChemicalWarfares:gameState.activeChemicalWarfares,punksNotDeadCard:gameState.punksNotDeadCard,permanentSlots:gameState.permanentSlots,bonusPermanentSlots:gameState.bonusPermanentSlots,lustForLifeCounter:gameState.lustForLifeCounter,enduringSpiritCounter:gameState.enduringSpiritCounter,taunts:gameState.taunts,taunts2:gameState.taunts2,ratTaunts:gameState.ratTaunts,extraTaunts:gameState.extraTaunts},a=JSON.stringify(t);localStorage.setItem("gameState",a),console.log("Game state saved successfully.")}catch(e){console.error("Failed to save the game state.",e)}}defineCardSlots(){gameState.slots=[{available:!0,x:480,y:930,index:0,angle:-12},{available:!0,x:595,y:900,index:1,angle:-8},{available:!0,x:710,y:880,index:2,angle:-4},{available:!0,x:825,y:870,index:3,angle:0},{available:!0,x:940,y:880,index:4,angle:4},{available:!0,x:1055,y:900,index:5,angle:8},{available:!0,x:1170,y:930,index:6,angle:12},{available:!0,x:1285,y:960,index:7,angle:16}]}definePermanentSlots(){gameState.permanentSlots=[{available:!0,x:75,y:75,index:0},{available:!0,x:170,y:75,index:1},{available:!0,x:265,y:75,index:2},{available:!0,x:360,y:75,index:3},{available:!0,x:455,y:75,index:4}]}addGoldCounter(){const e=this.add.image(1570,75,"goldCoin").setScale(.12).setDepth(220).setOrigin(.5).setInteractive();gameState.goldCounter=this.add.text(1570,76,gameState.player.gold,{fontSize:"70px",fill:"#000000"}).setDepth(221).setOrigin(.5);let t="";e.on("pointerover",(()=>{gameState.goldCard=this.add.image(825,450,"goldCard").setScale(.83).setDepth(220),this.input.keyboard.on("keydown",(function(e){t+=e.key,"showmethemoney"===t&&(console.log("showmethemoney"),gameState.player.gold=99,gameState.player.goldMax=99,gameState.goldCounter.setText(gameState.player.gold),"admin"!==gameState.playerName&&(gameState.playerName="Cheater"),"admin"!==gameState.player.name&&(gameState.player.name="Cheater"),t=""),t.length>30&&(t=t.substring(t.length-30))}))})),e.on("pointerout",(()=>{gameState.goldCard.destroy(),t="",this.input.keyboard.removeAllListeners("keydown")}))}describeCharacter(e){e.sprite.on("pointerover",(()=>{if(!(!gameConfig.targetingCursor.visible&&e.alive&&e.activeStatsDisplay))return;const t=e.armor<0?"more":"less",a=e.strength<0?"less":"more",n="".concat(e.name,"\n\n").concat(e.armor," armor: Take ").concat(Math.round(Math.abs(e.armor/20*100))," %\n")+"".concat(t," physical damage\n\nMax armor: Take 75 %\nless physical damage \n\n").concat(e.strength," Strength: Deal ")+"".concat(10*Math.abs(e.strength)," %\n").concat(a," physical damage\n\nMax strength: Deal 150 %\nmore physical ")+"damage\n\nPoison: ".concat(e.poison,"\nPoison change per turn: ").concat(e.poison>0?-1:0),o={x:e.sprite.x-e.width/2-100,y:490,z:30};e.descriptionText=new TextBox(this,n,o,{fontSize:"18px",fill:"#000000"},.9)})),e.sprite.on("pointerout",(function(){e.descriptionText&&e.descriptionText.destroy()}))}addStanceBar(e,t){e.stancePoints=0;let a=this.cameras.main.width/2;gameState.stanceBarHeight=30,gameState.stanceBarMargin=90,gameState.stanceBarStartX=a-300,gameState.stanceBarBackground=this.add.graphics(),gameState.stanceBarBackground.lineStyle(3,0,1),gameState.stanceBarBackground.strokeRect(gameState.stanceBarStartX,gameState.stanceBarMargin,600,gameState.stanceBarHeight).setDepth(20);for(let e=1;e<6;e++)gameState.stanceBarBackground.moveTo(gameState.stanceBarStartX+100*e,gameState.stanceBarMargin),gameState.stanceBarBackground.lineTo(gameState.stanceBarStartX+100*e,gameState.stanceBarMargin+30),gameState.stanceBarBackground.strokePath();gameState.stanceBar=this.add.graphics(),gameState.stanceBar.fillStyle(65280,1);let n={fontSize:"40px",fill:t,fontWeight:"bold"};gameState.stanceText=this.add.text(825,gameState.stanceBarMargin-45,"Stance: ".concat(gameState.player.stance),n).setOrigin(.5).setInteractive(),gameState.stanceText.on("pointerover",(()=>{console.log("Stance: ".concat(gameState.player.stance));gameState.stanceDescriptionText=this.add.text(825,gameState.stanceBarBackground.y+105,"Stance represents the balance between\nDiscipline and Freedom.\n\nPositive Discipline during your turn:\n+3 Strength\n\nPositive Discipline at the end of your turn:\n+3 Armor\n\nMax Discipline at the end of your turn:\n-1 card next turn\n\nPositive Freedom during your turn:\n+1 mana\n\nPositive Freedom at the end of your turn:\n50% chance of +1 card next turn\n50% chance of +1 mana next turn\n\nMax Freedom at the end of your turn:\n-2 Armor",{fontSize:"20px",fill:"#000000"}).setDepth(25).setOrigin(.5,0);const e=gameState.stanceDescriptionText.getBounds(),t=e.width+15,a=e.height+15,n=e.x-7.5,o=e.y-7.5;gameState.stanceTextBackground=this.add.graphics(),gameState.stanceTextBackground.fillStyle(16777215,1).setAlpha(.9).setDepth(24),gameState.stanceTextBackground.fillRoundedRect(n,o,t,a,7)})),gameState.stanceText.on("pointerout",(()=>{gameState.stanceTextBackground.destroy(),gameState.stanceDescriptionText.destroy()}))}extractLevelFightFromName(e){const t=/Level(\d+)Fight(\d+)/.exec(e);return t?{level:parseInt(t[1],10),fight:parseInt(t[2],10)}:{level:null,fight:null}}cardTweens(e,t,a){this.tweens.add({targets:e,scaleX:t,scaleY:t,duration:a,ease:"Cubic"},this)}animatePermanent(e){gameState.permanents.forEach((t=>{t.card.key!==e||t.card.isPermanentAnimated||this.tweens.add({targets:t.card.tokenSprite,scaleY:1.125*t.card.tokenSprite.scaleX,scaleX:1.125*t.card.tokenSprite.scaleY,duration:120,ease:"Cubic",yoyo:!0,onStart:()=>t.card.isPermanentAnimated=!0,onComplete:()=>t.card.isPermanentAnimated=!1},this)}))}clearBoard(){gameState.characters.forEach((e=>{e.sprite.destroy(),e.strengthAndArmorImage.destroy(),e.armorText.destroy(),e.strengthText.destroy(),e.strengthAndArmorImage.destroy(),e.healthBarBackground.destroy(),e.healthBarFrame.destroy(),e.healthBar.destroy(),e.healthBarText.destroy()}));[gameState.player.manaBarBackground,gameState.player.manaBarFrame,gameState.player.manaBar,gameState.player.manaBarText,gameState.drawPileImage,gameState.discardPileImage,gameState.drawPileText,gameState.discardPileText,gameState.stanceBar,gameState.stanceText,gameState.stanceBarBackground,gameState.endOfTurnButton,gameState.redrawButton,gameState.healButton,gameState.actionText].forEach((e=>{e&&e.destroy()}))}shuffleDeck(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}updateTextAndBackground(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:7,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.6;e.setText(a),e.setDepth(o+1);const s=e.getBounds(),i=s.width+10,l=s.height+10,m=s.x-5,d=s.y-5;t.clear(),t.fillStyle(16777215,1).setAlpha(r).setDepth(o),t.fillRoundedRect(m,d,i,l,n)}addTokensToDeck(){gameState.permanents.forEach((e=>{console.log(e.card.key),"ChemicalWarfare"===e.card.key&&(e.tokenSlot&&(e.tokenSlot.available=!0),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.card.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==tokenSprite)),gameState.chemicalWarfare=0)}));[...gameState.drawPile,...gameState.discardPile,...gameState.currentCards].forEach((e=>{const t=gameConfig.tokenCardNames.find((t=>t.key===e.key)),a=gameState.deck.some((t=>t.key===e.key));if(t&&!a){let e=new Card(t);gameState.deck.push(e)}}))}restorePermanents(e){gameState.permanentSlots.forEach((e=>e.available=!0)),gameState.permanents.forEach((t=>{if(gameState.permanentSlots.some((e=>e.available))){const a=t.card;gameConfig.tokenCardNames.some((e=>e.key===a.key))||(console.log("Recreated permanent: ".concat(a.key,"\nfor slot ").concat(a.slot.index)),e(a))}else gameState.permanents=gameState.permanents.filter((e=>e!=t))}))}updatePermanentSlots(){const e=gameState.permanentSlots;let t=e.filter((e=>e.singleFight)).length;for(e.forEach((e=>e.singleFight=!1));t>0;){const a=e.pop();a.available=!0,gameState.bonusPermanentSlots.unshift(a),t--}}addHealButton(e,t){const a=" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold");gameState.endOfTurnButton=new Button(e,"Heal",t,900,130,8),gameState.endOfTurnButton.setPointerText(a).disable(),gameState.buttons.push(gameState.endOfTurnButton)}delay(e){return new Promise((t=>setTimeout(t,e)))}removeCardFromDeck(e,t){gameState[e]=gameState[e].filter((e=>e.key!==t))}camelCaseToTitle(e){return e.replace(/([A-Z])/g," $1").trim().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ")}adjustForDifficulty(e,t,a){return"Easy"===gameState.difficulty?e:"Medium"===gameState.difficulty?t:"HARDCORE"===gameState.difficulty?a:void 0}loadAssetWithRetry(e,t,a,n){console.log("loadAssetWithRetry called!"),a>=n?console.error("Failed to load asset: ".concat(e.key," after ").concat(n," attempts.")):("image"===t?this.load.image(e.key,e.path):"audio"===t&&this.load.audio(e.key,e.path),this.load.once("filecomplete-".concat(t,"-").concat(e.key),(()=>{console.log("".concat(e.key," loaded successfully."))})),this.load.once("loaderror",(o=>{o.key===e.key&&(console.warn("Loading error for asset: ".concat(e.key,". Attemt: ").concat(a," Retrying...")),this.loadAssetWithRetry(e,t,a+1,n))})),0===a&&this.load.start())}}let gameState={};const gameConfig={};gameState.version="1.3.16",gameConfig.levels=["Level1Fight1","Level1Fight2","Level1Fight3","Level2Fight1","Level2Fight2","Level2Fight3","Level3Fight1","Level3Fight2","Level3Fight3","Level4Fight1","Level4Fight2","Level4Fight3","Endscene"],gameConfig.preLevelsScenes=["BaseScene","Preload","Mainmenu"];const FadeOutBehavior={fadeOutTarget(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},this)}};try{console.log("%cWelcome to Punk Rock Samurai v".concat(gameState.version),"color: red; font-size: 26px; font-weight: bold; background-color: lightgray"),console.log("%cConsole log in on during beta testing","color: red; font-size: 16px; font-weight: bold; background-color: lightgray")}catch(e){console.log("Welcome to Punk Rock Samurai v".concat(gameState.version)),console.log("Logging will me on during beta testing")}class Preload extends BaseScene{constructor(){super("Preload")}preload(){WebFont.load({custom:{families:["Rock Kapak"]},active:()=>{this.fontLoaded=!0}});const e=this.cameras.main.width,t=this.cameras.main.height,a=e/2,n=t/2,o=this.add.graphics(),r=this.add.graphics();o.fillStyle(2236962,.8),o.fillRect(e/2-240,405,480,75);const s=this.add.text(a,n-75,"Loading...",{font:"30px monospace",fill:"#ffffff"}).setOrigin(.5,.5),i=this.add.text(a,n-7.5,"0%",{font:"27px monospace",fill:"#ffffff"}).setOrigin(.5,.5),l=this.add.text(a,n+45,"",{font:"24px monospace",fill:"#ffffff"}).setOrigin(.5,.5);this.load.on("progress",(function(t){i.setText(parseInt(100*t)+"%"),r.clear(),r.fillStyle(16777215,1),r.fillRect(e/2-225,420,450*t,45)})),this.load.on("fileprogress",(function(e){l.setText("Loading: "+e.key)})),this.load.on("complete",(function(){r.destroy(),o.destroy(),s.destroy(),i.destroy(),l.destroy()}));const m=[{key:"knuckleFist",path:"../assets/images/cards/knuckleFist.jpg",loaded:!1},{key:"kabutu",path:"../assets/images/cards/kabutu.jpg",loaded:!1},{key:"combatBoots",path:"../assets/images/cards/combatBoots.jpg",loaded:!1},{key:"tantoBlade",path:"../assets/images/cards/tantoBlade.jpg",loaded:!1},{key:"discontent",path:"../assets/images/cards/discontent.jpg",loaded:!1},{key:"soulSquatter",path:"../assets/images/cards/soulSquatter.jpg",loaded:!1},{key:"soulSquatterToken",path:"../assets/images/tokens/soulSquatterToken.png",loaded:!1},{key:"punksNotDead",path:"../assets/images/cards/punksNotDead.jpg",loaded:!1},{key:"punksNotDeadToken",path:"../assets/images/tokens/punksNotDeadToken.png",loaded:!1},{key:"lustForLife",path:"../assets/images/cards/lustForLife.jpg",loaded:!1},{key:"lustForLifeToken",path:"../assets/images/tokens/lustForLifeToken.png",loaded:!1},{key:"gundanSeizai",path:"../assets/images/cards/gundanSeizai.jpg",loaded:!1},{key:"gundanSeizaiToken",path:"../assets/images/tokens/gundanSeizaiToken.png",loaded:!1},{key:"deadTokugawas",path:"../assets/images/cards/deadTokugawas.jpg",loaded:!1},{key:"deadTokugawasToken",path:"../assets/images/tokens/deadTokugawasToken.png",loaded:!1},{key:"toxicFrets",path:"../assets/images/cards/toxicFrets.jpg",loaded:!1},{key:"toxicFretsToken",path:"../assets/images/tokens/toxicFretsToken.png",loaded:!1},{key:"ashenEncore",path:"../assets/images/cards/ashenEncore.jpg",loaded:!1},{key:"ashenEncoreToken",path:"../assets/images/tokens/ashenEncoreToken.png",loaded:!1},{key:"edoEruption",path:"../assets/images/cards/edoEruption.jpg",loaded:!1},{key:"edoEruptionToken",path:"../assets/images/tokens/edoEruptionToken.png",loaded:!1},{key:"steelToe",path:"../assets/images/cards/steelToe.jpg",loaded:!1},{key:"steelToe2",path:"../assets/images/cards/steelToe2.jpg",loaded:!1},{key:"steelToeToken",path:"../assets/images/tokens/steelToeToken.png",loaded:!1},{key:"foreverTrue",path:"../assets/images/cards/foreverTrue.jpg",loaded:!1},{key:"foreverTrueToken",path:"../assets/images/tokens/foreverTrueToken.png",loaded:!1},{key:"rebelSpirit",path:"../assets/images/cards/rebelSpirit.jpg",loaded:!1},{key:"rebelSpiritToken",path:"../assets/images/tokens/rebelSpiritToken.png",loaded:!1},{key:"rebelHeart",path:"../assets/images/cards/rebelHeart.jpg",loaded:!1},{key:"rebelHeartToken",path:"../assets/images/tokens/rebelHeartToken.png",loaded:!1},{key:"bushido",path:"../assets/images/cards/bushido.jpg",loaded:!1},{key:"bushidoToken",path:"../assets/images/tokens/bushidoToken.png",loaded:!1},{key:"toxicAvenger",path:"../assets/images/cards/toxicAvenger.jpg",loaded:!1},{key:"toxicAvengerToken",path:"../assets/images/tokens/toxicAvengerToken.png",loaded:!1},{key:"kirisuteGomen",path:"../assets/images/cards/kirisuteGomen.jpg",loaded:!1},{key:"kirisuteGomenToken",path:"../assets/images/tokens/kirisuteGomenToken.png",loaded:!1},{key:"hollidayInKamakura",path:"../assets/images/cards/hollidayInKamakura.jpg",loaded:!1},{key:"hollidayInKamakuraToken",path:"../assets/images/tokens/hollidayInKamakuraToken.png",loaded:!1},{key:"kamishimoUberAlles",path:"../assets/images/cards/kamishimoUberAlles.jpg",loaded:!1},{key:"kamishimoUberAllesToken",path:"../assets/images/tokens/kamishimoUberAllesToken.png",loaded:!1},{key:"bouncingSoles",path:"../assets/images/cards/bouncingSoles.jpg",loaded:!1},{key:"bouncingSoles2",path:"../assets/images/cards/bouncingSoles2.jpg",loaded:!1},{key:"bouncingSoles3",path:"../assets/images/cards/bouncingSoles3.jpg",loaded:!1},{key:"bouncingSoles4",path:"../assets/images/cards/bouncingSoles4.jpg",loaded:!1},{key:"bouncingSolesToken",path:"../assets/images/tokens/bouncingSolesToken.png",loaded:!1},{key:"enduringSpirit",path:"../assets/images/cards/enduringSpirit.jpg",loaded:!1},{key:"enduringSpiritToken",path:"../assets/images/tokens/enduringSpiritToken.png",loaded:!1},{key:"shogunsShell",path:"../assets/images/cards/shogunsShell.jpg",loaded:!1},{key:"shogunsShellToken",path:"../assets/images/tokens/shogunsShellToken.png",loaded:!1},{key:"chemicalWarfare",path:"../assets/images/cards/chemicalWarfare.jpg",loaded:!1},{key:"chemicalWarfareToken",path:"../assets/images/tokens/chemicalWarfareToken.png",loaded:!1},{key:"zaibatsuU",path:"../assets/images/cards/zaibatsuUnderground.jpg",loaded:!1},{key:"zaibatsuUndergroundToken",path:"../assets/images/tokens/zaibatsuUndergroundToken.png",loaded:!1},{key:"chintaiShunyu",path:"../assets/images/cards/chintaiShunyu.jpg",loaded:!1},{key:"chintaiShunyuToken",path:"../assets/images/tokens/chintaiShunyuToken.png",loaded:!1},{key:"stageInvasion",path:"../assets/images/cards/stageInvasion.jpg",loaded:!1},{key:"stageInvasionToken",path:"../assets/images/tokens/stageInvasionToken.png",loaded:!1},{key:"laidoSoho",path:"../assets/images/cards/laidoSoho.jpg",loaded:!1},{key:"laidoSohoToken",path:"../assets/images/tokens/laidoSohoToken.png",loaded:!1},{key:"bgLoadingScreen",path:"../assets/images/backgrounds/bgLoadingScreen.jpg",loaded:!1},{key:"shop1",path:"../assets/images/backgrounds/shop1.jpg",loaded:!1},{key:"goldCard",path:"../assets/images/ui/goldCard.jpg",loaded:!1},{key:"goldCoin",path:"../assets/images/ui/goldCoin.png",loaded:!1},{key:"listbox1",path:"../assets/images/ui/listbox1.png",loaded:!1},{key:"rectangularButton",path:"../assets/images/ui/stoneButtonInsetReady.png",loaded:!1},{key:"rectangularButtonHovered",path:"../assets/images/ui/stoneButtonInsetHovered.png",loaded:!1},{key:"rectangularButtonPressed",path:"../assets/images/ui/stoneButtonInsetPressed.png",loaded:!1}],d=[{key:"titleTheme",path:"../assets/sounds/music/TitleTheme.mp3",loaded:!1},{key:"bossTune",path:"../assets/sounds/music/DecisiveBattle.mp3",loaded:!1},{key:"thundersound",path:"../assets/sounds/thundersound.mp3",loaded:!1},{key:"attackSound",path:"../assets/sounds/attacksound.wav",loaded:!1},{key:"powerUpSound",path:"../assets/sounds/powerupsound.wav",loaded:!1},{key:"healSound",path:"../assets/sounds/healsound.wav",loaded:!1},{key:"victorySound",path:"../assets/sounds/victorysound.mp3",loaded:!1},{key:"keyboardSound",path:"../assets/sounds/keyboardsound.mp3",loaded:!1},{key:"coinSound",path:"../assets/sounds/coinsound.mp3",loaded:!1},{key:"cardsDealtSound",path:"../assets/sounds/cardsdealt.wav",loaded:!1},{key:"buttonPressedSound",path:"../assets/sounds/buttonpressed.wav",loaded:!1},{key:"gunShotSound",path:"../assets/sounds/gunshot.mp3",loaded:!1}];gameState.restartGame||(m.forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)})),d.forEach((e=>{this.loadAssetWithRetry(e,"audio",1,200)})))}create(){self=this,this.input.keyboard.createCursorKeys(),gameConfig.thunder=this.sound.add("thundersound"),gameConfig.musicTheme=this.sound.add("titleTheme"),gameConfig.buttonPressedSound=this.sound.add("buttonPressedSound"),gameState.score={numberOfTurns:0,levelsCompleted:0,damageTaken:0,damageDealt:0,totaleScore:0},gameConfig.tokenCardNames=[{key:"chemicalWarfare",type:"permanent",cost:2,turnsToDepletion:3,token:"chemicalWarfareToken"},{key:"kamishimoUberAlles",type:"permanent",cost:1,token:"kamishimoUberAllesToken"},{key:"hollidayInKamakura",type:"permanent",cost:0,token:"hollidayInKamakuraToken",specialDepletion:!0},{key:"chintaiShunyu",type:"permanent",cost:1,token:"chintaiShunyuToken"},{key:"stageInvasion",type:"permanent",cost:2,token:"stageInvasionToken"},{key:"laidoSoho",type:"permanent",cost:1,token:"laidoSohoToken"}],gameConfig.debuffCards={infestation:{name:"infestation",cost:1},hellFire:{name:"Hell Fire",cost:1},rooted:{name:"Rooted",cost:2},monstrosity:{name:"Monstrosity",cost:0}},gameConfig.strengthBaseCards=["seppuku","boneShredder"],gameConfig.minDeckSize=10,gameConfig.maxDeckSize=40,gameConfig.maxCardExemplars=2,gameState.latestDraw=[],gameState.permanents=[],gameState.activeChemicalWarfares=[],gameState.lustForLifeCounter=0,gameState.enduringSpiritCounter=0,gameState.punksNotDeadCard=null,gameState.bonusPermanentSlots=[{available:!0,x:75,y:180,index:5},{available:!0,x:170,y:180,index:6},{available:!0,x:265,y:180,index:7},{available:!0,x:360,y:180,index:8},{available:!0,x:455,y:180,index:9}],gameState.taunts=[{key:1,enemy:"A punk rock samurai?\nWhat's next?\nA disco knight?",player:"What's next, is me\nusing your bones\nas my drumsticks!"},{key:2,enemy:"A Samurai punk rocker?\nIs this some kind of joke?",player:"The only joke here will be\nyour attempt to survive!"},{key:3,enemy:"You must be lost, samurai boy.\nThe cosplay convention is\ndown the street.",player:"The only thing lost today\nwill be your head\nfrom your shoulders!"},{key:5,enemy:"Nice samurai outfit, punk!\nWhen does the\ncostume party begin?",player:"The only party you'll\nbe attending today\nis your own funeral!"},{key:6,enemy:"A Samurai punk rocker?\nHow's that midlife\ncrisis going for you?",player:"The only crisis happening\ntoday is for the janitor\nwho has to clean up\nwhat's left of you."},{key:7,enemy:"Samurai and punk rocker?\nSchizophrenia's a bitch, huh?",player:"The only bitch here is\nthe one whose about to\nbe begging me for mercy!"},{key:8,enemy:"What's with the big sword?\nCompensating for something?",player:"The only things small here\nare your chances of survival!"},{key:9,enemy:"Nice clown costume.\nDo you do childrens\nbirthdays and\nbar mitzvahs?",player:"Just funerals.\nYours is next\non the list!"},{key:10,enemy:"A samurai in the 21st century?\nI want whatever your smoking!",player:"Soon enough, the\nonly thing you'll be\nwanting, is mercy!"}],gameState.taunts2=[{key:11,enemy:"What's with the flex?\ndid they run out\nof shirts your size?",player:"I'm saving my shirt\nfor your funeral wake!"},{key:12,enemy:"What's with the flex?\nAre you here to fight\nor to pose for\nGay Times?",player:"The only posing happening\ntoday, will be for your\npost-mortem photography!"}],gameState.ratTaunts=[{key:201,enemy:"Hsss..\nYou'll make a fine\nmeal for my pups!",player:"Tell them not to wait up.\nDaddy's not comming home tonight!"},{key:202,enemy:"Hsss..\nYou come here to fight\nor to display your\nHalloween costume?",player:"The only thing on\ndisplay today\nwill be your entrails!"}],gameState.extraTaunts=[{key:101,enemy:"You really believe\nyou're a samurai, huh?",player:"You believe in ghosts?\nBecause you're\nabout to become one!"},{key:103,enemy:"Must be hard, living\na deluded fantasy.",player:"Not as hard as what's\ncoming for you!"},{key:104,enemy:"Punk and Samurai?\nTwo failures in one!",player:"I'll silence that laughter\nwith the sound of\nyour gurgling blood!"},{key:106,enemy:"You're a relic in a world that's moved on.",player:"You won't be moving much soon!"},{key:107,enemy:"Is that sword real,\nor are you just cosplaying hard?",player:"It's as real as the pain\nyou're about to experience!"},{key:108,enemy:"Hey, Samurai punk,\nthe circus called,\nthey want their clown back",player:"Sorry, I'm booked up\nmopping your entrails\noff the floor!"},{key:109,enemy:"Still holding onto\npunk's corpse, I see",player:"The only corpse here\nwill be the one\nI leave behind!"},{key:110,enemy:"Your delusions of grandeur\nare quite entertaining.",player:"The only entertainment tonight\nwill be your cries of agony!"},{key:111,enemy:"I've seen better costumes\nat a kid's party.",player:"And I've seen better\nfighters in a retirement home!"},{key:112,enemy:"That haircut's\na cry for help.",player:"The only one crying\nfor help will be you!"},{key:16,enemy:"What's with the\nsilly haircut,\nsamurai wannabe?",player:"Not as silly as your\nentrails will look\nsprawled all over the ground!"},{key:15,enemy:"You take this Samurai gig\npretty seriously, huh??",player:"As serious as the grave\nyou're about to fill!"},{key:17,enemy:"Whats with the outfit?\nYou look like you\nraided a costume store",player:"And you look like\nsomeone whose about to\nhave a very bad day!"},{key:14,enemy:"Trying to be a samurai\nor just lost a bet?",player:"The only thing worth\nbetting on today is\nwhich part of you\nhits the ground first!"},{key:4,enemy:"You look like a kid who\nfound his grandpa's armor.",player:"And you'll look like\nyour grandpa's corpse\nwhen I'm done here!"},{key:18,enemy:"You look like an\nantagonist from a bad\nMad Max movie",player:"And you look like\nthe first stunt\nto get taken out!"}];(()=>{function e(){if(self.screenClicked)return;self.screenClicked=!0,gameConfig.thunder.play({volume:.8,seek:.25}),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),self.cameras.main.shake(200,.002,!1),self.cameras.main.flash(100),self.time.delayedCall(100,(()=>{self.cameras.main.fadeOut(100)}),[],this),self.time.delayedCall(300,(()=>{self.scene.launch("LoadLazy"),self.scene.launch("Buttons")}),[],this)}gameState.restartGame?this.scene.start("Buttons"):(this.add.image(800,510,"bgLoadingScreen").setScale(1.25).setInteractive(),this.add.text(825,895,"Press to start",{fontSize:"90px",fill:"#9e2d20",fontWeight:"bold"}).setOrigin(.5),this.input.keyboard.on("keydown",(()=>e())),this.input.on("pointerup",(()=>e())))})()}}class LoadLazy extends BaseScene{constructor(){super("LoadLazy")}create(){[{key:"circlePit",path:"assets/images/cards/circlePit.jpg",loaded:!1},{key:"seppuku",path:"assets/images/cards/seppuku.jpg",loaded:!1},{key:"katana",path:"assets/images/cards/katana.jpg",loaded:!1},{key:"rocknRonin",path:"assets/images/cards/rocknRonin.jpg",loaded:!1},{key:"powerChord",path:"assets/images/cards/powerChord.jpg",loaded:!1},{key:"rawEnergy",path:"assets/images/cards/rawEnergy.jpg",loaded:!1},{key:"pyromania",path:"assets/images/cards/pyromania.jpg",loaded:!1},{key:"studdedLeather",path:"assets/images/cards/studdedLeather.jpg",loaded:!1},{key:"boneShredder",path:"assets/images/cards/boneShredder.jpg",loaded:!1},{key:"blackFumes",path:"assets/images/cards/blackFumes.jpg",loaded:!1},{key:"masakari",path:"assets/images/cards/masakari.jpg",loaded:!1},{key:"dogsOfWar",path:"assets/images/cards/dogsOfWar.jpg",loaded:!1},{key:"roninsRot",path:"assets/images/cards/roninsRot.jpg",loaded:!1},{key:"libertySpikes",path:"assets/images/cards/libertySpikes.jpg",loaded:!1},{key:"moshpitMassacre",path:"assets/images/cards/moshpitMassacre.jpg",loaded:!1},{key:"bladesBlight",path:"assets/images/cards/bladesBlight.jpg",loaded:!1},{key:"scorchedSoul",path:"assets/images/cards/scorchedSoul.jpg",loaded:!1},{key:"risingWakizashi",path:"assets/images/cards/risingWakizashi.jpg",loaded:!1},{key:"deadCities",path:"assets/images/cards/deadCities.jpg",loaded:!1},{key:"nastyNihonto",path:"assets/images/cards/nastyNihonto.jpg",loaded:!1},{key:"crowdSurfer",path:"assets/images/cards/crowdSurfer.jpg",loaded:!1},{key:"shogunShred",path:"assets/images/cards/shogunShred.jpg",loaded:!1},{key:"rocknRejuvinate",path:"assets/images/cards/rocknRejuvinate.jpg",loaded:!1},{key:"detox",path:"assets/images/cards/detox.jpg",loaded:!1},{key:"dBeat",path:"assets/images/cards/dBeat.jpg",loaded:!1},{key:"shikoroStrike",path:"assets/images/cards/shikoroStrike.jpg",loaded:!1},{key:"rottenResonance",path:"assets/images/cards/rottenResonance.jpg",loaded:!1},{key:"troopsOfTakamori",path:"assets/images/cards/troopsOfTakamori.jpg",loaded:!1},{key:"bassSolo",path:"assets/images/cards/bassSolo.jpg",loaded:!1},{key:"zenZine",path:"assets/images/cards/zenZine.jpg",loaded:!1},{key:"kabutuOverdrive",path:"assets/images/cards/kabutuOverdrive.jpg",loaded:!1},{key:"nenguStyle",path:"assets/images/cards/nenguStyle.jpg",loaded:!1},{key:"canibalize",path:"assets/images/cards/canibalize.jpg",loaded:!1},{key:"bloodOath",path:"assets/images/cards/bloodOath.jpg",loaded:!1},{key:"roninMerc",path:"assets/images/cards/roninMerc.jpg",loaded:!1},{key:"pyroPunk",path:"assets/images/cards/pyroPunk.jpg",loaded:!1},{key:"pissDrunkBastards",path:"assets/images/cards/pissDrunkBastards.jpg",loaded:!1},{key:"gutterGeisha",path:"assets/images/cards/gutterGeisha.jpg",loaded:!1},{key:"noFuture",path:"assets/images/cards/noFuture.jpg",loaded:!1},{key:"coverCharge",path:"assets/images/cards/coverCharge.jpg",loaded:!1},{key:"wrathOfMoen",path:"assets/images/cards/wrathOfMoen.jpg",loaded:!1},{key:"saisenBlaster",path:"assets/images/cards/saisenBlaster.jpg",loaded:!1},{key:"riotRonin",path:"assets/images/cards/riotRonin.jpg",loaded:!1},{key:"rebelLife",path:"assets/images/cards/rebelLife.jpg",loaded:!1},{key:"satomiSubterfuge",path:"assets/images/cards/satomiSubterfuge.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",0,200)}))}}const sceneState={},menuButtons=[],willSkipMenu=!1;class Mainmenu extends Phaser.Scene{constructor(){super("Mainmenu")}async getTopScores(){try{const e=await fetch("https://www.dreamlo.com/lb/64c442f28f40bb8380e27ce7/json");if(!e.ok)throw new Error("Network response was not ok");let t=(await e.json()).dreamlo.leaderboard.entry||[];return t.length>1&&t.sort(((e,t)=>t.score-e.score)),t.slice(0,5)}catch(e){return console.error("Error fetching top scores:",e),[]}}preload(){this.load.image("player","../assets/images/sprites/punkrock.png"),this.load.image("deck","../assets/images/ui/cardback.jpg"),this.load.image("strengthAndArmor","../assets/images/ui/strengthAndArmor.png"),this.load.image("targetingCursor","../assets/images/ui/targetingCursor.png"),this.load.image("targetingCursorReady","../assets/images/ui/targetingCursorReady.png"),this.load.image("rectangularFrame","../assets/images/ui/stoneButtonFrame.png")}create(){const e=this,t=[];this.cameras.main.fadeIn(600,0,0,0),this.input.keyboard.createCursorKeys(),this.add.image(800,510,"bgLoadingScreen").setScale(1.25);this.add.text(23,8,"Punk Rock Samurai Beta v".concat(gameState.version),{fontSize:"17px",fill:"#ff0000"});const a={x:390,xSpan:1210,textOffsetX:45,textOffsetY:120,headlineOffsetY:45,radius:10};gameConfig.cardsDealtSound=this.sound.add("cardsDealtSound"),gameConfig.buttonPressedSound=this.sound.add("buttonPressedSound");let n=!1;gameState.isEnteringName=!1,sceneState.name="";const o={fontSize:"21px",fill:"#000000"},r={fontSize:"38px",fill:"#000000"},s=190,i=480,l=115;let m=0;console.log("Scene status:",e.scene.key,e.scene.isActive());const d=new Button(e,"New Game",(function(){if(k(),d.isPressed=!d.isPressed,!d.isPressed)return;menuButtons.filter((e=>e!==d)).forEach((e=>e.isPressed=!1)),gameState.name="Enter your name...";sceneState.nameText=e.add.text(630,475,gameState.name,{fontSize:"35px",fill:"#000000"}).setDepth(21),sceneState.formFrame=e.add.image(825,490,"rectangularFrame"),sceneState.formFrame.setScale(1.8,.9).setInteractive().setDepth(22),sceneState.nameForm=e.add.graphics({x:600,y:435}),sceneState.nameForm.fillStyle(16777215,1).setAlpha(.9).setInteractive().setDepth(20),sceneState.nameForm.fillRect(0,0,450,100),sceneState.nameForm.setInteractive(new Phaser.Geom.Rectangle(0,0,450,100),Phaser.Geom.Rectangle.Contains);const a=new Button(e,"Let's go!",f,825,600);a.setScale(1.8,.9).updateFont(42).activate(),t.push(sceneState.nameForm,sceneState.nameText,sceneState.formFrame,a),function(){const a={fontSize:"48px",fill:"#000000"};sceneState.formCursor=e.add.text(630,465,"|",a).setDepth(21).setAlpha(0),t.push(sceneState.formCursor),sceneState.cursorTween=e.tweens.add({targets:sceneState.formCursor,alpha:1,duration:300,hold:600,yoyo:!0,repeat:-1,paused:!0})}(),h(sceneState.nameForm),h(sceneState.formFrame)}),s,i+l*m++),g=new Button(e,"Load Game",(function(){if(k(),g.isPressed=!g.isPressed,!g.isPressed)return;menuButtons.filter((e=>e!==g)).forEach((e=>e.isPressed=!1));try{const t=localStorage.getItem("gameState");if(null===t)return void x();const a=JSON.parse(t);if(!function(e){if(e.version===gameState.version)return!0;const t="The game has been updated since this save was made (saved version: ".concat(e.version,", ")+"current version: ".concat(gameState.version,"). Loading this file might cause issues. Do you still want to load?");return confirm(t)}(a))return;[a.deck,a.bonusCards,a.extraCards,a.latestDraw].forEach((e=>function(e){e.forEach(((t,a)=>{const n=gameConfig.cardDefinitions.find((e=>e.key===t.key));(t.turnsToDepletion||t.usesTillDepletion||t.freePermanent)&&Object.assign(n,{turnsToDepletion:t.turnsToDepletion,usesTillDepletion:t.usesTillDepletion,freePermanent:t.freePermanent}),e[a]=new Card(n)}))}(e))),gameState=a,function(e){const t=new Player(e.name,e.healthMax,e.strengthBase,e.armorBase);t.gold=e.gold,t.playerName=e.playerName,t.manaMax=e.manaMax,t.manaBase=e.manaBase,t.health=e.health,gameState.player=t}(gameState.player),console.log("Game state loaded successfully."),e.scene.start(gameState.savedScene)}catch(e){console.error("Failed to load the game state.",e),x()}}),s,i+l*m++),c=new Button(e,"Leaderboard",(async function(){if(k(),c.isPressed=!c.isPressed,!c.isPressed)return;menuButtons.filter((e=>e!==c)).forEach((e=>e.isPressed=!1));const n=await e.getTopScores(),{x:s,xSpan:i,textOffsetX:l,textOffsetY:m,headlineOffsetY:d,radius:g}=a,u=400,S=e.add.graphics().fillRoundedRect(s,u,i,300,g);S.fillStyle(16777215,1).setAlpha(.9);const p=e.add.text(s+l,u+d,"Leaderboard",r).setOrigin(0);if(t.push(S,p),!n.length){const a="Failed to access leaderboard",n=e.add.text(s+l,u+m,a,o).setOrigin(0);return void t.push(n)}!function(a,n,r){a.forEach(((a,s)=>{const i=a.date.split(" ")[0],l="".concat(s+1,". Name: ").concat(a.name,", Score: ").concat(a.score,", Date: ").concat(i),m=e.add.text(n+45,r+120,l,o).setOrigin(0);t.push(m),r+=30}))}(n,s,u)}),s,i+l*m++),u=new Button(e,"Credits",(function(){if(k(),u.isPressed=!u.isPressed,!u.isPressed)return;menuButtons.filter((e=>e!==u)).forEach((e=>e.isPressed=!1));const{x:n,xSpan:s,textOffsetX:i,textOffsetY:l,headlineOffsetY:m,radius:d}=a,g=e.add.graphics().fillRoundedRect(n,350,s,400,d);g.fillStyle(16777215,1).setAlpha(.9);const c=e.add.text(n+i,350+m,"Credits",r).setOrigin(0),S=e.add.text(n+i,350+l,"Game Design and Programming by Erlend Kulander Kvitrud\nMusic by Marllon Silva (xDeviruchi) (https://soundcloud.com/xdeviruchi)\nPunch sound by @danielsoundsgood (https://danielsoundsgood.itch.io/)\nHealing sound by Dylan Kelk (https://freesound.org/people/SilverIllusionist/)\nPower up sound by MATRIXXX (https://freesound.org/people/MATRIXXX_/)\nGunshot sound by Fesliyan Studios (https://www.fesliyanstudios.com)\nButton Sprites by Ian Eborn (http://thaumaturge-art.com/)\nArmor and Strength symbols by Josepzin (https://opengameart.org/users/josepzin)\nCard sprites by Avery Ross (https://opengameart.org/users/averyre)\nCoin sound by ProjectsU012 (https://freesound.org/people/ProjectsU012/)\n",o);S.setLineSpacing(2.5),t.push(g,c,S)}),s,i+l*m++),S=new Button(e,"Instructions",(function(){if(k(),S.isPressed=!S.isPressed,!S.isPressed)return;menuButtons.filter((e=>e!==S)).forEach((e=>e.isPressed=!1));const{x:n,xSpan:s,textOffsetX:i,textOffsetY:l,headlineOffsetY:m,radius:d}=a,g=e.add.graphics().fillRoundedRect(n,30,s,960,d);g.fillStyle(16777215,1).setAlpha(.9);const c=e.add.text(n+i,30+m,"Instructions",r).setOrigin(0),u=e.add.text(n+i,30+l,'The game consists of four levels, each of which consists of three fights. At the start\nof each turn, you gain 3 mana and draw 5 cards. You may then play any number of cards\nbefore hitting "End Turn". Your remaining cards and mana are then depleted, and the\nenemy\'s turn begins. You win the fight by killing all enemies. Losing a fight results in\npermadeath. Missing health carries over from fight to fight\n\n'+"Decks consists of ".concat(gameConfig.minDeckSize," - ").concat(gameConfig.maxDeckSize," cards, and can include ")+"at most ".concat(gameConfig.maxCardExemplars," instances of the same card\n\n")+"Stance represents the balance between Discipline and Freedom.\n-Positive Discipline during your turn: +3 Strength.\n-Positive Discipline at the end of your turn: +3 Armor.\n-Max Discipline at the end of your turn: -1 card next turn.\n\n-Positive Freedom during your turn: +1 mana.\n-Positive Freedom at the end of your turn: 50/50 chance of +1 card or +1 mana next turn.\n-Max Freedom at the end of your turn:-2 Armor.\n\nPhysical damage is affected by Strength and Armor\n-Each unit of Strength increases outgoing physical damage by 10 %.\n-Each unit of Armor blocks 5 % of incomming physical damage\nArmor and Strength are both capped at 15 units.\n\nFire damage is unaffected by Strength and Armor, but otherwise acts like physical damage.\n\nPoison is unaffected by Strength and Armor. A poisoned character suffers damage at the\nstart of their turn equal to their poison counter. At the end of the turn, this counter\nis reduced by 1. Unlike physical and fire damage, poison cannot reduce a characters\nhealth below 1 HP.\n\nPermanents are cards that can only be played once, and are then removed from your deck.\nAfter use, they remain active and provide passive bonuses. A maximum of 4 permanents may\nbe active at any given time. Permanents can be depleted, which triggers powerful one-off\neffects and then removes them from the game. If there are no empty permanent slots\n, permanent cards may be played directly from hand for their depletion effects.\n\nGold is earned by defeating enemies, and may be spent in the shop, or on in-fight bonuses.\n\n",o);u.setLineSpacing(1.9).setDepth(21),t.push(g,c,u)}),s,i+l*m++);for(;menuButtons.length;)menuButtons.pop();function p(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function h(t){t.on("pointerup",(()=>{if(gameState.isEnteringName)return;gameState.isEnteringName=!0,"Enter your name..."===gameState.name&&(gameState.name=""),sceneState.formCursor.setAlpha(0),sceneState.cursorTween.resume();try{p()&&gameState.hiddenInput.focus()}catch(e){console.error("Onscreen keyboard failed to open",e),gameState.isEnteringName=!1,f()}e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER).once("down",(function(){gameState.isEnteringName=!1,f()})),e.time.delayedCall(200,(()=>(e.input.off("pointerup"),void e.input.once("pointerup",(()=>{if(!gameState.isEnteringName)return;let t=0;gameState.name||(gameState.name="Enter your name...",t=100),e.time.delayedCall(t,(()=>{gameState.isEnteringName=!1,console.log("isEnteringName has been deactivated")})),sceneState.formCursor.setAlpha(0),sceneState.cursorTween.pause(),function(){try{p()&&gameState.hiddenInput.blur()}catch(e){console.error("Onscreen keyboard failed to close",e),gameState.isEnteringName=!1,f()}}()})))))}))}function f(){gameState.isEnteringName=!1;const t="Enter your name..."!==gameState.name&&""!==gameState.name;gameState.playerName=t?gameState.name:"Punk Rock Samurai",k(),menuButtons.forEach((e=>e.disable().fadeOut(300))),e.time.delayedCall(200,(()=>function(){const t=825,a=480,n=150;let o=0;const r={x:t,y:225,z:201};sceneState.heading=new TextBox(e,"Select Difficulty",r);const s=new Button(e,"Easy",y,t,a+n*o++),i=new Button(e,"Medium",y,t,a+n*o++),l=new Button(e,"HARDCORE",y,t,a+n*o++);sceneState.difficultyButtons=[s,i,l],sceneState.difficultyButtons.forEach((e=>{e.setScale(1.5,1.05).activate().setHandlerArg(e.key).updateFont(35)}))}()))}async function y(t){gameState.difficulty=t,sceneState.heading.updateText("Difficulty Selected!");const a=sceneState.difficultyButtons.find((e=>e.key===t)),n=sceneState.difficultyButtons.filter((e=>e.key!==t));sceneState.difficultyButtons.forEach((e=>e.disable())),n.forEach((e=>e.fadeOut(300))),a.fadeOut(600),await T(700),function(){sceneState.heading.updateText("Choose one Free Permanent");const t=480,a=615,n=330;v(gameState.extraCards);const o=gameState.extraCards.slice(0,3);o.forEach(((r,s)=>{r.sprite=e.add.image(t+s*n,a,r.key).setScale(.67),r.activate(),r.sprite.on("pointerover",(()=>r.resize(e,.87,200))),r.sprite.on("pointerout",(()=>r.resize(e,.67,400))),r.sprite.on("pointerup",(()=>async function(t,a){gameConfig.cardsDealtSound.play({volume:1.2,seek:.12}),sceneState.heading.updateText("Permanent Selected"),t.freePermanent=!0,gameState.deck.push(t),gameState.extraCards.splice(gameState.extraCards.indexOf(t),1),v(gameState.extraCards),t.disable().center(e),a.filter((e=>e!==t)).forEach((t=>t.disable().fadeOut(e))),await T(100),e.time.delayedCall(2400,(()=>C())),e.input.on("pointerup",(()=>C())),e.input.keyboard.on("keydown",(()=>C()))}(r,o)))}))}()}function C(){n||(n=!0,e.cameras.main.fadeOut(1200),e.time.delayedCall(1200,(()=>{e.scene.start("Level1Fight1")})))}function x(){const a="No saved game state found.",n=e.add.text(930,525,a,{fontSize:"60px",fill:"#000000"}).setOrigin(.5).setDepth(21),o=n.getBounds(),r=o.width+15,s=o.height+15,i=o.x-15,l=o.y-7.5,m=e.add.graphics();m.fillStyle(16777215,1).setAlpha(.8).setDepth(20),m.fillRoundedRect(i,l,r,s,15),t.push(n,m),console.log(a),e.cameras.main.shake(70,.002,!1)}function k(){t.forEach((e=>{e&&"function"==typeof e.destroy?e.destroy():console.log("".concat(e," not phaser object"))}))}function T(e){return new Promise((t=>setTimeout(t,e)))}function v(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}menuButtons.push(d,g,c,u,S),menuButtons.forEach((e=>e.activate().setScale(1.28,.8).updateFont(35,"#000000"))),localStorage.getItem("gameState")||g.updateFont(30,"#a9a9a9"),p()&&(gameState.hiddenInput=document.createElement("input"),gameState.hiddenInput.style.position="absolute",gameState.hiddenInput.style.opacity="0",gameState.hiddenInput.style.zIndex="-1",document.body.appendChild(gameState.hiddenInput),gameState.hiddenInput.addEventListener("input",(function(e){gameState.name=e.target.value}))),function(t){if(!t)return;gameState.playerName="admin",gameState.player.name="PRS",gameState.difficulty="Medium";Math.floor(Math.random()*gameState.extraCards.length);const a=gameState.extraCards[0];a.freePermanent=!0,gameState.deck.push(a),gameState.extraCards.splice(gameState.extraCards.indexOf(a),1),e.scene.start("Level1Fight1")}(false),this.input.keyboard.on("keydown",(t=>{if(!gameState.isEnteringName)return;8===t.keyCode&&gameState.name.length>0?gameState.name=gameState.name.slice(0,-1):1===t.key.length&&t.key.match(/[a-zA-Z0-9\s\-_]/)&&gameState.name.length<18?gameState.name+=t.key:18===gameState.name.length&&e.cameras.main.shake(30,.001,!1)}))}update(){let e=0;gameState.isEnteringName&&menuButtons.find((e=>"New Game"===e.key)).isPressed&&(sceneState.nameText.setText(gameState.name),e=sceneState.nameText.width,sceneState.formCursor.x=sceneState.nameText.x+e-7)}onLoadingComplete(){console.log("Assets loaded, ready to start the game!")}}class Card{constructor(e){Object.assign(this,{cost:0,type:"",goldCost:0,stancePoints:0,damage:0,fire:0,poison:0,heal:0,poisonRemove:0,strength:0,armor:0,reduceTargetArmor:0,isActive:!1,reduceTargetStrength:0,drawCard:0,oneShot:!1,usedOneShot:!1,token:null,permanent:{},freePermanent:!1,reUseable:!1,isGoldResetable:!1,turnsToDepletion:-1,usesTillDepletion:-1,slot:{},angle:0,sprite:null,isBeingPlayed:!1,text:"",isPermanentAnimated:!1,hoverOver:!1},e)}getPropertyValue(e){return"function"==typeof this[e]?this[e]():this[e]}isPlayable(){const e=!this.goldCost||this.goldCost<=gameState.player.gold,t=gameState.player.mana>=this.costPlayed,a=!gameConfig.tokenCardNames.some((e=>e.key===this.key))||gameState.permanentSlots.some((e=>!0===e.available)),n=this.isActive&&!this.isBeingPlayed&&!this.usedOneShot&&gameState.playersTurn;return e&&t&&a&&n}isType(e){return this.type==e}configure(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sprite.setScale(e),null!==t&&this.sprite.setDepth(t),this}discard(){this.disable();return(()=>0===this.usesTillDepletion||this.isType("debuff")&&!this.reUseable)()||(gameState.discardPile.push(this),gameState.discardPileText.setText(gameState.discardPile.length)),this}activate(){return this.sprite?(this.isActive=!0,this.isBeingPlayed=!1,this.sprite.setInteractive(),this):this}disable(){return this.sprite&&this.isActive?(this.isActive=!1,this.isBeingPlayed=!1,this.sprite.removeInteractive(),this.hoverOver=!1,this):this}reset(){this.usedOneShot&&(this.usedOneShot=!1),this.isGoldResetable&&(this.goldCost=0),this.isType("debuff")&&(gameState.deck=gameState.deck.filter((e=>e.key!==this.key)))}resetOneShot(){return this.usedOneShot=!1,this}fadeOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return this.sprite?(e.tweens.add({targets:this.sprite,alpha:0,ease:"Power1",duration:t,onComplete:()=>{this.sprite.destroy(),this.hoverOver=!1}}),this):this}animateDraw(e,t){const a=this.slot;e.tweens.add({targets:this.sprite,x:a.x,y:a.y,scaleX:.47,scaleY:.47,angle:a.angle,duration:t,ease:"Circ.easeInOut",onComplete:()=>{a.available=!1}})}animatePointer(e,t){this.sprite.on("pointerover",(()=>{this.focusCardSprite(e)}),e),this.sprite.on("pointerout",(()=>{this.deFocusCardSprite(e,t)}),e)}focusCardSprite(e){this.hoverOver=!0,gameConfig.cardsDealtSound.play({volume:.6,seek:.08}),e.tweens.add({targets:this.sprite,y:740,angle:0,scaleX:.6,scaleY:.6,duration:300,ease:"Cubic"}),this.sprite.setDepth(100)}deFocusCardSprite(e,t){this.hoverOver=!1,this.isBeingPlayed||(e.tweens.add({targets:this.sprite,y:this.startHeight,angle:this.slot.angle,scaleX:.47,scaleY:.47,duration:300,ease:"Cubic"}),this.sprite.setDepth(t))}resize(e,t,a){this.isActive&&(gameConfig.cardsDealtSound.play({volume:.6,seek:.08}),e.tweens.add({targets:this.sprite,scaleX:t,scaleY:t,duration:a,ease:"Cubic"}))}center(e){return e.tweens.add({targets:this.sprite,x:e.cameras.main.centerX,y:e.cameras.main.centerY+100,scaleX:.85,scaleY:.85,duration:1200,ease:"Power2"}),this}}class Cards extends Phaser.Scene{constructor(){super("Cards")}create(){const e=[{key:"knuckleFist",type:"targetSelected",cost:1,stancePoints:1,damage:7,poison:()=>gameState.toxicFrets?1:0},{key:"knuckleFist",type:"targetSelected",cost:1,stancePoints:1,damage:7,poison:()=>gameState.toxicFrets?1:0},{key:"knuckleFist",type:"targetSelected",cost:1,stancePoints:1,damage:7,poison:()=>gameState.toxicFrets?1:0},{key:"knuckleFist",type:"targetSelected",cost:1,stancePoints:1,damage:7,poison:()=>gameState.toxicFrets?1:0},{key:"kabutu",type:()=>gameState.edoEruption&&gameState.player.stancePoints>0?"targetAll":"buff",cost:1,stancePoints:-1,armor:5},{key:"kabutu",type:()=>gameState.edoEruption&&gameState.player.stancePoints>0?"targetAll":"buff",cost:1,stancePoints:-1,armor:5},{key:"kabutu",type:()=>gameState.edoEruption&&gameState.player.stancePoints>0?"targetAll":"buff",cost:1,stancePoints:-1,armor:5},{key:"tantoBlade",type:"targetSelected",cost:2,damage:()=>gameState.player.stancePoints<0?12-2*gameState.player.stancePoints:12},{key:"combatBoots",type:"targetAll",cost:2,damage:5,reduceTargetArmor:()=>gameState.player.stancePoints>0?1+gameState.player.stancePoints:1},{key:"discontent",type:"buff",cost:1,stancePoints:()=>gameState.player.stancePoints<0?2:gameState.player.stancePoints>0?-2:0}],t=[{key:"rebelSpirit",type:"permanent",cost:1,token:"rebelSpiritToken"},{key:"foreverTrue",type:"permanent",cost:1,token:"foreverTrueToken"},{key:"toxicFrets",type:"permanent",cost:1,token:"toxicFretsToken"},{key:"ashenEncore",type:"permanent",cost:1,token:"ashenEncoreToken"},{key:"punksNotDead",type:"permanent",cost:1,token:"punksNotDeadToken"},{key:"toxicAvenger",type:"permanent",cost:1,token:"toxicAvengerToken"},{key:"bushido",type:"permanent",cost:1,token:"bushidoToken"},{key:"bouncingSoles",type:"permanent",cost:3,goldCost:3,token:"bouncingSolesToken"},{key:"shogunsShell",type:"permanent",cost:1,token:"shogunsShellToken"},{key:"steelToe",type:"permanent",cost:1,token:"steelToeToken"},{key:"edoEruption",type:"permanent",cost:1,token:"edoEruptionToken"},{key:"kamishimoUberAlles",type:"permanent",cost:1,token:"kamishimoUberAllesToken"},{key:"hollidayInKamakura",type:"permanent",cost:0,token:"hollidayInKamakuraToken",specialDepletion:!0},{key:"chemicalWarfare",type:"permanent",cost:2,turnsToDepletion:4,token:"chemicalWarfareToken"},{key:"zaibatsuU",type:"permanent",cost:1,token:"zaibatsuUndergroundToken"},{key:"laidoSoho",type:"permanent",cost:1,token:"laidoSohoToken"},{key:"stageInvasion",type:"permanent",cost:2,token:"stageInvasionToken"},{key:"studdedLeather",type:"buff",cost:1,stancePoints:2,armor:5},{key:"rocknRonin",type:"buff",cost:0,strength:()=>gameState.player.strength>0?gameState.player.strength:0},{key:"rawEnergy",type:"buff",cost:()=>gameState.player.stancePoints>0?-2:-1},{key:"powerChord",type:"buff",cost:1,stancePoints:()=>gameState.player.stancePoints<=0?1:0,drawCard:()=>gameState.player.stancePoints>0?3:0},{key:"crowdSurfer",type:"buff",cost:0,heal:()=>gameState.player.stancePoints<0?-2*gameState.player.stancePoints:0,drawCard:()=>gameState.player.stancePoints>0?gameState.player.stancePoints:0},{key:"rocknRejuvinate",type:"buff",cost:3,heal:10,poisonRemove:()=>gameState.player.stancePoints>0?3:0,armor:()=>gameState.player.stancePoints<0?3:0},{key:"detox",type:"buff",cost:2,heal:4,poisonRemove:4},{key:"dBeat",type:"buff",cost:2},{key:"shogunShred",type:"buff",cost:0,stancePoints:-1,drawCard:()=>gameState.player.stancePoints>0?1:0},{key:"bloodOath",type:"buff",cost:2,oneShot:!0,text:"Gains +1 mana this fight"},{key:"kabutuOverdrive",type:"buff",cost:2,stancePoints:-2,armor:10},{key:"nenguStyle",type:"buff",cost:2,oneShot:!0,text:"Gains 1 Gold"},{key:"zenZine",type:"buff",cost:()=>gameState.player.mana,oneShot:!0,usesTillDepletion:4},{key:"gutterGeisha",type:"buff",cost:1,stancePoints:-1,armor:()=>Math.floor(.1*(gameState.player.healthMax-gameState.player.health))},{key:"noFuture",type:"buff",cost:2,oneShot:!0,text:"Gains 5 Max Health"},{key:"coverCharge",type:"buff",cost:1,oneShot:!0},{key:"seppuku",type:"buff",cost:1,heal:()=>-Math.round(.05*gameState.player.healthMax),strength:()=>gameState.player.stancePoints<0?1-gameState.player.stancePoints:1},{key:"canibalize",type:"buff",cost:1},{key:"saisenBlaster",type:"buff",cost:1,goldCost:1,stancePoints:-2,armor:10},{key:"rebelLife",type:"buff",cost:0,stancePoints:1,heal:()=>gameState.player.stancePoints<0?3:0},{key:"satomiSubterfuge",type:"buff",cost:1,goldCost:0,isGoldResetable:!0},{key:"rottenResonance",type:"targetAll",cost:1,poison:1},{key:"pissDrunkBastards",type:"targetAll",cost:2,stancePoints:1},{key:"circlePit",type:"targetAll",cost:()=>gameState.player.mana},{key:"moshpitMassacre",type:"targetAll",cost:2,damage:8},{key:"blackFumes",type:()=>gameState.player.stancePoints>=0?"targetAll":"targetSelected",cost:2,poison:()=>gameState.player.stancePoints>0?3:gameState.player.stancePoints<0?5:0},{key:"bassSolo",type:"targetAll",cost:1,damage:5},{key:"boneShredder",type:"targetSelected",cost:1,strength:1,reduceTargetStrength:1,drawCard:()=>gameState.player.stancePoints>0?1:0},{key:"masakari",type:"targetSelected",cost:2,damage:()=>gameState.player.stancePoints<0?10*(1-gameState.player.stancePoints*gameState.player.strength/10):10},{key:"pyromania",type:"targetSelected",cost:2,fire:15},{key:"roninsRot",type:"targetSelected",cost:1,drawCard:()=>gameState.player.stancePoints>0?1:0},{key:"dogsOfWar",type:"targetSelected",cost:1,stancePoints:1,damage:9},{key:"libertySpikes",type:"targetSelected",cost:1,damage:5,armor:()=>gameState.player.stancePoints<0?2:0,drawCard:()=>gameState.player.stancePoints>0?1:0},{key:"bladesBlight",type:"targetSelected",cost:3},{key:"scorchedSoul",type:"targetSelected",cost:1,fire:7},{key:"katana",type:"targetSelected",cost:3,damage:()=>gameState.player.stancePoints<0?13*(1-gameState.player.stancePoints*gameState.player.strength/10):13},{key:"risingWakizashi",type:"targetSelected",cost:1,stancePoints:-1,damage:9},{key:"nastyNihonto",type:"targetSelected",cost:2,damage:10,poison:()=>gameState.player.stancePoints>0?2*gameState.player.stancePoints:0},{key:"shikoroStrike",type:"targetSelected",cost:1,damage:()=>gameState.player.stancePoints<0?8:0,reduceTargetArmor:()=>gameState.player.stancePoints>0?4:0},{key:"roninMerc",type:"targetSelected",cost:1,goldCost:1,damage:18},{key:"pyroPunk",type:"targetSelected",cost:1,fire:()=>Math.round(.15*(gameState.player.healthMax-gameState.player.health))},{key:"troopsOfTakamori",type:"targetSelected",cost:1,damage:7},{key:"wrathOfMoen",type:"targetSelected",cost:2,damage:24,oneShot:!0},{key:"riotRonin",type:"targetSelected",cost:2,goldCost:0,isGoldResetable:!0,text:"Target skips a turn"},{key:"deadCities",type:"targetSelected",cost:1,poison:3}],a=[{key:"enduringSpirit",type:"permanent",cost:1,token:"enduringSpiritToken"},{key:"lustForLife",type:"permanent",cost:1,token:"lustForLifeToken"},{key:"soulSquatter",type:"permanent",cost:1,token:"soulSquatterToken"},{key:"gundanSeizai",type:"permanent",cost:1,token:"gundanSeizaiToken"},{key:"rebelHeart",type:"permanent",cost:1,token:"rebelHeartToken"},{key:"kirisuteGomen",type:"permanent",cost:1,token:"kirisuteGomenToken"},{key:"deadTokugawas",type:"permanent",cost:1,token:"deadTokugawasToken"}],n=[{key:"bouncingSoles2",type:"permanent",cost:4,goldCost:4,token:"bouncingSolesToken"},{key:"bouncingSoles3",type:"permanent",cost:5,goldCost:5,token:"bouncingSolesToken"},{key:"bouncingSoles4",type:"permanent",cost:6,goldCost:6,token:"bouncingSolesToken"}],o=[{key:"steelToe2",type:"permanent",cost:1,goldCost:1,token:"steelToeToken"}],r=[{key:"chintaiShunyu",type:"permanent",cost:1,token:"chintaiShunyuToken"}];function s(e){return e.map((e=>new Card(e)))}gameState.deck=s(e),gameState.bonusCards=s(t),gameState.extraCards=s(a),gameState.bouncingSolesCards=s(n),gameState.steelToeCards=s(o),gameState.zaibatsuCards=s(r),gameConfig.cardDefinitions=[...e,...t,...a,...n,...o,...r],gameConfig.allCards=[...gameState.deck,...gameState.bonusCards,...gameState.extraCards,...gameState.bouncingSolesCards,...gameState.steelToeCards,...gameState.zaibatsuCards],console.log("Cards loaded"),this.scene.start("TextBoxes")}}class Character{constructor(e,t,a,n){this.name=e,this.sprite=null,this.alive=!0,this.actions=[],this.health=t,this.healthMax=t,this.strengthBase=a,this.strengthTurn=0,this.strengthMax=15,this.strength=Math.min(this.strengthMax,this.strengthBase+this.strengthTurn),this.armorBase=n,this.armorTurn=0,this.armorMax=15,this.armor=Math.min(this.armorMax,this.armorBase+this.armorTurn),this.poison=0,this.attackTweenStarted=!1,this.scene=null,this.activeStatsDisplay=!1}setScene(e){return this.scene=e,this}setSpriteAttributes(){if(this.sprite)return this.height=this.sprite.displayHeight,this.width=this.sprite.displayWidth,this.x=this.sprite.x,this.y=this.sprite.y,this}activateStatsDisplay(){this.activeStatsDisplay=!0,this.sprite.setInteractive()}disableStatsDisplay(){this.activeStatsDisplay=!1,this.sprite.removeInteractive()}addHealthBar(){const e=this.x-(this.name===gameState.playerName?45:0),t=this.y-this.height/2-45;this.healthBarBackground=this.scene.add.graphics(),this.healthBarBackground.fillStyle(16777215,.5),this.healthBarBackground.fillRect(e-60,t,150,15),this.healthBarBackground.setDepth(12),this.healthBarFrame=this.scene.add.graphics(),this.healthBarFrame.lineStyle(3,0,1),this.healthBarFrame.strokeRect(e-60,t,150,15),this.healthBarFrame.setDepth(13),this.healthBar=this.scene.add.graphics(),this.healthBar.fillStyle(this.healthBarColor,1),this.healthBar.fillRect(e-60,t,this.health/this.healthMax*150,15),this.healthBar.setDepth(14);const a=this.health>=100?-18:-30;return this.healthBarText=this.scene.add.text(e+a,t+8,"".concat(this.health,"/").concat(this.healthMax),{fontSize:"16px",fill:"#000000"}),this.healthBarText.setOrigin(.5).setDepth(15),this}addManaBar(){if(!this.mana)return this;this.height;const e=this.x-105,t=this.y-this.height/2-70;this.manaBarBackground=this.scene.add.graphics(),this.manaBarBackground.fillStyle(16777215,.5),this.manaBarBackground.fillRect(e,t,150,15),this.manaBarFrame=this.scene.add.graphics(),this.manaBarFrame.lineStyle(3,0,1),this.manaBarFrame.strokeRect(e,t,150,15),this.manaBar=this.scene.add.graphics(),this.manaBar.fillStyle(255,1),this.manaBar.fillRect(e,t,this.mana/this.manaMax*150,15);const a="".concat(this.mana,"/").concat(this.manaMax);return this.manaBarText=this.scene.add.text(e+20,t+8,a,{fontSize:"16px",fill:"#000000"}).setOrigin(.5),this}addStatsDisplay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:420;const t={fontSize:"16px",fill:"#FFFFFF"},a=this.x;return this.strengthAndArmorImage=this.scene.add.image(a-30,e,"strengthAndArmor").setScale(.6).setInteractive().setDepth(20),this.armorText=this.scene.add.text(a+30,e+5,"".concat(this.armor,"/").concat(this.armorMax),t).setDepth(25),this.strengthText=this.scene.add.text(a-60,e+5,"".concat(this.strength,"/").concat(this.strengthMax),t).setDepth(25),this}updateHealthBar(){this.healthBar.clear(),this.health=Phaser.Math.Clamp(this.health,0,this.healthMax);let e=this.x-(this.name===gameState.player.name?105:60);const t=this.y-this.height/2-45,a=this.health/this.healthMax*150,n=this===gameState.player&&this.health<10?"#ff0000":"#000000",o=this.health>=100?18:this.health>=10?27:30,r=this.x-(this.name===gameState.player.name?45:0)-o;return this.healthBar.fillStyle(this.healthBarColor,1),this.healthBar.fillRect(e,t,a,15),this.healthBarText.setText("".concat(this.health,"/").concat(this.healthMax)),this.healthBarText.x=r,this.healthBarText.setColor(n),this}heal(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.health=Math.min(this.healthMax,this.health+e),this.poison=Math.max(0,this.poison-t),this.updateHealthBar(),this}takeDamage(e){return e?(this.health-=e,this.updateHealthBar(),this):this}sufferAttackEffect(e){this.strengthBase-=e.reduceTargetStrengthPlayed,this.armorBase-=e.reduceTargetArmorPlayed,this.poison+=e.poisonPlayed,this.health-=e.damageTotal}updatePoison(){if(!this.poison)return this;const e=Math.max(1,this.health-this.poison),t=this.health-e;return this.health=e,this.poison--,this.updateHealthBar(),t}powerUpTweens(){this.scene.tweens.add({targets:this.sprite,scaleY:1.125*this.sprite.scaleY,scaleX:1.125*this.sprite.scaleX,duration:120,ease:"Cubic",yoyo:!0})}attackTweens(e){this.attackTweenStarted||(this.attackTweenStarted=!0,this.scene.tweens.add({targets:this.sprite,x:this.x+e,duration:120,ease:"Cubic",yoyo:!0,onComplete:()=>{this.attackTweenStarted=!1}}))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;if(!this.sprite)return;this.scene.tweens.add({targets:this.sprite,alpha:0,ease:"Power1",duration:e,onComplete:()=>{this.sprite.destroy()}},self);[this.healthBarBackground,this.healthBarFrame,this.healthBar,this.healthBarText,this.manaBarBackground,this.manaBarFrame,this.manaBar,this.manaBarText,this.strengthAndArmorImage,this.strengthText,this.armorText,this.descriptionBackground,this.descriptionText,this.intentionText,this.intentionBackground].forEach((e=>{e&&e.destroy()}))}}class Enemy extends Character{constructor(e,t,a,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(e,t,a,n),this.debuffKey=o,this.healthBarColor="0xff0000",this.actions=[],this.chosenAction={},this.intentionText="",this.intentionBackground=null,this.intentionDepth=10,this.lifeStealText=null,this.lifeStealTextBackground=null,Object.assign(this,FadeOutBehavior)}removeIfDead(e){if(this.health>0)return!1;this.health=0,this.alive=!1,this.sprite.removeInteractive(),this.turnComplete=!0;const t=[gameState.characters,gameState.enemies];for(let e of t){const t=e.indexOf(this);-1!==t&&e.splice(t,1)}return gameState.troopsOfTakamoriCondition&&e(),this.remove(),!0}updateStats(){const e=gameState.toxicAvenger&&this.poison>0?-4:0;return this.strength=Math.min(this.strengthMax,this.strengthBase+this.strengthTurn+e),this.armor=Math.min(this.armorMax,this.armorBase+this.armorTurn),this.armorText.setText("".concat(this.armor,"/").concat(this.armorMax)),this.strengthText.setText("".concat(this.strength,"/").concat(this.strengthMax)),this}updateManaBar(){return this}gainStrengthAndArmor(e,t){e&&(this.strengthBase=Math.min(this.strengthMax,this.strengthBase+e)),t&&(this.armorBase=Math.min(this.armorMax,this.armor+t))}getValueOrInvoke(e){return"function"==typeof e?e():e}normalizeActions(){let e;if(this.actions.some((e=>e.turn===gameState.turn)))return this.actions.filter((e=>e.turn===gameState.turn));e=this.actions.filter((e=>null===e.turn));const t=e=>{({even:()=>{e.probability=gameState.turn%2==0?1:0},odd:()=>{e.probability=gameState.turn%2!=0?1:0},oneInThree:()=>{e.probability=gameState.turn%3==0?1:0},twoInThree:()=>{e.probability=gameState.turn%3==1?1:0},threeInThree:()=>{e.probability=gameState.turn%3==2?1:0},oneInFour:()=>{e.probability=gameState.turn%4==1?1:0},twoInFour:()=>{e.probability=gameState.turn%4==2?1:0},threeInFour:()=>{e.probability=gameState.turn%4==3?1:0},fourInFour:()=>{e.probability=gameState.turn%4==0?1:0}})[this.getValueOrInvoke(e.pattern)]()};e.forEach((e=>{"string"==typeof this.getValueOrInvoke(e.pattern)?t(e):"function"==typeof e.pattern&&(e.probability=0)}));const a=e.reduce(((e,t)=>e+this.getValueOrInvoke(t.probability)),0);return console.log("enemy: ".concat(this.name," . TotalProbability: ").concat(a)),e}selectAction(){const e=this.normalizeActions();let t=0;for(let a=0;a<e.length;a++)t+=this.getValueOrInvoke(e[a].probability),e[a].cumulativeProbability=t;const a=Math.random();return this.chosenAction=e.find((e=>a<e.cumulativeProbability)),this}displayIntention(){const e=this.chosenAction;e.damage&&e.updateDamage().setKey(),console.log("chosenAction.key: "+e.key);this.intentionText=this.scene.add.text(this.x+15,this.y-this.height/2-63,"".concat(e.key),{fontSize:"18px",fill:"#000000"}),this.intentionText.setOrigin(.5,1).setDepth(this.intentionDepth+1);const t=this.scene.textures.get("listbox1").getSourceImage().width,a=this.intentionText.width/t;this.intentionBackground=this.scene.add.image(this.x+15,this.y-this.height/2-50,"listbox1").setScale(1.2*a,1.5),this.intentionBackground.setInteractive().setOrigin(.5,1).setAlpha(.85).setDepth(this.intentionDepth)}updateIntention(){const e=this.chosenAction;return e.damage&&e.updateDamage().setKey(),this.intentionText.setText(e.key),this}fadeOutIntentionText(){this.fadeOutTarget(this.scene,this.intentionText,200),this.fadeOutTarget(this.scene,this.intentionBackground,200)}updatePoisonTextCoordinates(e){return this.lifeStealText?{x:825,y:630,z:e}:{x:870,y:570,z:e}}}class Player extends Character{constructor(e,t,a,n){super(e,t,a,n),this.stance="Neutral",this.healthBarColor="0x00ff00",this.stancePoints=0,this.gold=0,this.goldMax=99,this.numCards=5,this.numCardsBase=5,this.numCardsStance=0,this.mana=3,this.manaMax=3,this.manaBase=3,this.manaStance=0,this.manaCard=0,this.strengthStance=0,this.strengthCard=0,this.armorStance=0,this.armorCard=0,this.lifeStealBase=0,this.lifeStealThisTurn=0}depleteMana(){return 0===this.mana||(this.mana=0,this.manaMax=this.manaBase,this.updateManaBar()),this}updateStats(){const e=gameState.playersTurn,t=gameState.shogunsShellCounter&&this.stancePoints<0,a=gameState.kamishimoUberAlles&&this.stancePoints<0,n=gameState.bushido?Math.floor(this.armor/3):0,o=a?-1*gameState.player.stancePoints*gameState.kamishimoUberAlles:0,r=this.strengthBase+this.strengthStance+(e?this.strengthCard:0);this.strength=Math.min(this.strengthMax,r+n+o);const s=this.armorBase+this.armorCard+(e?0:this.armorStance),i=t?-1*this.stancePoints*gameState.shogunsShellCounter:0;this.armor=Math.min(this.armorMax,s+i);return n>gameState.strengthBushido&&e&&this.scene.animatePermanent("bushido"),a&&e&&this.scene.animatePermanent("kamishimoUberAlles"),gameState.strengthBushido=n,this.armorText.setText("".concat(this.armor,"/").concat(this.armorMax)),this.strengthText.setText("".concat(this.strength,"/").concat(this.strengthMax)),this}updateManaBar(){this.mana=Phaser.Math.Clamp(this.mana,0,this.manaMax);const e=this.x-105,t=this.y-this.height/2-70,a=this.mana/this.manaMax*150;return this.manaBar.clear(),this.manaBar.fillStyle(255,1),this.manaBar.fillRect(e,t,a,15),this.manaBarText.setText("".concat(this.mana,"/").concat(this.manaMax)),this}resetStrengthAndArmor(){return this.armorCard=0,this.strengthCard=0,this}resetStanceAndMana(){const e=gameState.foreverTrue&&this.stancePoints>0,t=e?1:0,a=gameState.rebelSpirit&&gameState.turn%3==0,n=a?1:0;return e&&this.scene.animatePermanent("foreverTrue"),a&&this.scene.animatePermanent("rebelSpirit"),this.handleFreedomLastTurnEffects(),this.manaMax=this.manaBase+this.manaStance+n+t,this.mana=this.manaMax,this.stancePoints=gameState.foreverTrue?this.stancePoints:0,this.updateStance(),this}handleFreedomLastTurnEffects(){const e=this.stancePoints;if(e<=0)return this.manaStance=0,this.numCardsStance=-3===e?-1:0,void(this.numCards=this.numCardsBase+this.numCardsStance);Math.random()>.5?(this.manaStance=1,this.numCardsStance=0):(this.manaStance=0,this.numCardsStance=1),this.numCards=this.numCardsBase+this.numCardsStance}updateStance(){const e=this.stancePoints;switch(e){case-3:this.armorStance=3,this.strengthStance=3,this.numCardsStance=-1,this.stance="Discipline";break;case-2:case-1:this.armorStance=3,this.strengthStance=3,this.numCardsStance=0,this.stance="Discipline";break;case 0:this.armorStance=0,this.strengthStance=0,this.numCardsStance=0,this.stance="Neutral";break;case 1:case 2:this.armorStance=0,this.strengthStance=0,this.stance="Freedom";break;case 3:this.armorStance=-2,this.strengthStance=0,this.stance="Freedom";break;default:return console.error("Unexpected value for points: ".concat(e)),this}return this.updateStanceBar(e),this}updateStanceBar(e){gameState.stanceBar.clear();const t=e<0?100*e:0;gameState.stanceBar.fillRect(gameState.stanceBarStartX+300+t,gameState.stanceBarMargin,100*Math.abs(e),gameState.stanceBarHeight),gameState.stanceText.setText("Stance: ".concat(this.stance))}removeIfDead(e){if(this.health>0)return!1;const t=gameState.punksNotDeadCondition;return this.health=0,t?(this.resurrected=!0,e(),!1):(this.alive=!1,this.sprite.removeInteractive(),this.turnComplete=!0,this.remove(),!0)}updateState(){return this.resetStanceAndMana().resetStrengthAndArmor().updateManaBar().updateHealthBar().updateStats()}updatePoisonTextCoordinates(){return{x:810,y:570}}buff(e,t,a){gameConfig.strengthBaseCards.includes(e)?this.strengthBase+=t:this.strengthCard+=t,this.armorCard+=a}gainMana(e){return this.mana+=e,this.manaMax+=e,this.updateManaBar(),this}sufferDebuffDamage(e){return this.health-=e,this.updateHealthBar(),this}increaseHealthMax(e){return this.healthMax+=e,gameConfig.powerUpSound.play({volume:.15}),this.updateHealthBar(),this.powerUpTweens(),this}incrementLifeStealCounter(e){if(!e.lifeStealPlayed)return this;this.lifeStealCounter+=e.damagePlayed*e.damageModifier*e.lifeStealPlayed}increaseStance(e){const t=this.stancePoints+e;gameState.player.stancePoints=t<-3?-3:t>3?3:t}updateStanceAfterCard(e){const t=e.stancePointsPlayed,a=this.stancePoints+t;this.stancePoints=a<-3?-3:a>3?3:a,this.updateStance();(()=>(this.freedomAfterCardPlayed="Freedom"===this.stance,!this.freedomBeforeCardPlayed&&this.freedomAfterCardPlayed))()&&(this.mana++,this.manaMax++,this.updateManaBar())}}class Characters extends Phaser.Scene{constructor(){super("Characters")}create(){console.log("Characters loaded"),gameState.player=new Player(gameState.playerName,100,0,0),this.scene.start("Cards")}}class Button{constructor(e,t,a,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:201,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.6,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.6;this.scene=e,this.key=t,this.sprite=e.add.image(n,o,"rectangularButtonPressed"),this.sprite.setScale(s,i).setDepth(r).setOrigin(.5),this.label=e.add.text(n,o,t,{fontSize:"25px",fill:"#000000"}),this.label.setDepth(r+1).setOrigin(.5),Object.assign(this,FadeOutBehavior),this.isActive=!1,this.isHovered=!1,this.isPressed=!1,this.key=t,this.pointerText="",this._pointerTextObjects=[],this.handlerArg={};const l=()=>{const t=e.add.text(n,o+75,this.pointerText,{fontSize:"22px",fill:"#000000"}).setDepth(r+1).setOrigin(.5,.5),a=t.getBounds(),s=a.width+15,i=a.height+15,l=a.x-7.5,m=a.y-7.5,d=e.add.graphics();d.fillStyle(16777215,1).setAlpha(.6).setDepth(r),d.fillRoundedRect(l,m,s,i,12),this._pointerTextObjects.push(t,d)};this.sprite.on("pointerover",(()=>{this.isActive&&(this.isHovered=!0,this.sprite.setTexture("rectangularButtonHovered"),this.pointerText&&l())})),this.sprite.on("pointerout",(()=>{this._pointerTextObjects.length&&this.destroyPointerText(),this.isActive&&(this.isHovered=!1,this.sprite.setTexture("rectangularButton"))})),this.sprite.on("pointerdown",(()=>{this.isActive&&this.sprite.setTexture("rectangularButtonPressed")})),this.sprite.on("pointerup",(()=>{this.isActive&&(gameConfig.buttonPressedSound.play({volume:.7}),this.sprite.setTexture("rectangularButtonHovered"),a(this.handlerArg),this._pointerTextObjects.length&&(this.destroyPointerText(),l()))}))}destroyPointerText(){this._pointerTextObjects.forEach((e=>e.destroy())),this._pointerTextObjects=[]}setPointerText(e){return this.pointerText=e,this}activate(){return this.isActive||(this.isActive=!0,this.sprite.setInteractive(),this.sprite.setTexture("rectangularButton")),this}deactivate(){return this.isActive?(this.isActive=!1,this.sprite.setTexture("rectangularButton"),this):this}disable(){if(!this.isActive)return this;return(()=>this._pointerTextObjects&&this._pointerTextObjects.length)&&this.destroyPointerText(),this.isActive=!1,this.sprite.removeInteractive(),this.sprite.setTexture("rectangularButtonPressed"),this}updateFont(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000";return this.label.setFontSize(e),this.label.setFill(t),this}setDepth(e){return this.sprite.setDepth(e),this.label.setDepth(e+1),this}setScale(e,t){return this.sprite.setScale(e,t),this}destroy(){return this.sprite.destroy(),this.label.destroy(),this}fadeOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;this.fadeOutTarget(this.scene,this.sprite,e),this.fadeOutTarget(this.scene,this.label,e)}addHandlerArg(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.forEach((e=>Object.assign(this.handlerArg,e))),this}setHandlerArg(e){return this.handlerArg=e,this}}class Buttons extends Phaser.Scene{constructor(){super("Buttons")}create(){console.log("Buttons loaded"),this.scene.start("Characters")}}class TextBox{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const r=Object.assign({},{x:0,y:0,z:200},a),s=Object.assign({},{fontSize:50,fill:"#ff0000",fontWeight:""},n);this.scene=e,this.textContent=t,this.x=r.x,this.y=r.y,this.z=r.z,this.textConfig=s,this.displayed=!0,Object.assign(this,FadeOutBehavior,a,n),this.textObj=this.scene.add.text(this.x,this.y,this.textContent,this.textConfig),this.textObj.setOrigin(.5).setDepth(this.z);const i=this.textObj.getBounds(),l=i.width+15,m=i.height+15,d=i.x-7.5,g=i.y-7.5;this.cornerRadius=10,this.backgroundColor="0xFFFFFF",this.backgroundAlpha=o,this.background=this.scene.add.graphics(),this.background.fillStyle(this.backgroundColor,1).setAlpha(this.backgroundAlpha).setDepth(this.z-1),this.background.fillRoundedRect(d,g,l,m,this.cornerRadius)}updateText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.z;this.textObj.setText(e).setOrigin(.5).setDepth(t);const a=this.textObj.getBounds(),n=a.width+10,o=a.height+10,r=a.x-5,s=a.y-5;this.background.clear(),this.background.fillStyle(this.backgroundColor,1).setAlpha(this.backgroundAlpha).setDepth(t-1),this.background.fillRoundedRect(r,s,n,o,this.cornerRadius)}setConfig(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.4;return this.textConfig=e,this.cornerRadius=t,this.background.setAlpha(a),this}destroy(){return this.textObj.destroy(),this.background.destroy(),this.displayed=!1,this}fadeOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;this.fadeOutTarget(this.scene,this.textObj,e),this.fadeOutTarget(this.scene,this.background,e),this.displayed=!1}get isDisplayed(){return this.displayed}}class TextBoxes extends Phaser.Scene{constructor(){super("TextBoxes")}create(){console.log("TextBoxes loaded"),this.scene.start("Mainmenu")}}class Action{constructor(e){Object.assign(this,{enemy:null,turn:null,pattern:null,probability:1,stealStrength:0,stealArmor:0,damage:0,fire:0,poison:0,heal:0,poisonRemove:0,strength:0,armor:0,debuffCard:"",debuffRepeat:!1,teamEffect:!1,summonEnemy:null,skip:!1},e),this.fire=this.adjust(this.fire),this.poison=this.adjust(this.poison),this.heal=this.adjust(this.heal),this.poisonRemove=this.adjust(this.poisonRemove),this.strength=this.adjust(this.strength),this.armor=this.adjust(this.armor),this.enemy="number"==typeof this.enemy?gameState["enemy"+this.enemy]:this.enemy,this.damageBase=this.damage,this.updateDamage()}adjust(e){const t=gameState.difficulty,a="Easy"===t?.9:"Medium"===t?1:1.1;return Math.round(e*a)}updateDamage(){if(!this.damageBase)return this;const e=this.adjust(this.damageBase),t=(1+.1*this.enemy.strength)*(1-gameState.player.armor/20);return this.damage=Math.round(Math.max(0,e*t)),this}setKey(e){if(e)return this.key=e,this;let t=[];return(this.damage||this.fire)&&t.push("Intends to\nDeal ".concat(this.damage+this.fire," damage")),this.poison&&t.push("Intends to\nDeal ".concat(this.poison," poison")),this.stealStrength&&t.push("Intends to\nSteal ".concat(this.stealStrength," Strength")),this.summonEnemy&&t.push("Intends to\nSummon a ".concat(this.summonEnemy.name)),this.debuffCard&&t.push("Intends to\napply a debuff"),this.key=t.join("\n"),this}get text(){let e=[];return(this.damage||this.fire)&&e.push("Deals ".concat(this.damage+this.fire," Damage")),this.poison&&e.push("Deals ".concat(this.poison," Poison")),this.heal&&e.push("Heals ".concat(this.heal," HP")),this.strength&&e.push("Gains ".concat(this.strength," Strength")),this.armor&&e.push("Gains ".concat(this.armor," Armor")),this.debuffCard&&e.push("Applies a debuff"),this.skip&&e.push("Skips a Turn"),this.summon&&e.push("Summons\na ".concat(this.summonEnemy.name)),this.stealStrength&&e.push("Steals ".concat(this.stealStrength," Strength")),this.stealArmor&&e.push("Steals ".concat(this.stealArmor," Armor")),this.teamEffect&&this.heal&&e.push("Heals allies ".concat(this.heal," HP")),this.teamEffect&&(this.armor||this.strength)&&e.push("Buffs allies"),e.join("\n")}}class Actions extends Phaser.Scene{constructor(){super("Actions")}create(){console.log("Actions loaded"),this.scene.start("Cards")}}class Level1Fight1 extends BaseScene{constructor(){super("Level1Fight1")}preload(){[{key:"theCity",path:"../assets/images/backgrounds/theCity.jpg",loaded:!1},{key:"bakgrunnCity1",path:"../assets/images/backgrounds/bakgrunnCity1.jpg",loaded:!1},{key:"nazi",path:"../assets/images/sprites/nazi.png",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnCity1",t,1.15),this.resetPlayer(.69,570,540),this.addGoldCounter(),this.defineCardSlots(),this.definePermanentSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),j(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");U("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),S()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),O(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],i(a);U("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,75),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",R,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(35,40,45);async function n(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{Y(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await o(gameState.enemy1),await o(gameState.player),gameState.startFightObjects.forEach((e=>Y(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",r,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||s()}(),e.input.keyboard.on("keydown",r,this),e.input.on("pointerup",r,this)}async function o(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(Y(r),Y(s))))}async function r(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>Y(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",r,this),e.time.removeAllEvents(),s()))}async function s(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,K(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(V),h()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),i(gameState.player.numCards))}async function i(t){const a=e=>e&&(gameState.drawPile.length||m()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void l(s);const{card:i,cardDepth:m}=d(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,m),i.sprite.on("pointerup",(()=>g(i))),o===t-1&&l(s),await e.delay(s)}}async function l(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function m(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function d(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function g(t){t.typePlayed=u(t.type),t.costPlayed=t.dBeat?0:u(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&O(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),c(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;c(e,a,o)}))}(e),permanent:()=>F(e),default:()=>{e.discard(),c(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function c(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),Y(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),G(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];Y(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>M(1),coverCharge:()=>{gameState.player.stancePoints>1&&M(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return U("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),U("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){U(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const S=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:u(t.damage),firePlayed:d?3:s?10:u(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:u(t.stancePoints),poisonPlayed:i?a.poison:u(t.poison)+p,healPlayed:u(t.heal),strengthPlayed:u(t.strength),armorPlayed:c?2:u(t.armor),reduceTargetArmorPlayed:g?S:u(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:u(t.reduceTargetStrength),drawCardPlayed:u(t.drawCard),poisonRemovePlayed:u(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(N),h())return;G(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{Y(e)}))}))}function u(e){return"function"==typeof e?e():e}function S(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,K(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,r),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:gameState[s],damage:15,probability:.4}).setKey(""),new Action({enemy:gameState[s],damage:17,probability:.2}).setKey(""),new Action({enemy:gameState[s],heal:15,armor:3,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,armor:5,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,strength:3,probability:.15}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",p(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",p(t,a)}))}(t,a):a.debuffCard?p(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?N:V;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>Y(e,50))),t.turnComplete=!0,h())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?S():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,s()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,S()))}function p(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function h(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),j(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&Y(gameState.actionText,200);gameState.actionTextBackground&&Y(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>Y(e,200))),gameState.enemies.forEach((e=>Y(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(M(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(M(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,f,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",y,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,C,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),j(),Y(gameState.actionText,200),Y(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>Y(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(50),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};await e.delay(300),gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function f(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,M(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function y(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,b,r,s+i*l++),t.shopAddCardButton=new Button(e,n,w,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,P,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",B,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function C(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?x():(e.input.on("pointerup",(()=>v())),e.time.delayedCall(2500,(()=>v())))}function x(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{console.log("bonusCard.key: "+t.key),t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>v())),e.time.delayedCall(2500,(()=>v()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,T,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function k(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function T(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(O(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),x(t.depth))}function v(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function b(t){const{isHealEnabled:a}=E(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;D(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,A(n)}function w(t){const{isAddCardEnabled:a}=E(t.addCardCost);a?(D(t.addCardCost,t),x(210),A(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function P(t){const{isRemoveCardEnabled:a}=E(t.removeCardCost);a?(D(t.removeCardCost,t),k(210),A(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function B(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function D(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),O(e),n.forEach((e=>{e&&e.destroy()}))}function A(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function M(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function F(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;U("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof I[a]?I[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return I.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;U("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){U("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>H(1),steelToe2:()=>H(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",R,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton),1!==gameState.lustForLifeCounter||t.freePermanent||e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.lustForLifeCounter>=5&&L(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;L(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?I.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?z(t,r,s):e.cameras.main.shake(70,.002,!1)}))}gameState.enemy1=new Enemy("Nazi Punk",a,0,0,""),gameState.enemy1.sprite=this.add.image(1105,543,"nazi").setScale(.618).setFlipX(!1),gameState.enemy1.actions=[new Action({enemy:1,turn:1,heal:10,armor:5}).setKey("Intends to\nApply a buff"),new Action({enemy:1,turn:2,damage:15}).setKey(""),new Action({enemy:1,turn:3,heal:10,strength:3}).setKey("Intends to\nApply a buff"),new Action({enemy:1,turn:4,damage:15}).setKey(""),new Action({enemy:1,damage:15,probability:.5}).setKey(""),new Action({enemy:1,damage:17,probability:.2}).setKey(""),new Action({enemy:1,heal:10,armor:3,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:1,heal:10,strength:2,probability:.15}).setKey("Intends to\nApply a buff")],gameState.enemies=[gameState.enemy1],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(705),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),F(gameState.deck.find((e=>!0===e.freePermanent))),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>X("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>X("discardPile"))),a.forEach((e=>e.on("pointerout",q)))}(),function(){const t=e.add.image(0,0,"theCity");t.setScale(1.31).setOrigin(.02,0).setDepth(300);const a=n,o={fontSize:"120px",fill:"#ff0000",fontFamily:"Rock Kapak"},r=e.add.text(825,405,"Level 1:",o),s=e.add.text(825,645,"On City Streets",o);[r,s].forEach((e=>e.setDepth(301).setOrigin(.5)));let i=!1;const l=()=>{i||(i=!0,Y(t,2e3),Y(r,1300),Y(s,1300),e.time.delayedCall(500,a))};e.time.delayedCall(4e3,l),e.input.on("pointerup",l),e.input.keyboard.on("keydown",l)}();const I={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,L(e),G(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,L(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,L(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,L(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());U("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),U("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(N),h())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),U("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(N),h())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(N),h()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,L(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(L(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&Y(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,L(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,M(3),L(e)}(e),depleteLustForLife:e=>function(e){if(L(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;Y(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,L(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.floor(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),L(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));L(e)}(e),depleteEnduringSpirit:e=>L(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),L(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,L(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),G(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(N)})),h()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(N),U("Dealt ".concat(r," Physical Damage!")),h());}(o,t,a,n)}))}))}};function z(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof I[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&U("Permanent depleted."),I[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function H(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function L(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function R(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);O(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));U("Bought ".concat(7," HP"))}function j(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),Y(e.sprite,200)}}function U(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function K(e,t){if(!e.poison)return;const a=e.updatePoison();U("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function G(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return e.cameras.main.shake(70,.002,!1),void console.log("gameState.currentCards.length: "+gameState.currentCards.length+"numCardsLimit: "+a);gameState.drawPile.length||m();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&W(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){g(t)}))}))}async function W(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});U("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(N)})),await e.delay(100),h()}function N(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function V(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;z(t,t.tookenSprite,t.tokenSlot)}function Y(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function X(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function q(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>Y(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(G(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(N),h(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level1Fight2 extends BaseScene{constructor(){super("Level1Fight2")}preload(){[{key:"bakgrunnCity2",path:"../assets/images/backgrounds/bakgrunnCity2.jpg",loaded:!1},{key:"rat1",path:"../assets/images/sprites/rat1.png",loaded:!1},{key:"rat2",path:"../assets/images/sprites/rat2.png",loaded:!1},{key:"infestation",path:"../assets/images/cards/infestation.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnCity2",t),this.resetPlayer(.7,540,435),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1;const t=2*gameState.currentCards.filter((e=>"infestation"===e.key)).length;gameState.player.poison+=t,gameState.buttons.forEach((e=>e.disable())),j(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");U("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),S()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),O(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],i(a);U("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.endOfTurnButton=new Button(e,"Heal",R,1350,195,8),gameState.endOfTurnButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.endOfTurnButton)),gameState.buttons.forEach((e=>e.disable())),gameState.enemy1=new Enemy("City Rat Jr.",40,0,0,"infestation"),gameState.enemy1.sprite=this.add.image(945,505,"rat1").setScale(.58).setFlipX(!0),gameState.enemy1.actions=[new Action({enemy:1,turn:1,poison:5}).setKey("Intends to\nPoison you"),new Action({enemy:1,turn:2,heal:10,armor:4}).setKey("Intends to\nApply a buff"),new Action({enemy:1,turn:3,poison:4}).setKey("Intends to\nPoison you"),new Action({enemy:1,turn:4,poison:4}).setKey("Intends to\nPoison you"),new Action({enemy:1,poison:5,probability:.5}).setKey("Intends to\nPoison you"),new Action({enemy:1,damage:15,probability:.3}).setKey(""),new Action({enemy:1,heal:15,armor:3,probability:.2}).setKey("Intends to\nApply a buff")];const a=e.adjustForDifficulty(45,50,55);gameState.enemy2=new Enemy("City Rat Sr.",a,0,0,"infestation"),gameState.enemy2.sprite=this.add.image(1185,535,"rat2").setScale(.61).setFlipX(!0),gameState.enemy2.actions=[new Action({enemy:2,turn:1,debuffCard:"draw"}).setKey("Intends to\nInfect you"),new Action({enemy:2,turn:2,heal:10,armor:4}).setKey("Intends to\nApply a buff"),new Action({enemy:2,turn:3,debuffCard:"discard"}).setKey("Intends to\nInfect you"),new Action({enemy:2,turn:4,poison:4}).setKey("Intends to\nPoison you"),new Action({enemy:2,poison:4,probability:.5}).setKey("Intends to\nPoison you"),new Action({enemy:2,debuffCard:"draw",probability:.3}).setKey("Intends to\nInfect you"),new Action({enemy:2,heal:15,armor:3,probability:.2}).setKey("Intends to\nApply a buff")],gameState.enemies=[gameState.enemy1,gameState.enemy2],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(635),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(F),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>X("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>X("discardPile"))),a.forEach((e=>e.on("pointerout",q)))}();async function n(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{Y(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.ratTaunts.length),a=gameState.ratTaunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await o(gameState.enemy1),await o(gameState.player),gameState.startFightObjects.forEach((e=>Y(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",r,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||s()}(),e.input.keyboard.on("keydown",r,this),e.input.on("pointerup",r,this)}async function o(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(Y(r),Y(s))))}async function r(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>Y(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",r,this),e.time.removeAllEvents(),s()))}async function s(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,K(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(V),h()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),1===gameState.turn&&await async function(){e.delay(300);const t=new TextBox(e,"Heads up: Rats\nare infectious!",{x:825,y:420,z:201},{fontSize:"57px",fill:"#ff0000",fontWeight:"bold"});await e.delay(2500),t.fadeOut()}(),gameState.characters.forEach((e=>e.activateStatsDisplay())),i(gameState.player.numCards))}async function i(t){const a=e=>e&&(gameState.drawPile.length||m()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void l(s);const{card:i,cardDepth:m}=d(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,m),i.sprite.on("pointerup",(()=>g(i))),o===t-1&&l(s),await e.delay(s)}}async function l(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function m(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function d(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function g(t){t.typePlayed=u(t.type),t.costPlayed=t.dBeat?0:u(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&O(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){console.log("selectActivationMode called");const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),c(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,console.log("gameState.enemiesLength: "+gameState.enemiesLength),t.forEach(((a,n)=>{const o=n===t.length-1;c(e,a,o)}))}(e),permanent:()=>F(e),default:()=>{e.discard(),c(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function c(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),Y(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),G(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];Y(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>M(1),coverCharge:()=>{gameState.player.stancePoints>1&&M(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return U("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),U("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){U(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const S=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:u(t.damage),firePlayed:d?3:s?10:u(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:u(t.stancePoints),poisonPlayed:i?a.poison:u(t.poison)+p,healPlayed:u(t.heal),strengthPlayed:u(t.strength),armorPlayed:c?2:u(t.armor),reduceTargetArmorPlayed:g?S:u(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:u(t.reduceTargetStrength),drawCardPlayed:u(t.drawCard),poisonRemovePlayed:u(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(N),h())return;G(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{Y(e)}))}))}function u(e){return"function"==typeof e?e():e}function S(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,K(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,r),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:gameState[s],damage:15,probability:.4}).setKey(""),new Action({enemy:gameState[s],damage:17,probability:.2}).setKey(""),new Action({enemy:gameState[s],heal:15,armor:3,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,armor:5,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,strength:3,probability:.15}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",p(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",p(t,a)}))}(t,a):a.debuffCard?p(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?N:V;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>Y(e,50))),t.turnComplete=!0,h())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?S():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,s()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,S()))}function p(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0;const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function h(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),j(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&Y(gameState.actionText,200);gameState.actionTextBackground&&Y(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>Y(e,200))),gameState.enemies.forEach((e=>Y(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(M(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(M(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,f,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",y,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,C,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),j(),Y(gameState.actionText,200),Y(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>Y(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(50),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};await e.delay(300),gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function f(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,M(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function y(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,b,r,s+i*l++),t.shopAddCardButton=new Button(e,n,w,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,P,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",B,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function C(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?x():(e.input.on("pointerup",(()=>v())),e.time.delayedCall(2500,(()=>v())))}function x(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>v())),e.time.delayedCall(2500,(()=>v()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,T,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function k(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function T(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(O(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),x(t.depth))}function v(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function b(t){const{isHealEnabled:a}=E(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;D(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,A(n)}function w(t){const{isAddCardEnabled:a}=E(t.addCardCost);a?(D(t.addCardCost,t),x(210),A(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function P(t){const{isRemoveCardEnabled:a}=E(t.removeCardCost);a?(D(t.removeCardCost,t),k(210),A(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function B(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function D(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),O(e),n.forEach((e=>{e&&e.destroy()}))}function A(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function M(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function F(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;U("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof I[a]?I[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return I.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;U("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){U("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>H(1),steelToe2:()=>H(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",R,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&L(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;L(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?I.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?z(t,r,s):e.cameras.main.shake(70,.002,!1)}))}n();const I={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,L(e),G(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,L(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,L(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,L(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());U("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),U("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(N),h())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),U("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(N),h())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,L(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(N),h()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,L(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(L(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&Y(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,L(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,M(3),L(e)}(e),depleteLustForLife:e=>function(e){if(L(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;Y(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,L(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.floor(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),L(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));L(e)}(e),depleteEnduringSpirit:e=>L(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),L(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,L(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),G(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(N)})),h()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(N),U("Dealt ".concat(r," Physical Damage!")),h());}(o,t,a,n)}))}))}};function z(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof I[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&U("Permanent depleted."),I[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function H(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function L(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function R(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);O(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));U("Bought ".concat(7," HP"))}function j(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),Y(e.sprite,200)}}function U(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function K(e,t){if(!e.poison)return;const a=e.updatePoison();U("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function G(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||m();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&W(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){console.log("card.sprite.on( pointerup"),g(t)}))}))}async function W(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});U("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(N)})),await e.delay(100),h()}function N(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function V(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;z(t,t.tookenSprite,t.tokenSlot)}function Y(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function X(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function q(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>Y(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(G(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(N),h(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level1Fight3 extends BaseScene{constructor(){super("Level1Fight3")}preload(){[{key:"bakgrunnCity3",path:"../assets/images/backgrounds/bakgrunnCity3.jpg",loaded:!1},{key:"police1",path:"../assets/images/sprites/police1.png",loaded:!1},{key:"police2",path:"../assets/images/sprites/police2.png",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnCity3",t),this.resetPlayer(.65,550,530),this.addGoldCounter(),this.defineCardSlots();let a=7;gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),U(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");K("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),p()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),F(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],l(a);K("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.endOfTurnButton=new Button(e,"Heal",j,1350,195,8),gameState.endOfTurnButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.endOfTurnButton)),gameState.buttons.forEach((e=>e.disable())),gameState.enemy1=new Enemy("Sgt. Pig",45,0,0,""),gameState.enemy1.sprite=this.add.image(1015,530,"police1").setScale(.372).setFlipX(!0),gameState.enemy1.actions=[new Action({enemy:1,turn:1}).setKey("Intends to\nRequest backup"),new Action({enemy:1,pattern:"even",damage:12}).setKey(""),new Action({enemy:1,pattern:"odd",heal:10,strength:3}).setKey("Intends to\nApply a buff")];const n=e.adjustForDifficulty(55,60,65);gameState.enemy2=new Enemy("Lt. Pig",n,0,0,""),gameState.enemy2.sprite=this.add.image(1255,530,"police2").setScale(.57).setFlipX(!0),gameState.enemy2.actions=[new Action({enemy:2,turn:1}).setKey("Intends to\nRequest backup"),new Action({enemy:2,pattern:"oneInThree",damage:13}).setKey(""),new Action({enemy:2,pattern:"twoInThree",heal:10,strength:3}).setKey("Intends to\nApply a buff"),new Action({enemy:2,pattern:"threeInThree",damage:15}).setKey("")],gameState.enemies=[gameState.enemy1,gameState.enemy2],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(685),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(I),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>q("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>q("discardPile"))),a.forEach((e=>e.on("pointerout",$)))}();async function o(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{X(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await r(gameState.enemy1),await r(gameState.player),gameState.startFightObjects.forEach((e=>X(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||i()}(),e.input.keyboard.on("keydown",s,this),e.input.on("pointerup",s,this)}async function r(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(X(r),X(s))))}async function s(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>X(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),i()))}async function i(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,function(){a-=1,2===gameState.turn&&function(){const t={fontSize:"80px",fontWeight:"bold",fill:"#000000"};gameState.turnsTextBox=e.add.rectangle(825,225,83,83,16777215).setAlpha(.3).setOrigin(.5),gameState.turnsText=e.add.text(825,230,"".concat(a),t).setOrigin(.5)}();gameState.turn>2&&gameState.turnsText.setText("".concat(a));if(0===a)return gameState.player.health=0,gameState.punksNotDeadCondition=!1,e.sound.add("gunShotSound").play({volume:1.7}),e.cameras.main.flash(600),e.cameras.main.shake(650,.01,!1),gameState.player.removeIfDead(Y),f(),!1;return!0}()&&(G(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(Y),f()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),l(gameState.player.numCards)))}async function l(t){const a=e=>e&&(gameState.drawPile.length||d()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void m(s);const{card:i,cardDepth:l}=g(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>c(i))),o===t-1&&m(s),await e.delay(s)}}async function m(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function d(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function g(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function c(t){t.typePlayed=S(t.type),t.costPlayed=t.dBeat?0:S(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&F(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),u(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,console.log("gameState.enemiesLength: "+gameState.enemiesLength),t.forEach(((a,n)=>{const o=n===t.length-1;u(e,a,o)}))}(e),permanent:()=>I(e),default:()=>{e.discard(),u(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function u(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),X(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),W(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];X(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>O(1),coverCharge:()=>{gameState.player.stancePoints>1&&O(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return K("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),K("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){K(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:S(t.damage),firePlayed:d?3:s?10:S(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:S(t.stancePoints),poisonPlayed:i?a.poison:S(t.poison)+p,healPlayed:S(t.heal),strengthPlayed:S(t.strength),armorPlayed:c?2:S(t.armor),reduceTargetArmorPlayed:g?u:S(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:S(t.reduceTargetStrength),drawCardPlayed:S(t.drawCard),poisonRemovePlayed:S(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(V),f())return;W(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{X(e)}))}))}function S(e){return"function"==typeof e?e():e}function p(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};if(gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats(),1===gameState.turn)return await async function(){const t=1500,a=3e3,n=3e3,o={fontSize:"60px",fill:"#ff0000",fontWeight:"bold"},r={x:825,y:450,z:201};await e.delay(t);const s=new TextBox(e,"   The cops are\ncalling for backup!",r,o,.6);await e.delay(a),s.destroy();const i=new TextBox(e,"Police snipers\n will hit you\n  in 5 turns!",r,o,.6);await e.delay(n),i.destroy()}(),void i()}t.turnComplete=!1,G(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,r),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:gameState[s],damage:15,probability:.4}).setKey(""),new Action({enemy:gameState[s],damage:17,probability:.2}).setKey(""),new Action({enemy:gameState[s],heal:15,armor:3,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,armor:5,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,strength:3,probability:.15}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",h(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",h(t,a)}))}(t,a):a.debuffCard?h(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?V:Y;e.updateHealthBar(),e.removeIfDead(a()),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>X(e,50))),t.turnComplete=!0,f())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?p():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,i()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,p()))}function h(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0;const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function f(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),U(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&X(gameState.actionText,200);gameState.actionTextBackground&&X(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>X(e,200))),gameState.enemies.forEach((e=>X(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(O(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(O(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,y,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",C,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,x,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),U(),X(gameState.actionText,200),X(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>X(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function y(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,O(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function C(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,w,r,s+i*l++),t.shopAddCardButton=new Button(e,n,P,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,B,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",E,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function x(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?k():(e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b())))}function k(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{console.log("bonusCard.key: "+t.key),t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,v,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function v(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(F(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),k(t.depth))}function b(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function w(t){const{isHealEnabled:a}=D(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;A(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,M(n)}function P(t){const{isAddCardEnabled:a}=D(t.addCardCost);a?(A(t.addCardCost,t),k(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function B(t){const{isRemoveCardEnabled:a}=D(t.removeCardCost);a?(A(t.removeCardCost,t),T(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function E(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function A(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),F(e),n.forEach((e=>{e&&e.destroy()}))}function M(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function I(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;K("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof z[a]?z[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return z.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;K("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){K("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>L(1),steelToe2:()=>L(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&R(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;R(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?z.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?H(t,r,s):e.cameras.main.shake(70,.002,!1)}))}o();const z={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,R(e),W(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,R(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,R(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,R(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());K("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),K("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(V),f())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),K("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(V),f())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(V),f()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,R(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&X(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,R(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,O(3),R(e)}(e),depleteLustForLife:e=>function(e){if(R(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;X(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,R(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.floor(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),R(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));R(e)}(e),depleteEnduringSpirit:e=>R(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),R(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,R(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),W(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(V)})),f()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(V),K("Dealt ".concat(r," Physical Damage!")),f());}(o,t,a,n)}))}))}};function H(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof z[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&K("Permanent depleted."),z[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function L(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function R(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function j(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);F(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));K("Bought ".concat(7," HP"))}function U(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),X(e.sprite,200)}}function K(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function G(e,t){if(!e.poison)return;const a=e.updatePoison();K("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function W(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||d();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&N(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){c(t)}))}))}async function N(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});K("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(V)})),await e.delay(100),f()}function V(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function Y(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;H(t,t.tookenSprite,t.tokenSlot)}function X(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function q(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function $(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>X(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(W(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(V),f(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level2Fight1 extends BaseScene{constructor(){super("Level2Fight1")}preload(){[{key:"theForest",path:"../assets/images/backgrounds/theForest.jpg",loaded:!1},{key:"bakgrunnForest1",path:"../assets/images/backgrounds/bakgrunnForest1.jpg",loaded:!1},{key:"tree1",path:"../assets/images/sprites/tree1.png",loaded:!1},{key:"tree2",path:"../assets/images/sprites/tree2.png",loaded:!1},{key:"rooted",path:"../assets/images/cards/rooted.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnForest1",t),this.resetPlayer(.55,540,545),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),U(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");K("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),p()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),F(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],l(a);K("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(45,50,55);gameState.enemy1=new Enemy("Jubokko Jr.",a,0,15,"rooted"),gameState.enemy1.sprite=this.add.image(1020,473,"tree1").setScale(.48).setFlipX(!1),gameState.enemy1.actions=[new Action({enemy:1,turn:1,debuffCard:"discard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,turn:2,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:1,turn:3,damage:13}).setKey(""),new Action({enemy:1,turn:4,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:1,turn:5,debuffCard:"discard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,damage:12,probability:.35}).setKey(""),new Action({enemy:1,damage:16,probability:.15}).setKey(""),new Action({enemy:1,heal:10,armor:1,probability:.15}).setKey("Intends\nto Rest"),new Action({enemy:1,debuffCard:"discard",probability:.15}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,armor:2,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:1,strength:2,probability:.1}).setKey("Intends to\nApply a buff")];const n=e.adjustForDifficulty(50,60,65);async function o(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{X(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await r(gameState.enemy1),await r(gameState.player),gameState.startFightObjects.forEach((e=>X(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||i()}(),e.input.keyboard.on("keydown",s,this),e.input.on("pointerup",s,this)}async function r(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(X(r),X(s))))}async function s(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>X(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),i()))}async function i(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,G(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(Y),f()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),1===gameState.turn&&await async function(){e.delay(300);const t=new TextBox(e,"Trees start with\nfull Armor, and lose\n1 Armor when attacked",{x:825,y:420,z:201},{fontSize:"50px",fill:"#ff0000",fontWeight:"bold"});await e.delay(3500),t.fadeOut()}(),gameState.characters.forEach((e=>e.activateStatsDisplay())),l(gameState.player.numCards))}async function l(t){const a=e=>e&&(gameState.drawPile.length||d()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void m(s);const{card:i,cardDepth:l}=g(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>c(i))),o===t-1&&m(s),await e.delay(s)}}async function m(t){await e.delay(2*t),gameState.playersTurn=!0,gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>{e.activate(),console.log("Turn: ".concat(gameState.playersTurn)+". Card.key: "+e.key+". Activate: "+e.isActive)}))}function d(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function g(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function c(t){t.typePlayed=S(t.type),t.costPlayed=t.dBeat?0:S(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&F(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),u(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;u(e,a,o)}))}(e),permanent:()=>I(e),default:()=>{e.discard(),u(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function u(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),X(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),W(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];X(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>O(1),coverCharge:()=>{gameState.player.stancePoints>1&&O(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return K("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),K("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){K(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:S(t.damage),firePlayed:d?3:s?10:S(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:S(t.stancePoints),poisonPlayed:i?a.poison:S(t.poison)+p,healPlayed:S(t.heal),strengthPlayed:S(t.strength),armorPlayed:c?2:S(t.armor),reduceTargetArmorPlayed:g?u:S(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:S(t.reduceTargetStrength),drawCardPlayed:S(t.drawCard),poisonRemovePlayed:S(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),function(e,t){t!=gameState.player&&t.armor&&e.damageTotal&&t.armorBase--}(t,a),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(V),f())return;W(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{X(e)}))}))}function S(e){return"function"==typeof e?e():e}function p(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,G(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,r),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:gameState[s],damage:15,probability:.4}).setKey(""),new Action({enemy:gameState[s],damage:17,probability:.2}).setKey(""),new Action({enemy:gameState[s],heal:15,armor:3,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,armor:5,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,strength:3,probability:.15}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",h(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",h(t,a)}))}(t,a):a.debuffCard?h(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?V:Y;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>X(e,50))),t.turnComplete=!0,f())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?p():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,i()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,p()))}function h(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function f(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),U(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&X(gameState.actionText,200);gameState.actionTextBackground&&X(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>X(e,200))),gameState.enemies.forEach((e=>X(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.9,rate:1,seek:.05});const t=await async function(){let t=0;gameState.gundanSeizai&&(O(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(O(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),gameConfig.musicTheme.play({loop:!0,volume:.3}),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,y,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",C,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,x,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),U(),X(gameState.actionText,200),X(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>X(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function y(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,O(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function C(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,w,r,s+i*l++),t.shopAddCardButton=new Button(e,n,P,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,B,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",E,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function x(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?k():(e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b())))}function k(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,v,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function v(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(F(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),k(t.depth))}function b(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function w(t){const{isHealEnabled:a}=D(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;A(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,M(n)}function P(t){const{isAddCardEnabled:a}=D(t.addCardCost);a?(A(t.addCardCost,t),k(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function B(t){const{isRemoveCardEnabled:a}=D(t.removeCardCost);a?(A(t.removeCardCost,t),T(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function E(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function A(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),F(e),n.forEach((e=>{e&&e.destroy()}))}function M(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function I(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;K("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof z[a]?z[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return z.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;K("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){K("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>L(1),steelToe2:()=>L(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&R(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;R(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?z.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?H(t,r,s):e.cameras.main.shake(70,.002,!1)}))}gameState.enemy2=new Enemy("Jubokko Sr.",n,0,15,"rooted"),gameState.enemy2.sprite=this.add.image(1380,473,"tree2").setScale(.48).setFlipX(!1),gameState.enemy2.actions=[new Action({enemy:2,turn:1,debuffCard:"discard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,turn:2,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:2,turn:3,damage:15}).setKey(""),new Action({enemy:2,turn:4,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:2,turn:5,debuffCard:"discard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,damage:14,probability:.35}).setKey(""),new Action({enemy:2,damage:18,probability:.2}).setKey(""),new Action({enemy:2,heal:10,armor:1,probability:.15}).setKey("Intends\nto Rest"),new Action({enemy:2,debuffCard:"discard",probability:.15}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,strength:2,probability:.15}).setKey("Intends to\nApply a buff")],gameState.enemies=[gameState.enemy1,gameState.enemy2],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(680),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(I),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>q("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>q("discardPile"))),a.forEach((e=>e.on("pointerout",$)))}(),function(){const t=e.add.image(0,0,"theForest");t.setScale(1.31).setOrigin(.02,0).setDepth(300);const a=o,n={fontSize:"120px",fill:"#ff0000",fontFamily:"Rock Kapak"},r=e.add.text(825,405,"Level 2:",n),s=e.add.text(825,645,"Aokigahara Forest",n);[r,s].forEach((e=>e.setDepth(301).setOrigin(.5)));let i=!1;const l=()=>{i||(i=!0,X(t,2e3),X(r,1300),X(s,1300),e.time.delayedCall(500,a))};e.time.delayedCall(4e3,l),e.input.on("pointerup",l),e.input.keyboard.on("keydown",l)}();const z={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,R(e),W(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,R(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,R(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,R(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());K("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),K("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(V),f())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),K("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(V),f())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(V),f()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,R(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&X(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,R(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,O(3),R(e)}(e),depleteLustForLife:e=>function(e){if(R(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;X(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,R(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),R(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));R(e)}(e),depleteEnduringSpirit:e=>R(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),R(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,R(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),W(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(V)})),f()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(V),K("Dealt ".concat(r," Physical Damage!")),f());}(o,t,a,n)}))}))}};function H(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof z[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&K("Permanent depleted."),z[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function L(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function R(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function j(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);F(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));K("Bought ".concat(7," HP"))}function U(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,e.disable(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),X(e.sprite,200)}}function K(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function G(e,t){if(!e.poison)return;const a=e.updatePoison();K("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function W(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||d();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&N(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){c(t)}))}))}async function N(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});K("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(V)})),await e.delay(100),f()}function V(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function Y(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;H(t,t.tookenSprite,t.tokenSlot)}function X(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function q(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function $(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>X(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(W(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(V),f(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level2Fight2 extends BaseScene{constructor(){super("Level2Fight2")}preload(){[{key:"bakgrunnForest2",path:"../assets/images/backgrounds/bakgrunnForest2.jpg",loaded:!1},{key:"goblin1",path:"../assets/images/sprites/goblin1.png",loaded:!1},{key:"goblin2",path:"../assets/images/sprites/goblin2.png",loaded:!1},{key:"goblin3",path:"../assets/images/sprites/goblin3.png",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnForest2",t),this.resetPlayer(.7,540,500),this.addGoldCounter(),this.defineCardSlots();let a=5;gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),U(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");K("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),p()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),F(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],l(a);K("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable())),gameState.enemy1=new Enemy("Junior Goblin\nApprentice of poison",30,0,0,""),gameState.enemy1.sprite=this.add.image(1005,570,"goblin1").setScale(.3).setFlipX(!0),gameState.enemy2=new Enemy("Junior Goblin\nArtisan of poison",30,0,0,""),gameState.enemy2.sprite=this.add.image(1200,570,"goblin3").setScale(.27).setFlipX(!1);const n=e.adjustForDifficulty(40,40,45);gameState.enemy3=new Enemy("Senior Goblin\nMaster of poison",n,0,0,""),gameState.enemy3.sprite=this.add.image(1395,570,"goblin2").setScale(.375).setFlipX(!1),gameState.enemy1.actions=[new Action({enemy:1,turn:1}).setKey("Intends to\nEvacuate Gold"),new Action({enemy:1,turn:2,poison:3}).setKey("Intends to\nPoison you"),new Action({enemy:1,turn:3,heal:10,armor:2}).setKey("Intends to\nApply a buff"),new Action({enemy:1,turn:4,poison:3}).setKey("Intends to\nPoison you"),new Action({enemy:1,damage:10,pattern:"oneInThree"}).setKey(""),new Action({enemy:1,poison:3,pattern:"twoInThree"}).setKey("Intends to\nPoison you"),new Action({enemy:1,heal:10,armor:2,pattern:"threeInThree"}).setKey("Intends to\nApply a buff")],gameState.enemy2.actions=[new Action({enemy:2,turn:1}).setKey("Intends to\nEvacuate Gold"),new Action({enemy:2,turn:2,poison:3}).setKey("Intends to\nPoison you"),new Action({enemy:2,turn:3,heal:10,armor:2}).setKey("Intends to\nApply a buff"),new Action({enemy:2,turn:4,poison:3}).setKey("Intends to\nPoison you"),new Action({enemy:2,damage:10,pattern:"oneInThree"}).setKey(""),new Action({enemy:2,poison:3,pattern:"twoInThree"}).setKey("Intends to\nPoison you"),new Action({enemy:2,heal:10,armor:2,pattern:"threeInThree"}).setKey("Intends to\nApply a buff")],gameState.enemy3.actions=[new Action({enemy:3,turn:1}).setKey("Intends to\nEvacuate Gold"),new Action({enemy:3,turn:2,strength:4}).setKey("Intends to\nApply a buff"),new Action({enemy:3,turn:3,damage:12}).setKey(""),new Action({enemy:3,turn:4,damage:15}).setKey(""),new Action({enemy:3,poison:4,pattern:"oneInThree"}).setKey("Intends to\nPoison you"),new Action({enemy:3,damage:10,pattern:"twoInThree"}).setKey(""),new Action({enemy:3,heal:10,armor:2,pattern:"threeInThree"}).setKey("Intends to\nApply a buff")],gameState.enemies=[gameState.enemy1,gameState.enemy2,gameState.enemy3],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(685),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#a9a9a9"),this.restorePermanents(I),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>q("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>q("discardPile"))),a.forEach((e=>e.on("pointerout",$)))}();const o=async function(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{X(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await r(gameState.enemy1),await r(gameState.player),gameState.startFightObjects.forEach((e=>X(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||i()}(),e.input.keyboard.on("keydown",s,this),e.input.on("pointerup",s,this)};async function r(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(X(r),X(s))))}async function s(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>X(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),i()))}async function i(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,G(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(Y),f()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),2===gameState.turn&&function(){const t={fontSize:"105px",fontWeight:"bold",fill:"#000000"};gameState.countdownTextBox=e.add.image(825,225,"goldCoin").setScale(.18),gameState.countdownText=e.add.text(795,180,"".concat(a),t)}(),gameState.turn>2&&function(){a>0&&(a-=1);a&&gameState.turn>2&&gameState.countdownText.setText("".concat(a));0===a&&(gameState.countdownTextBox.destroy(),gameState.countdownText.destroy(),e.cameras.main.shake(800,.005,!1),a=null)}(),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),l(gameState.player.numCards))}async function l(t){const a=e=>e&&(gameState.drawPile.length||d()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void m(s);const{card:i,cardDepth:l}=g(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>c(i))),o===t-1&&m(s),await e.delay(s)}}async function m(t){await e.delay(2*t),gameState.playersTurn=!0,gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>{e.activate(),console.log("Turn: ".concat(gameState.playersTurn)+". Card.key: "+e.key+". Activate: "+e.isActive)}))}function d(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function g(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function c(t){t.typePlayed=S(t.type),t.costPlayed=t.dBeat?0:S(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&F(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),u(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;u(e,a,o)}))}(e),permanent:()=>I(e),default:()=>{e.discard(),u(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function u(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),X(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),W(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];X(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>O(1),coverCharge:()=>{gameState.player.stancePoints>1&&O(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return K("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),K("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){K(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:S(t.damage),firePlayed:d?3:s?10:S(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:S(t.stancePoints),poisonPlayed:i?a.poison:S(t.poison)+p,healPlayed:S(t.heal),strengthPlayed:S(t.strength),armorPlayed:c?2:S(t.armor),reduceTargetArmorPlayed:g?u:S(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:S(t.reduceTargetStrength),drawCardPlayed:S(t.drawCard),poisonRemovePlayed:S(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(V),f())return;W(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{X(e)}))}))}function S(e){return"function"==typeof e?e():e}function p(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};if(gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats(),1===gameState.turn)return await async function(){const t=1500,a=3e3,n=3e3,o={fontSize:"45px",fill:"#ff0000",fontWeight:"bold"},r={x:825,y:450,z:201},s=.7;await e.delay(t);const i=new TextBox(e,"The Goblins are\nevacuating their gold!",r,o,s);await e.delay(a),i.destroy();const l=new TextBox(e,"Defeat them in\n5 turns to steal\nwhat's left!",r,o,s);await e.delay(n),l.destroy()}(),void i()}t.turnComplete=!1,G(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,r),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:gameState[s],damage:15,probability:.4}).setKey(""),new Action({enemy:gameState[s],damage:17,probability:.2}).setKey(""),new Action({enemy:gameState[s],heal:15,armor:3,probability:.1}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,armor:5,probability:.15}).setKey("Intends to\nApply a buff"),new Action({enemy:gameState[s],heal:10,strength:3,probability:.15}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",h(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",h(t,a)}))}(t,a):a.debuffCard?h(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?V:Y;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>X(e,50))),t.turnComplete=!0,f())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?p():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,i()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,p()))}function h(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function f(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),U(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&X(gameState.actionText,200);gameState.actionTextBackground&&X(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>X(e,200))),gameState.enemies.forEach((e=>X(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;a&&gameState.countdownText&&(console.log("earngoblingold called"),await new Promise((t=>{let n=0;const o=a;for(let r=0;r<o;r++)e.time.delayedCall(200*r,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),a-=1,gameState.goldCounter.setText(gameState.player.gold),gameState.countdownText.setText(a),gameConfig.coinSound.play({volume:.8,seek:.02}),n++,n===o&&(0===a&&(X(gameState.countdownTextBox,250),X(gameState.countdownText,250)),t())}))})));gameState.gundanSeizai&&(O(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const n=Math.floor(.15*gameState.player.gold),o=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,n):0;o&&(O(o),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||o}(),n={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let o=e.add.text(825,450,"Victory!",n).setOrigin(.5).setDepth(21);const{level:r,fight:s}=e.extractLevelFightFromName(e.scene.key),i=3===s?"You have completed Level ".concat(r,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",l=t?1500:1200;await e.delay(l),o.setText(i),o.setStyle({fontSize:"90px"});const m=3===s?3e3:100;await e.delay(m),o.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,y,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",C,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,x,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),U(),X(gameState.actionText,200),X(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>X(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function y(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,O(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function C(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,w,r,s+i*l++),t.shopAddCardButton=new Button(e,n,P,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,B,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",E,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function x(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?k():(e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b())))}function k(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,v,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function v(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(F(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),k(t.depth))}function b(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function w(t){const{isHealEnabled:a}=D(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;A(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,M(n)}function P(t){const{isAddCardEnabled:a}=D(t.addCardCost);a?(A(t.addCardCost,t),k(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function B(t){const{isRemoveCardEnabled:a}=D(t.removeCardCost);a?(A(t.removeCardCost,t),T(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function E(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function A(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),F(e),n.forEach((e=>{e&&e.destroy()}))}function M(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function I(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;K("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof z[a]?z[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return z.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;K("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){K("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>L(1),steelToe2:()=>L(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&R(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;R(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?z.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?H(t,r,s):e.cameras.main.shake(70,.002,!1)}))}o();const z={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,R(e),W(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,R(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,R(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,R(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());K("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),K("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(V),f())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),K("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(V),f())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(V),f()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,R(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&X(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,R(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,O(3),R(e)}(e),depleteLustForLife:e=>function(e){if(R(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;X(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,R(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),R(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));R(e)}(e),depleteEnduringSpirit:e=>R(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),R(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,R(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),W(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(V)})),f()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(V),K("Dealt ".concat(r," Physical Damage!")),f());}(o,t,a,n)}))}))}};function H(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof z[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&K("Permanent depleted."),z[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function L(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function R(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function j(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);F(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));K("Bought ".concat(7," HP"))}function U(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),X(e.sprite,200)}}function K(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function G(e,t){if(!e.poison)return;const a=e.updatePoison();K("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function W(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||d();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&N(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){c(t)}))}))}async function N(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});K("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(V)})),await e.delay(100),f()}function V(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function Y(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;H(t,t.tookenSprite,t.tokenSlot)}function X(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function q(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function $(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>X(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(W(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(V),f(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level2Fight3 extends BaseScene{constructor(){super("Level2Fight3")}preload(){[{key:"bakgrunnForest3",path:"../assets/images/backgrounds/bakgrunnForest3.jpg",loaded:!1},{key:"tree3",path:"../assets/images/sprites/tree3.png",loaded:!1},{key:"rooted",path:"../assets/images/cards/rooted.jpg",loaded:!1},{key:"goblin",path:"../assets/images/sprites/goblin1.png",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnForest3",t),this.resetPlayer(.555,540,545),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),K(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");G("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),h()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),I(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],m(a);G("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",U,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(80,100,110),n={x:840,y:588,health:30,name:"goblin",ID:"enemy2"},o=()=>{var e;return null===(e=gameState.enemy2)||void 0===e?void 0:e.alive};gameState.enemy1=new Enemy("Jubokko Lord",a,0,15,"rooted"),gameState.enemy1.sprite=this.add.image(1170,435,"tree3").setScale(.54).setFlipX(!1),gameState.enemy1.intentionDepth=25,gameState.enemy1.actions=[new Action({enemy:1,turn:1,debuffCard:"doubleDiscard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,turn:2,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:1,turn:3,summonEnemy:n}).setKey("Intends to\nSummon a Goblin"),new Action({enemy:1,turn:4,heal:10}).setKey("Intends\nto Rest"),new Action({enemy:1,turn:5,debuffCard:"discard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,summonEnemy:n,probability:()=>o()?0:1}).setKey("Intends to\nSummon a Goblin"),new Action({enemy:1,damage:16,probability:()=>o()?.35:0}).setKey(""),new Action({enemy:1,damage:20,probability:()=>o()?.15:0}).setKey(""),new Action({enemy:1,heal:10,armor:1,probability:()=>o()?.15:0}).setKey("Intends\nto Rest"),new Action({enemy:1,debuffCard:"discard",probability:()=>o()?.2:0}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,strength:2,probability:()=>o()?.15:0}).setKey("Intends to\nApply a buff")],gameState.enemies=[gameState.enemy1],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(685),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#a9a9a9"),this.restorePermanents(z),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>$("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>$("discardPile"))),a.forEach((e=>e.on("pointerout",Z)))}();async function r(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{q(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await s(gameState.enemy1),await s(gameState.player),gameState.startFightObjects.forEach((e=>q(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",i,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||l()}(),e.input.keyboard.on("keydown",i,this),e.input.on("pointerup",i,this)}async function s(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(q(r),q(s))))}async function i(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>q(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",i,this),e.time.removeAllEvents(),l()))}async function l(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,W(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(X),y()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),m(gameState.player.numCards))}async function m(t){const a=e=>e&&(gameState.drawPile.length||g()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void d(s);const{card:i,cardDepth:l}=c(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>u(i))),o===t-1&&d(s),await e.delay(s)}}async function d(t){await e.delay(2*t),gameState.playersTurn=!0,gameState.buttons.forEach((e=>e.activate())),console.log("Turn: ".concat(gameState.playersTurn)),gameState.currentCards.forEach((e=>e.activate()))}function g(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function c(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function u(t){t.typePlayed=p(t.type),t.costPlayed=t.dBeat?0:p(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&I(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),S(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;S(e,a,o)}))}(e),permanent:()=>z(e),default:()=>{e.discard(),S(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function S(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),q(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),N(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];q(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>F(1),coverCharge:()=>{gameState.player.stancePoints>1&&F(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return G("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),G("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){G(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,S=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:p(t.damage),firePlayed:d?3:s?10:p(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:p(t.stancePoints),poisonPlayed:i?a.poison:p(t.poison)+S,healPlayed:p(t.heal),strengthPlayed:p(t.strength),armorPlayed:c?2:p(t.armor),reduceTargetArmorPlayed:g?u:p(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:p(t.reduceTargetStrength),drawCardPlayed:p(t.drawCard),poisonRemovePlayed:p(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),a===gameState.enemy1&&function(e,t){t!=gameState.player&&t.armor&&e.damageTotal&&t.armorBase--}(t,a);gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(Y),y())return;N(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{q(e)}))}))}function p(e){return"function"==typeof e?e():e}function h(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,W(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,""),gameState[s].sprite=e.add.image(a,n,r).setScale(.25).setAlpha(0).setFlipX(!0),gameState[s].actions=[new Action({enemy:gameState[s],poison:4,probability:.5}).setKey("Intends to\nPoison you"),new Action({enemy:gameState[s],damage:10,probability:.3}).setKey(""),new Action({enemy:gameState[s],heal:10,armor:5,probability:.2}).setKey("Intends to\nApply a buff")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(685),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",f(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",f(t,a)}))}(t,a):a.debuffCard?f(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?Y:X;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>q(e,50))),t.turnComplete=!0,y())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?h():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,l()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,h()))}function f(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function y(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),K(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&q(gameState.actionText,200);gameState.actionTextBackground&&q(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>q(e,200))),gameState.enemies.forEach((e=>q(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(F(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(F(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,C,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",x,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,k,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),K(),q(gameState.actionText,200),q(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>q(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function C(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,F(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function x(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,P,r,s+i*l++),t.shopAddCardButton=new Button(e,n,B,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,E,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",D,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function k(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?T():(e.input.on("pointerup",(()=>w())),e.time.delayedCall(2500,(()=>w())))}function T(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>w())),e.time.delayedCall(2500,(()=>w()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,b,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function b(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(I(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),T(t.depth))}function w(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function P(t){const{isHealEnabled:a}=A(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;M(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,O(n)}function B(t){const{isAddCardEnabled:a}=A(t.addCardCost);a?(M(t.addCardCost,t),T(210),O(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function E(t){const{isRemoveCardEnabled:a}=A(t.removeCardCost);a?(M(t.removeCardCost,t),v(210),O(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function D(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function M(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),I(e),n.forEach((e=>{e&&e.destroy()}))}function O(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function I(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function z(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;G("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof H[a]?H[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return H.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;G("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){G("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>R(1),steelToe2:()=>R(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",U,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&j(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;j(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?H.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?L(t,r,s):e.cameras.main.shake(70,.002,!1)}))}r();const H={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,j(e),N(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,j(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,j(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,j(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());G("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),G("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(Y),y())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),G("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(Y),y())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(Y),y()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,j(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(j(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&q(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,j(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,F(3),j(e)}(e),depleteLustForLife:e=>function(e){if(j(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;q(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,j(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),j(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));j(e)}(e),depleteEnduringSpirit:e=>j(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),j(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,j(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),N(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(Y)})),y()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(Y),G("Dealt ".concat(r," Physical Damage!")),y());}(o,t,a,n)}))}))}};function L(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof H[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&G("Permanent depleted."),H[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function R(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function j(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function U(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);I(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));G("Bought ".concat(7," HP"))}function K(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),q(e.sprite,200)}}function G(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function W(e,t){if(!e.poison)return;const a=e.updatePoison();G("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function N(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||g();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&V(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){u(t)}))}))}async function V(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});G("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(Y)})),await e.delay(100),y()}function Y(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function X(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;L(t,t.tookenSprite,t.tokenSlot)}function q(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function $(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function Z(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>q(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(N(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(Y),y(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level3Fight1 extends BaseScene{constructor(){super("Level3Fight1")}preload(){[{key:"bakgrunnLair1",path:"../assets/images/backgrounds/bakgrunnLair1.jpg",loaded:!1},{key:"theDemonLair",path:"../assets/images/backgrounds/theDemonLair.jpg",loaded:!1},{key:"voidling",path:"../assets/images/sprites/voidling.png",loaded:!1},{key:"demon2",path:"../assets/images/sprites/demon2.png",loaded:!1},{key:"hellFire",path:"../assets/images/cards/hellFire.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnLair1",t),this.resetPlayer(.615,525,525),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),U(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");K("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),p()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),F(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],l(a);K("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(70,75,80);gameState.enemy1=new Enemy("Infernus",a,0,0,"hellFire"),gameState.enemy1.sprite=this.add.image(1260,473,"demon2").setScale(.45).setFlipX(!1);const n=()=>{var e;return null===(e=gameState)||void 0===e||null===(e=e.enemy2)||void 0===e?void 0:e.alive};async function o(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{X(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await r(gameState.enemy1),await r(gameState.player),gameState.startFightObjects.forEach((e=>X(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||i()}(),e.input.keyboard.on("keydown",s,this),e.input.on("pointerup",s,this)}async function r(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(X(r),X(s))))}async function s(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>X(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),i()))}async function i(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,G(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(Y),f()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),l(gameState.player.numCards))}async function l(t){const a=e=>e&&(gameState.drawPile.length||d()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void m(s);const{card:i,cardDepth:l}=g(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>c(i))),o===t-1&&m(s),await e.delay(s)}}async function m(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function d(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function g(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function c(t){t.typePlayed=S(t.type),t.costPlayed=t.dBeat?0:S(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&F(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),u(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;u(e,a,o)}))}(e),permanent:()=>I(e),default:()=>{e.discard(),u(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function u(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),X(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),W(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];X(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>O(1),coverCharge:()=>{gameState.player.stancePoints>1&&O(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return K("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),K("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){K(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:S(t.damage),firePlayed:d?3:s?10:S(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:S(t.stancePoints),poisonPlayed:i?a.poison:S(t.poison)+p,healPlayed:S(t.heal),strengthPlayed:S(t.strength),armorPlayed:c?2:S(t.armor),reduceTargetArmorPlayed:g?u:S(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:S(t.reduceTargetStrength),drawCardPlayed:S(t.drawCard),poisonRemovePlayed:S(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(V),f())return;W(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{X(e)}))}))}function S(e){return"function"==typeof e?e():e}function p(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,G(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:4,pattern:"even"}).setKey("Intends to\nDeal 4 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",h(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",h(t,a)}))}(t,a):a.debuffCard?h(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?V:Y;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>X(e,50))),t.turnComplete=!0,f())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?p():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,i()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,p()))}function h(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function f(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),U(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&X(gameState.actionText,200);gameState.actionTextBackground&&X(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>X(e,200))),gameState.enemies.forEach((e=>X(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(O(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(O(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,y,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",C,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,x,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),U(),X(gameState.actionText,200),X(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>X(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function y(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,O(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function C(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,w,r,s+i*l++),t.shopAddCardButton=new Button(e,n,P,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,B,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",E,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function x(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?k():(e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b())))}function k(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,v,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function v(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(F(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),k(t.depth))}function b(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function w(t){const{isHealEnabled:a}=D(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;A(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,M(n)}function P(t){const{isAddCardEnabled:a}=D(t.addCardCost);a?(A(t.addCardCost,t),k(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function B(t){const{isRemoveCardEnabled:a}=D(t.removeCardCost);a?(A(t.removeCardCost,t),T(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function E(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function A(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),F(e),n.forEach((e=>{e&&e.destroy()}))}function M(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function I(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;K("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof z[a]?z[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return z.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;K("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){K("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>L(1),steelToe2:()=>L(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&R(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;R(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?z.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?H(t,r,s):e.cameras.main.shake(70,.002,!1)}))}gameState.enemy1.actions=[new Action({enemy:1,turn:1,debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,turn:2,damage:15}).setKey(""),new Action({enemy:1,turn:3,heal:10,armor:5,strength:2}).setKey("Intends to\nApply a buff"),new Action({enemy:1,turn:4,damage:15}).setKey(""),new Action({enemy:1,summonEnemy:{x:945,y:555,health:25,name:"voidling",ID:"enemy2"},probability:()=>n()?0:1}).setKey("Intends to\nSummon a Voidling"),new Action({enemy:1,fire:7,probability:()=>n()?.2:0}).setKey("Intends to\nDeal 7 Fire Damage"),new Action({enemy:1,damage:15,probability:()=>n()?.3:0}).setKey(""),new Action({enemy:1,damage:18,probability:()=>n()?.1:0}).setKey(""),new Action({enemy:1,heal:10,armor:3,probability:()=>n()?.1:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,heal:10,strength:2,probability:()=>n()?.15:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,debuffCard:"draw",probability:()=>n()?.15:0}).setKey("Intends to\nApply a debuff")],gameState.enemy2=new Enemy("Voidling",25,0,0,"hellFire"),gameState.enemy2.sprite=this.add.image(945,555,"voidling").setScale(.45).setFlipX(!1),gameState.enemy2.actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:4,pattern:"even"}).setKey("Intends to\nDeal 4 Fire Damage")],gameState.enemies=[gameState.enemy1,gameState.enemy2],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(680),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(I),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>q("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>q("discardPile"))),a.forEach((e=>e.on("pointerout",$)))}(),function(){const t=e.add.image(0,0,"theDemonLair");t.setScale(1.31).setOrigin(.02,0).setDepth(300);const a=o,n={fontSize:"120px",fill:"#ff0000",fontFamily:"Rock Kapak"},r=e.add.text(825,405,"Level 3:",n),s=e.add.text(825,645,"Jigoku Lair",n);[r,s].forEach((e=>e.setDepth(301).setOrigin(.5)));let i=!1;const l=()=>{i||(i=!0,X(t,2e3),X(r,1300),X(s,1300),e.time.delayedCall(500,a))};e.time.delayedCall(4e3,l),e.input.on("pointerup",l),e.input.keyboard.on("keydown",l)}();const z={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,R(e),W(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,R(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,R(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,R(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());K("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),K("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(V),f())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),K("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(V),f())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(V),f()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,R(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&X(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,R(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,O(3),R(e)}(e),depleteLustForLife:e=>function(e){if(R(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;X(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,R(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),R(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));R(e)}(e),depleteEnduringSpirit:e=>R(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),R(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,R(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),W(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(V)})),f()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(V),K("Dealt ".concat(r," Physical Damage!")),f());}(o,t,a,n)}))}))}};function H(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof z[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&K("Permanent depleted."),z[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function L(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function R(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function j(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);F(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));K("Bought ".concat(7," HP"))}function U(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),X(e.sprite,200)}}function K(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function G(e,t){if(!e.poison)return;const a=e.updatePoison();K("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function W(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||d();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&N(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){c(t)}))}))}async function N(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});K("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(V)})),await e.delay(100),f()}function V(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function Y(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;H(t,t.tookenSprite,t.tokenSlot)}function X(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function q(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function $(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>X(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(W(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(V),f(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level3Fight2 extends BaseScene{constructor(){super("Level3Fight2")}preload(){[{key:"bakgrunnLair2",path:"../assets/images/backgrounds/bakgrunnLair2.jpg",loaded:!1},{key:"skeleton1",path:"../assets/images/sprites/skeleton1.png",loaded:!1},{key:"skeleton2",path:"../assets/images/sprites/skeleton2.png",loaded:!1},{key:"voidling",path:"../assets/images/sprites/voidling.png",loaded:!1},{key:"hellFire",path:"../assets/images/cards/hellFire.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnLair2",t),this.resetPlayer(.63,480,533),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),G(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");W("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),f()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),z(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],d(a);W("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.endOfTurnButton=new Button(e,"Heal",K,1350,195,8),gameState.endOfTurnButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.endOfTurnButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(80,100,120);gameState.enemy1=new Enemy("Bonebaron",a,0,0,"hellFire"),gameState.enemy1.sprite=this.add.image(1245,465,"skeleton2").setScale(.525).setFlipX(!1);const n=()=>{var e;return null===(e=gameState)||void 0===e||null===(e=e.enemy2)||void 0===e?void 0:e.alive},o=()=>{var e;return null===(e=gameState)||void 0===e||null===(e=e.enemy3)||void 0===e?void 0:e.alive},r=()=>n()&&o();gameState.enemy1.actions=[new Action({enemy:1,summonEnemy:{x:975,y:557,health:25,name:"voidling",ID:"enemy2"},probability:()=>n()?0:1}).setKey("Intends to\nSummon a Voidling"),new Action({enemy:1,summonEnemy:{x:765,y:557,health:25,name:"voidling",ID:"enemy3"},probability:()=>o()||!n()?0:1}).setKey("Intends to\nSummon a Voidling"),new Action({enemy:1,fire:5,probability:()=>r()?.2:0}).setKey("Intends to\nDeal 5 Fire Damage"),new Action({enemy:1,damage:15,probability:()=>r()?.3:0}).setKey(""),new Action({enemy:1,damage:17,probability:()=>r()?.2:0}).setKey(""),new Action({enemy:1,heal:10,armor:3,probability:()=>r()?.1:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,heal:10,strength:2,probability:()=>r()?.1:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,debuffCard:"draw",probability:()=>r()?.1:0}).setKey("Intends to\nApply a debuff")],gameState.enemies=[gameState.enemy1],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(685),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#808080"),this.restorePermanents(H),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>Z("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>Z("discardPile"))),a.forEach((e=>e.on("pointerout",_)))}();async function s(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{$(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await i(gameState.enemy1),await i(gameState.player),gameState.startFightObjects.forEach((e=>$(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||m()}(),e.input.keyboard.on("keydown",l,this),e.input.on("pointerup",l,this)}async function i(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||($(r),$(s))))}async function l(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>$(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),m()))}async function m(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,N(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(q),C()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),d(gameState.player.numCards))}async function d(t){const a=e=>e&&(gameState.drawPile.length||c()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void g(s);const{card:i,cardDepth:l}=u(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>S(i))),o===t-1&&g(s),await e.delay(s)}}async function g(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function c(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function u(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function S(t){console.log("initiateCardActivation called"),t.typePlayed=h(t.type),t.costPlayed=t.dBeat?0:h(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&z(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){console.log("selectActivationMode called");const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),p(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,console.log("gameState.enemiesLength: "+gameState.enemiesLength),t.forEach(((a,n)=>{const o=n===t.length-1;p(e,a,o)}))}(e),permanent:()=>H(e),default:()=>{e.discard(),p(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function p(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),$(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),V(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];$(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>I(1),coverCharge:()=>{gameState.player.stancePoints>1&&I(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return W("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),W("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){W(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,S=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:h(t.damage),firePlayed:d?3:s?10:h(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:h(t.stancePoints),poisonPlayed:i?a.poison:h(t.poison)+S,healPlayed:h(t.heal),strengthPlayed:h(t.strength),armorPlayed:c?2:h(t.armor),reduceTargetArmorPlayed:g?u:h(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:h(t.reduceTargetStrength),drawCardPlayed:h(t.drawCard),poisonRemovePlayed:h(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(X),C())return;V(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{$(e)}))}))}function h(e){return"function"==typeof e?e():e}function f(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,N(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:4,pattern:"even"}).setKey("Intends to\nDeal 4 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",y(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",y(t,a)}))}(t,a):a.debuffCard?y(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?X:q;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>$(e,50))),t.turnComplete=!0,C())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?f():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,m()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,f()))}function y(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0;const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function C(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),G(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&$(gameState.actionText,200);gameState.actionTextBackground&&$(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>$(e,200))),gameState.enemies.forEach((e=>$(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(I(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(I(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,x,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",k,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,T,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),G(),$(gameState.actionText,200),$(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>$(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function x(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,I(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function k(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,B,r,s+i*l++),t.shopAddCardButton=new Button(e,n,E,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,D,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",A,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function T(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?v():(e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P())))}function v(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,w,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function w(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(z(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),v(t.depth))}function P(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function B(t){const{isHealEnabled:a}=M(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;O(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,F(n)}function E(t){const{isAddCardEnabled:a}=M(t.addCardCost);a?(O(t.addCardCost,t),v(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function D(t){const{isRemoveCardEnabled:a}=M(t.removeCardCost);a?(O(t.removeCardCost,t),b(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function A(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function O(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),z(e),n.forEach((e=>{e&&e.destroy()}))}function F(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function I(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function z(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function H(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;W("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof L[a]?L[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return L.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;W("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){W("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>j(1),steelToe2:()=>j(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",K,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&U(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;U(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?L.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?R(t,r,s):e.cameras.main.shake(70,.002,!1)}))}s();const L={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,U(e),V(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,U(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,U(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,U(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());W("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),W("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(X),C())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),W("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(X),C())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(X),C()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,U(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&$(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,U(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,I(3),U(e)}(e),depleteLustForLife:e=>function(e){if(U(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;$(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,U(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.floor(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),U(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));U(e)}(e),depleteEnduringSpirit:e=>U(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),U(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,U(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),V(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(X)})),C()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(X),W("Dealt ".concat(r," Physical Damage!")),C());}(o,t,a,n)}))}))}};function R(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof L[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&W("Permanent depleted."),L[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function j(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function U(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function K(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);z(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));W("Bought ".concat(7," HP"))}function G(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),$(e.sprite,200)}}function W(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function N(e,t){if(!e.poison)return;const a=e.updatePoison();W("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function V(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||c();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&Y(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){console.log("card.sprite.on( pointerup"),S(t)}))}))}async function Y(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});W("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(X)})),await e.delay(100),C()}function X(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function q(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;R(t,t.tookenSprite,t.tokenSlot)}function $(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function Z(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function _(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>$(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(V(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(X),C(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level3Fight3 extends BaseScene{constructor(){super("Level3Fight3")}preload(){[{key:"bakgrunnLair3",path:"../assets/images/backgrounds/bakgrunnLair3.jpg",loaded:!1},{key:"wraith1",path:"../assets/images/sprites/wraith1.png",loaded:!1},{key:"wraith2",path:"../assets/images/sprites/wraith2.png",loaded:!1},{key:"voidling",path:"../assets/images/sprites/voidling.png",loaded:!1},{key:"hellFire",path:"../assets/images/cards/hellFire.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnLair3",t),this.resetPlayer(.615,525,525),this.addGoldCounter(),this.defineCardSlots();const a=e.adjustForDifficulty(12,13,13);gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),G(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");W("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),f()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),z(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],d(a);W("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.endOfTurnButton=new Button(e,"Heal",K,1350,195,8),gameState.endOfTurnButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.endOfTurnButton)),gameState.buttons.forEach((e=>e.disable()));const n=e.adjustForDifficulty(45,50,60);gameState.enemy1=new Enemy("Kaidanshu",n,0,12,"hellFire"),gameState.enemy1.sprite=this.add.image(1155,458,"wraith2").setScale(.54).setFlipX(!1),gameState.enemy1.intentionDepth=25;const o={x:855,y:555,health:25,name:"voidling",ID:"enemy2"},r=()=>{var e;return null===(e=gameState)||void 0===e||null===(e=e.enemy2)||void 0===e?void 0:e.alive};gameState.enemy1.actions=[new Action({enemy:1,turn:1,debuffCard:"doubleDiscard"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,turn:2,summonEnemy:o}).setKey("Intends to\nSummon a Voidling"),new Action({enemy:1,turn:3,damage:18}).setKey(""),new Action({enemy:1,summonEnemy:o,probability:()=>r()?0:1}).setKey("Intends to\nSummon a Voidling"),new Action({enemy:1,damage:15,probability:()=>r()?.4:0}).setKey(""),new Action({enemy:1,damage:18,probability:()=>r()?.2:0}).setKey(""),new Action({enemy:1,heal:10,strength:1,probability:()=>r()?.1:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,strength:2,probability:()=>r()?.1:0}).setKey("Intends to\nApply a buff"),new Action({enemy:1,debuffCard:"discard",probability:()=>r()?.15:0}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,debuffCard:"doubleDiscard",probability:()=>r()?.05:0}).setKey("Intends to\nApply a debuff")],gameState.enemies=[gameState.enemy1],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(680),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#808080"),this.restorePermanents(H),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>Z("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>Z("discardPile"))),a.forEach((e=>e.on("pointerout",_)))}();async function s(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{$(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await i(gameState.enemy1),await i(gameState.player),gameState.startFightObjects.forEach((e=>$(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||m()}(),e.input.keyboard.on("keydown",l,this),e.input.on("pointerup",l,this)}async function i(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||($(r),$(s))))}async function l(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>$(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),m()))}async function m(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,N(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(q),C()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),1===gameState.turn&&await async function(){e.delay(300);const t={fontSize:"57px",fill:"#ff0000",fontWeight:"bold"},n={x:825,y:420,z:201},o="Kaidanshu start each\nturn with ".concat(a," Armor,\nand lose 1 Armor\nper damage recieved"),r=new TextBox(e,o,n,t,.7);await e.delay(4e3),r.fadeOut()}(),gameState.characters.forEach((e=>e.activateStatsDisplay())),d(gameState.player.numCards))}async function d(t){const a=e=>e&&(gameState.drawPile.length||c()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void g(s);const{card:i,cardDepth:l}=u(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>S(i))),o===t-1&&g(s),await e.delay(s)}}async function g(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function c(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function u(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function S(t){console.log("initiateCardActivation called"),t.typePlayed=h(t.type),t.costPlayed=t.dBeat?0:h(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&z(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){console.log("selectActivationMode called");const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),p(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,console.log("gameState.enemiesLength: "+gameState.enemiesLength),t.forEach(((a,n)=>{const o=n===t.length-1;p(e,a,o)}))}(e),permanent:()=>H(e),default:()=>{e.discard(),p(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function p(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),$(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),V(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];$(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>I(1),coverCharge:()=>{gameState.player.stancePoints>1&&I(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return W("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),W("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){W(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,S=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:h(t.damage),firePlayed:d?3:s?10:h(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:h(t.stancePoints),poisonPlayed:i?a.poison:h(t.poison)+S,healPlayed:h(t.heal),strengthPlayed:h(t.strength),armorPlayed:c?2:h(t.armor),reduceTargetArmorPlayed:g?u:h(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:h(t.reduceTargetStrength),drawCardPlayed:h(t.drawCard),poisonRemovePlayed:h(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);(function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))})(t,o),a.armor>0&&o.damageTotal>0&&(a.armor=Math.max(0,a.armor-o.damageTotal));return a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(X),C())return;V(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{$(e)}))}))}function h(e){return"function"==typeof e?e():e}function f(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const n={x:825,y:450,z:21},o={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",n,o),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),"Kaidanshu"===t.name&&(t.armor=a),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,N(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0;return{attackConditions:t,healConditions:a,buffConditions:n}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:4,pattern:"even"}).setKey("Intends to\nDeal 4 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){gameConfig.powerUpSound.play({volume:.15}),e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(680),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",y(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",y(t,a)}))}(t,a):a.debuffCard?y(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?X:q;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>$(e,50))),t.turnComplete=!0,C())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?f():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,m()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,f()))}function y(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0;const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost}),new Card({key:o,type:"debuff",cost:r.cost})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function C(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),G(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&$(gameState.actionText,200);gameState.actionTextBackground&&$(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>$(e,200))),gameState.enemies.forEach((e=>$(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(I(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(I(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,x,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",k,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,T,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),G(),$(gameState.actionText,200),$(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>$(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function x(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,I(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function k(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,B,r,s+i*l++),t.shopAddCardButton=new Button(e,n,E,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,D,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",A,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function T(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?v():(e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P())))}function v(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,w,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function w(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(z(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),v(t.depth))}function P(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function B(t){const{isHealEnabled:a}=M(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;O(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,F(n)}function E(t){const{isAddCardEnabled:a}=M(t.addCardCost);a?(O(t.addCardCost,t),v(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function D(t){const{isRemoveCardEnabled:a}=M(t.removeCardCost);a?(O(t.removeCardCost,t),b(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function A(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function O(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),z(e),n.forEach((e=>{e&&e.destroy()}))}function F(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function I(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function z(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function H(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;W("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof L[a]?L[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return L.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;W("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){W("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>j(1),steelToe2:()=>j(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",K,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&U(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;U(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?L.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?R(t,r,s):e.cameras.main.shake(70,.002,!1)}))}s();const L={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,U(e),V(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,U(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,U(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,U(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());W("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),W("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(X),C())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),W("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(X),C())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(X),C()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,U(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&$(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,U(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,I(3),U(e)}(e),depleteLustForLife:e=>function(e){if(U(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;$(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,U(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.floor(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),U(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));U(e)}(e),depleteEnduringSpirit:e=>U(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),U(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,U(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),V(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(X)})),C()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(X),W("Dealt ".concat(r," Physical Damage!")),C());}(o,t,a,n)}))}))}};function R(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof L[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&W("Permanent depleted."),L[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function j(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function U(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function K(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);z(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));W("Bought ".concat(7," HP"))}function G(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),$(e.sprite,200)}}function W(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function N(e,t){if(!e.poison)return;const a=e.updatePoison();W("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function V(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||c();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&Y(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){console.log("card.sprite.on( pointerup"),S(t)}))}))}async function Y(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});W("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(X)})),await e.delay(100),C()}function X(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function q(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;R(t,t.tookenSprite,t.tokenSlot)}function $(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function Z(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function _(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>$(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(V(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(X),C(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level4Fight1 extends BaseScene{constructor(){super("Level4Fight1")}preload(){[{key:"bakgrunnFortress1",path:"../assets/images/backgrounds/bakgrunnFortress1.jpg",loaded:!1},{key:"theFortress",path:"../assets/images/backgrounds/theFortress.jpg",loaded:!1},{key:"monster1",path:"../assets/images/sprites/monster1.png",loaded:!1},{key:"monster2",path:"../assets/images/sprites/monster2.png",loaded:!1},{key:"monstrosity",path:"../assets/images/cards/monstrosity.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnFortress1",t),this.resetPlayer(.465,540,563),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),U(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");K("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),p()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),F(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],l(a);K("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(55,60,65);gameState.enemy1=new Enemy("Mong\nSteals Armor",a,0,0,"monstrosity"),gameState.enemy1.sprite=this.add.image(900,548,"monster1").setScale(.34).setFlipX(!1),gameState.enemy1.actions=[new Action({enemy:1,pattern:"oneInFour",stealArmor:2}).setKey("Intends to\nSteal Armor"),new Action({enemy:1,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:1,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,pattern:"fourInFour",damage:12}).setKey("")];const n=e.adjustForDifficulty(60,70,80);async function o(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{X(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await r(gameState.enemy1),await r(gameState.player),gameState.startFightObjects.forEach((e=>X(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||i()}(),e.input.keyboard.on("keydown",s,this),e.input.on("pointerup",s,this)}async function r(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(X(r),X(s))))}async function s(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>X(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",s,this),e.time.removeAllEvents(),i()))}async function i(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,G(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(Y),f()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),1===gameState.turn&&await async function(){e.delay(300);const t=new TextBox(e,"Heads up: Monsters steal\nStrength and Armor!",{x:825,y:450,z:201},{fontSize:"55px",fill:"#ff0000",fontWeight:"bold"},.7);await e.delay(3e3),t.fadeOut()}(),gameState.characters.forEach((e=>e.activateStatsDisplay())),l(gameState.player.numCards))}async function l(t){const a=e=>e&&(gameState.drawPile.length||d()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void m(s);const{card:i,cardDepth:l}=g(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>c(i))),o===t-1&&m(s),await e.delay(s)}}async function m(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function d(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function g(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function c(t){t.typePlayed=S(t.type),t.costPlayed=t.dBeat?0:S(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&F(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),u(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;u(e,a,o)}))}(e),permanent:()=>I(e),default:()=>{e.discard(),u(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function u(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),X(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),W(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];X(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>O(1),coverCharge:()=>{gameState.player.stancePoints>1&&O(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return K("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),K("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){K(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,p=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:S(t.damage),firePlayed:d?3:s?10:S(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:S(t.stancePoints),poisonPlayed:i?a.poison:S(t.poison)+p,healPlayed:S(t.heal),strengthPlayed:S(t.strength),armorPlayed:c?2:S(t.armor),reduceTargetArmorPlayed:g?u:S(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:S(t.reduceTargetStrength),drawCardPlayed:S(t.drawCard),poisonRemovePlayed:S(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(V),f())return;W(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{X(e)}))}))}function S(e){return"function"==typeof e?e():e}function p(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,G(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats();const{attackConditions:n,healConditions:o,buffConditions:r,stealCondition:s}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0,o=e.stealArmor||e.stealStrength;return{attackConditions:t,healConditions:a,buffConditions:n,stealCondition:o}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):s?function(t,a){gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens(),a.stealStrength?(gameState.player.strengthBase-=a.stealStrength,t.strengthBase+=a.stealStrength):a.stealArmor&&(gameState.player.armorBase-=a.stealArmor,t.armorBase+=a.stealArmor)}(t,a):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:5,pattern:"even"}).setKey("Intends to\nDeal 5 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",h(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",h(t,a)}))}(t,a):a.debuffCard?h(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?V:Y;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));const a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;if(await e.delay(a),gameState.actionTextObjects.forEach((e=>X(e,50))),t.turnComplete=!0,f())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?p():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,i()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,p()))}function h(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0}),new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function f(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),U(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&X(gameState.actionText,200);gameState.actionTextBackground&&X(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>X(e,200))),gameState.enemies.forEach((e=>X(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(O(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(O(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,y,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",C,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,x,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),U(),X(gameState.actionText,200),X(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>X(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function y(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,O(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function C(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,w,r,s+i*l++),t.shopAddCardButton=new Button(e,n,P,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,B,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",E,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function x(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?k():(e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b())))}function k(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>b())),e.time.delayedCall(2500,(()=>b()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,v,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function v(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(F(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),k(t.depth))}function b(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function w(t){const{isHealEnabled:a}=D(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;A(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,M(n)}function P(t){const{isAddCardEnabled:a}=D(t.addCardCost);a?(A(t.addCardCost,t),k(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function B(t){const{isRemoveCardEnabled:a}=D(t.removeCardCost);a?(A(t.removeCardCost,t),T(210),M(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function E(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function A(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),F(e),n.forEach((e=>{e&&e.destroy()}))}function M(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function O(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function I(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;K("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof z[a]?z[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return z.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;K("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){K("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>L(1),steelToe2:()=>L(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",j,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&R(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;R(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?z.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?H(t,r,s):e.cameras.main.shake(70,.002,!1)}))}gameState.enemy2=new Enemy("Goh\nSteals Strength",n,0,0,"monstrosity"),gameState.enemy2.sprite=this.add.image(1170,555,"monster2").setScale(.51).setFlipX(!1),gameState.enemy2.actions=[new Action({enemy:2,pattern:"oneInFour",stealStrength:1}).setKey("Intends to\nSteal Strength"),new Action({enemy:2,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:2,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,pattern:"fourInFour",damage:12}).setKey("")],gameState.enemies=[gameState.enemy1,gameState.enemy2],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(690),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(I),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>q("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>q("discardPile"))),a.forEach((e=>e.on("pointerout",$)))}(),function(){const t=e.add.image(0,0,"theFortress");t.setScale(1.31).setOrigin(.02,0).setDepth(300);const a=o,n={fontSize:"120px",fill:"#ff0000",fontFamily:"Rock Kapak"},r=e.add.text(825,405,"Level 4:",n),s=e.add.text(825,645,"The Fortress",n);[r,s].forEach((e=>e.setDepth(301).setOrigin(.5)));let i=!1;const l=()=>{i||(i=!0,X(t,2e3),X(r,1300),X(s,1300),e.time.delayedCall(500,a))};e.time.delayedCall(4e3,l),e.input.on("pointerup",l),e.input.keyboard.on("keydown",l)}();const z={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,R(e),W(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,R(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,R(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,R(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());K("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),K("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(V),f())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),K("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(V),f())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,R(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(V),f()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,R(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&X(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,R(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,O(3),R(e)}(e),depleteLustForLife:e=>function(e){if(R(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;X(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,R(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),R(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));R(e)}(e),depleteEnduringSpirit:e=>R(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),R(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,R(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),W(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(V)})),f()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(V),K("Dealt ".concat(r," Physical Damage!")),f());}(o,t,a,n)}))}))}};function H(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof z[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&K("Permanent depleted."),z[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function L(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function R(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function j(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);F(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));K("Bought ".concat(7," HP"))}function U(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),X(e.sprite,200)}}function K(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function G(e,t){if(!e.poison)return;const a=e.updatePoison();K("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function W(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||d();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&N(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){c(t)}))}))}async function N(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});K("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(V)})),await e.delay(100),f()}function V(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function Y(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;H(t,t.tookenSprite,t.tokenSlot)}function X(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function q(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function $(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>X(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(W(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(V),f(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level4Fight2 extends BaseScene{constructor(){super("Level4Fight2")}preload(){[{key:"bakgrunnFortress2",path:"../assets/images/backgrounds/bakgrunnFortress2.jpg",loaded:!1},{key:"monster3",path:"../assets/images/sprites/monster3.png",loaded:!1},{key:"monster4",path:"../assets/images/sprites/monster4.png",loaded:!1},{key:"sorcerer1",path:"../assets/images/sprites/sorcerer1.png",loaded:!1},{key:"monstrosity",path:"../assets/images/cards/monstrosity.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnFortress2",t),this.resetPlayer(.53,525,560),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),G(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");W("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),f()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),z(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],d(a);W("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",K,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(35,40,45);gameState.enemy1=new Enemy("Gloomhoof\nSteals Armor",a,0,0,"monstrosity"),gameState.enemy1.sprite=this.add.image(870,530,"monster3").setScale(.55).setFlipX(!1);const n=e.adjustForDifficulty(45,50,55);gameState.enemy2=new Enemy("Darktuft\nSteals Strength",n,0,0,"monstrosity"),gameState.enemy2.sprite=this.add.image(1200,525,"monster4").setScale(.6).setFlipX(!0);const o=e.adjustForDifficulty(50,55,60);gameState.enemy3=new Enemy("Ampward",o,0,0,"monstrosity"),gameState.enemy3.sprite=this.add.image(1485,550,"sorcerer1").setScale(.55).setFlipX(!1);const r=()=>{var e,t;return(null===(e=gameState.enemy1)||void 0===e?void 0:e.alive)||(null===(t=gameState.enemy2)||void 0===t?void 0:t.alive)};gameState.enemy1.actions=[new Action({enemy:1,pattern:"oneInFour",stealArmor:2}).setKey("Intends to\nSteal Armor"),new Action({enemy:1,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:1,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,pattern:"fourInFour",damage:12}).setKey("")],gameState.enemy2.actions=[new Action({enemy:2,pattern:"oneInFour",stealStrength:1}).setKey("Intends to\nSteal Strength"),new Action({enemy:2,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:2,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,pattern:"fourInFour",damage:12}).setKey("")],gameState.enemy3.actions=[new Action({enemy:3,pattern:()=>r()?"oneInThree":null,debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:3,pattern:()=>r()?"twoInThree":null,heal:10,teamEffect:!0}).setKey("Intends to\nHeal his team"),new Action({enemy:3,pattern:()=>r()?"threeInThree":null,strength:1,armor:2,teamEffect:!0}).setKey("Intends to\nBuff his team"),new Action({enemy:3,pattern:()=>r()?null:"even",damage:12}).setKey(""),new Action({enemy:3,pattern:()=>r()?null:"odd",damage:15}).setKey("")],gameState.enemies=[gameState.enemy1,gameState.enemy2,gameState.enemy3],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(680),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#303030"),this.restorePermanents(H),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>Z("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>Z("discardPile"))),a.forEach((e=>e.on("pointerout",_)))}();async function s(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{$(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await i(gameState.enemy1),await i(gameState.player),gameState.startFightObjects.forEach((e=>$(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||m()}(),e.input.keyboard.on("keydown",l,this),e.input.on("pointerup",l,this)}async function i(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||($(r),$(s))))}async function l(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>$(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",l,this),e.time.removeAllEvents(),m()))}async function m(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,N(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(q),C()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:480,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.characters.forEach((e=>e.activateStatsDisplay())),d(gameState.player.numCards))}async function d(t){const a=e=>e&&(gameState.drawPile.length||c()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void g(s);const{card:i,cardDepth:l}=u(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>S(i))),o===t-1&&g(s),await e.delay(s)}}async function g(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function c(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function u(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function S(t){t.typePlayed=h(t.type),t.costPlayed=t.dBeat?0:h(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&z(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),p(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;p(e,a,o)}))}(e),permanent:()=>H(e),default:()=>{e.discard(),p(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function p(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),$(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),V(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];$(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>I(1),coverCharge:()=>{gameState.player.stancePoints>1&&I(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return W("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),W("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){W(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,S=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:h(t.damage),firePlayed:d?3:s?10:h(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:h(t.stancePoints),poisonPlayed:i?a.poison:h(t.poison)+S,healPlayed:h(t.heal),strengthPlayed:h(t.strength),armorPlayed:c?2:h(t.armor),reduceTargetArmorPlayed:g?u:h(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:h(t.reduceTargetStrength),drawCardPlayed:h(t.drawCard),poisonRemovePlayed:h(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(X),C())return;V(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{$(e)}))}))}function h(e){return"function"==typeof e?e():e}function f(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:480,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,N(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,a.teamEffect?gameState.enemies.forEach((e=>{e.heal(a.heal),e.gainStrengthAndArmor(a.strength,a.armor),e.updateStats()})):(t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats());const{attackConditions:n,healConditions:o,buffConditions:r,stealCondition:s}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0,o=e.stealArmor||e.stealStrength;return{attackConditions:t,healConditions:a,buffConditions:n,stealCondition:o}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):s?function(t,a){gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens(),a.stealStrength?(gameState.player.strengthBase-=a.stealStrength,t.strengthBase+=a.stealStrength):a.stealArmor&&(gameState.player.armorBase-=a.stealArmor,t.armorBase+=a.stealArmor)}(t,a):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:5,pattern:"even"}).setKey("Intends to\nDeal 5 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",y(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",y(t,a)}))}(t,a):a.debuffCard?y(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?X:q;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));let a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;t.chosenAction.teamEffect&&(a+=500);if(await e.delay(a),gameState.actionTextObjects.forEach((e=>$(e,50))),t.turnComplete=!0,C())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?f():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,m()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,f()))}function y(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0}),new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function C(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),G(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&$(gameState.actionText,200);gameState.actionTextBackground&&$(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>$(e,200))),gameState.enemies.forEach((e=>$(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(I(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(I(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,x,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",k,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,T,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),G(),$(gameState.actionText,200),$(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>$(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function x(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,I(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function k(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,B,r,s+i*l++),t.shopAddCardButton=new Button(e,n,E,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,D,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",A,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function T(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?v():(e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P())))}function v(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>P())),e.time.delayedCall(2500,(()=>P()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,w,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function w(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(z(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),v(t.depth))}function P(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function B(t){const{isHealEnabled:a}=M(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;O(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,F(n)}function E(t){const{isAddCardEnabled:a}=M(t.addCardCost);a?(O(t.addCardCost,t),v(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function D(t){const{isRemoveCardEnabled:a}=M(t.removeCardCost);a?(O(t.removeCardCost,t),b(210),F(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function A(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function O(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),z(e),n.forEach((e=>{e&&e.destroy()}))}function F(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function I(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function z(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function H(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;W("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof L[a]?L[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return L.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;W("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){W("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>j(1),steelToe2:()=>j(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",K,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&U(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;U(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?L.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?R(t,r,s):e.cameras.main.shake(70,.002,!1)}))}s();const L={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,U(e),V(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,U(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,U(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,U(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());W("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),W("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(X),C())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),W("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(X),C())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,U(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(X),C()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,U(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&$(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,U(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,I(3),U(e)}(e),depleteLustForLife:e=>function(e){if(U(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;$(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,U(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),U(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));U(e)}(e),depleteEnduringSpirit:e=>U(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),U(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,U(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),V(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(X)})),C()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(X),W("Dealt ".concat(r," Physical Damage!")),C());}(o,t,a,n)}))}))}};function R(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof L[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&W("Permanent depleted."),L[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function j(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function U(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function K(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);z(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));W("Bought ".concat(7," HP"))}function G(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),$(e.sprite,200)}}function W(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function N(e,t){if(!e.poison)return;const a=e.updatePoison();W("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function V(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||c();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&Y(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){S(t)}))}))}async function Y(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});W("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(X)})),await e.delay(100),C()}function X(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function q(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;R(t,t.tookenSprite,t.tokenSlot)}function $(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function Z(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function _(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>$(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(V(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(X),C(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}class Level4Fight3 extends BaseScene{constructor(){super("Level4Fight3")}preload(){[{key:"bakgrunnFortress3",path:"../assets/images/backgrounds/bakgrunnFortress3.jpg",loaded:!1},{key:"monster5",path:"../assets/images/sprites/monster5.png",loaded:!1},{key:"monster2",path:"../assets/images/sprites/monster2.png",loaded:!1},{key:"sorcerer2",path:"../assets/images/sprites/sorcerer2.png",loaded:!1},{key:"monstrosity",path:"../assets/images/cards/monstrosity.jpg",loaded:!1}].forEach((e=>{this.loadAssetWithRetry(e,"image",1,200)}))}create(){const e=this,t=e.scene.key;this.saveGameState(t),this.baseCreate("bakgrunnFortress3",t,1.2),this.resetPlayer(.495,465,570),this.addGoldCounter(),this.defineCardSlots(),gameState.endOfTurnButton=new Button(e,"End Turn",(async function(){if(gameConfig.targetingCursor.visible||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);gameState.player.depleteMana(),gameState.player.lifeStealThisTurn=0,gameState.currentEnemyIndex=0,gameState.bassSoloPlayed=!1,gameState.buttons.forEach((e=>e.disable())),K(),function(){if(!(gameState.rebelHeart&&gameState.player.health<gameState.player.healthMax&&0!==gameState.player.stancePoints))return;const t=gameState.player.healthMax-gameState.player.health,a=Math.abs(gameState.player.stancePoints),n=a<t?a:t;if(!n)return;gameState.player.heal(n),gameConfig.healSound.play({volume:.5}),e.animatePermanent("rebelHeart");G("Rebel Hearth healed ".concat(n," HP"))}(),await e.delay(50),gameState.actionTextObjects.forEach((e=>e.destroy())),gameState.characters.forEach((e=>e.disableStatsDisplay())),gameState.enemies.forEach((e=>{e.turnComplete=!e.alive,e.fadeOutIntentionText()})),h()}),1350,750),gameState.endOfTurnButton.setPointerText("Press to end your turn"),gameState.redrawButton=new Button(e,"Redraw",(async function(){if(!(gameState.player.gold>=gameState.redrawPrice&&gameState.redrawButton.isActive))return void e.cameras.main.shake(70,.002,!1);gameState.buttons.forEach((e=>e.deactivate())),I(gameState.redrawPrice++);const t="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(t),e.animatePermanent("deadTokugawas");const a=gameState.currentCards.length;gameState.currentCards.forEach((e=>{e.slot.available=!0,e.sprite.destroy(),gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length)})),gameState.currentCards=[],m(a);G("Redrew your hand"),await e.delay(1e3),gameState.buttons.forEach((e=>e.activate()))}),1350,68),gameState.redrawButton.setPointerText("Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold")),gameState.buttons=[gameState.endOfTurnButton,gameState.redrawButton],gameState.lustForLifeCounter>=5&&(gameState.lustForLifeButton=new Button(e,"Heal",U,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),gameState.buttons.push(gameState.lustForLifeButton)),gameState.buttons.forEach((e=>e.disable()));const a=e.adjustForDifficulty(40,45,50);gameState.enemy1=new Enemy("Goh Resurrected\nSteals Armor",a,0,0,"monstrosity"),gameState.enemy1.sprite=this.add.image(870,555,"monster2").setScale(.465).setFlipX(!1);const n=e.adjustForDifficulty(50,55,60);gameState.enemy2=new Enemy("Terrorsnout\nSteals Strength and Armor",n,0,0,"monstrosity"),gameState.enemy2.sprite=this.add.image(1125,555,"monster5").setScale(.72).setFlipX(!1);const o=e.adjustForDifficulty(70,80,90);gameState.enemy3=new Enemy("Necronis\nMaster of fire",o,0,0,"monstrosity"),gameState.enemy3.sprite=this.add.image(1380,530,"sorcerer2").setScale(.35).setFlipX(!1),gameState.enemy1.actions=[new Action({enemy:1,pattern:"oneInFour",stealArmor:2}).setKey("Intends to\nSteal Armor"),new Action({enemy:1,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:1,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:1,pattern:"fourInFour",damage:12}).setKey("")],gameState.enemy2.actions=[new Action({enemy:2,pattern:"oneInFour",stealStrength:1}).setKey("Intends to\nSteal Strength"),new Action({enemy:2,pattern:"twoInFour",damage:12}).setKey(""),new Action({enemy:2,pattern:"threeInFour",debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,pattern:"fourInFour",damage:12}).setKey("")],gameState.enemy3.actions=[new Action({enemy:3,turn:1,debuffCard:"draw"}).setKey("Intends to\nApply a debuff"),new Action({enemy:3,turn:2,strength:2,armor:3,teamEffect:!0}).setKey("Intends to\nBuff team"),new Action({enemy:3,fire:5,pattern:"oneInThree"}).setKey("Intends to\nDeal 5 fire damage"),new Action({enemy:3,heal:10,teamEffect:!0,pattern:"twoInThree"}).setKey("Intends to\nBuff his team"),new Action({enemy:3,fire:7,pattern:"threeInThree"}).setKey("Intends to\nDeal 7 fire damage")],gameState.enemies=[gameState.enemy1,gameState.enemy2,gameState.enemy3],gameState.characters=[...gameState.enemies,gameState.player],gameState.characters.forEach((t=>{t.setScene(this).setSpriteAttributes().addHealthBar().addManaBar().addStatsDisplay(680),e.describeCharacter(t)})),this.addStanceBar(gameState.player,"#a9a9a9"),this.restorePermanents(z),gameState.drawPile=[...gameState.deck],function(){const t={fontSize:"68px",fill:"#000000",fontWeight:"bold"};gameState.drawPileImage=e.add.image(180,900,"deck"),gameState.discardPileImage=e.add.image(1470,900,"deck").setTint(16711680);const a=[gameState.drawPileImage,gameState.discardPileImage];a.forEach((e=>e.setScale(.2).setOrigin(.5,.5).setInteractive())),gameState.drawPileText=e.add.text(180,900,gameState.drawPile.length,t),gameState.discardPileText=e.add.text(1470,900,gameState.discardPile.length,t),[gameState.drawPileText,gameState.discardPileText].forEach((e=>e.setDepth(100).setOrigin(.5,.5))),gameState.drawPileImage.on("pointerover",(()=>$("drawPile"))),gameState.discardPileImage.on("pointerover",(()=>$("discardPile"))),a.forEach((e=>e.on("pointerout",Z)))}();async function r(){gameState.startFightObjects=[],async function(){e.sound.stopAll(),await e.delay(50),gameConfig.music.play({loop:!0,volume:.6,seek:25})}(),await async function(){const t=2300,{level:a,fight:n}=e.extractLevelFightFromName(e.scene.key),o={fontSize:"100px",fill:"#ff0000",fontFamily:"Rock Kapak"},r="Level ".concat(a,"\nFight ").concat(n,"!");gameState.startText=e.add.text(825,480,r,o).setOrigin(.5),gameState.startFightObjects.push(gameState.startText),await e.delay(t),gameState.startText.setText("Fight!"),gameState.startText.setStyle({fontSize:"150px"}),e.time.delayedCall(t,(()=>{q(gameState.startText,500)}))}(),async function(){const t=Math.floor(Math.random()*gameState.taunts.length),a=gameState.taunts.splice(t,1)[0];if(gameState.enemy1.taunt=a.enemy,gameState.player.taunt=a.player,await s(gameState.enemy1),await s(gameState.player),gameState.startFightObjects.forEach((e=>q(e))),gameState.skipIntro)return;await e.delay(200),e.input.keyboard.off("keydown",i,this),e.time.removeAllEvents(),await e.delay(50),gameState.fightStarted||l()}(),e.input.keyboard.on("keydown",i,this),e.input.on("pointerup",i,this)}async function s(t){const a=t.x,n=t.y-300,o=t===gameState.player?100:800;let r=e.add.text(a,n,"",{fontSize:"30px",fill:"#000000"}).setOrigin(.5);const s=e.add.graphics();gameState.startFightObjects.push(r,s),await e.delay(o),gameState.skipIntro||(await async function(t,a,n){return new Promise((o=>{let r=0,s="";const i=301,l=7,m=35,d=()=>{gameState.skipIntro?o():r<n.length?(s+=n.charAt(r),t.setText(s),e.updateTextAndBackground(t,a,s,l,i),r++,e.time.delayedCall(m,d)):o()};d()}))}(r,s,t.taunt),gameState.skipIntro||(await e.delay(1e3),gameState.skipIntro||(q(r),q(s))))}async function i(){gameState.skipIntro||(gameState.skipIntro=!0,gameState.startFightObjects.forEach((e=>q(e))),await e.delay(300),gameState.fightStarted||(e.input.keyboard.off("keydown",i,this),e.time.removeAllEvents(),l()))}async function l(){e.shuffleDeck(gameState.drawPile),gameState.fightStarted=!0,gameState.turn++,W(gameState.player,2e3),gameState.player.updateState(),gameState.player.removeIfDead(X),y()||(gameState.chemicalWarfare&&function(){gameState.enemies.forEach((e=>{e.poison+=gameState.chemicalWarfare}));const t="Enemies get +".concat(gameState.chemicalWarfare," Poison"),a=new TextBox(e,t,{x:810,y:675,z:35},{fontSize:"45px",fill:"#ff0000"});e.time.delayedCall(1500,(()=>a.fadeOut())),e.animatePermanent("chemicalWarfare")}(),gameState.noFutureCondition&&(gameState.player.health-=2),await async function(){const t=new TextBox(e,"Your turn!",{x:825,y:450,z:21},{fontSize:"90px",fill:"#ff0000"}),a=gameState.player.poison&&gameState.player.health?2e3:1500;await e.delay(a),t.fadeOut()}(),gameState.enemies.forEach((e=>{e.selectAction().displayIntention()})),gameState.enemy3.actions.forEach((e=>console.log(e.key))),gameState.characters.forEach((e=>e.activateStatsDisplay())),m(gameState.player.numCards))}async function m(t){const a=e=>e&&(gameState.drawPile.length||g()),n=Math.floor((gameState.slots.length-t)/2);for(let o=0;o<t;o++){const r=gameState.slots[n+o],s=110+7*o;if(!a(r))return t=o+1,void d(s);const{card:i,cardDepth:l}=c(o,n);i.slot=r,i.startHeight=r.y,i.animateDraw(e,s),gameConfig.cardsDealtSound.play({volume:2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),i.animatePointer(e,l),i.sprite.on("pointerup",(()=>u(i))),o===t-1&&d(s),await e.delay(s)}}async function d(t){await e.delay(2*t),gameState.playersTurn=!0,console.log("gameState.playersTurn: ".concat(gameState.playersTurn)),gameState.buttons.forEach((e=>e.activate())),gameState.currentCards.forEach((e=>e.activate()))}function g(){return gameState.discardPile.length?(gameState.drawPile=gameState.discardPile,e.shuffleDeck(gameState.drawPile),gameState.discardPile=[],gameState.discardPileText.setText(gameState.discardPile.length),!0):(console.log("Both draw and discard piles are empty. Cannot continue drawing."),!1)}function c(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=gameState.drawPile.pop();if(n.sprite=e.add.image(180,900,n.key).setScale(0).setInteractive(),gameState.currentCards.push(n),n.usedOneShot&&n.sprite.setTint(8421504),null===a)return n;const o=10+t+a;return n.sprite.setDepth(o),{card:n,cardDepth:o}}function u(t){t.typePlayed=p(t.type),t.costPlayed=t.dBeat?0:p(t.cost),t.isPlayable()?(gameState.player.mana-=t.costPlayed,t.goldCost&&I(t.goldCost),t.slot&&(t.slot.available=!0),t.oneShot&&(t.usedOneShot=!0),t.dBeat&&delete t.dBeat,t.usesTillDepletion&&t.usesTillDepletion--,gameState.redrawButton.disable(),gameState.player.updateManaBar(),t.isBeingPlayed=!0,gameState.currentCards=gameState.currentCards.filter((e=>e!==t)),gameState.player.freedomBeforeCardPlayed="Freedom"===gameState.player.stance,console.log("activated card: ".concat(t.key,"\nCost: ").concat(t.costPlayed)),function(e){const t={targetSelected:()=>function(e){gameConfig.targetingCursor.setVisible(!0),gameState.thisTurn=gameState.turn,gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.removeInteractive()})),gameState.enemies.forEach((t=>{t.sprite.on("pointerup",(()=>function(e,t){t.sprite.off("pointerup");const a=()=>e.isBeingPlayed&&gameState.playersTurn&&gameState.thisTurn===gameState.turn;if(!a())return;e.discard(),S(e,t),gameState.currentCards.forEach((e=>{e.sprite&&e.sprite.scene&&e.sprite.setInteractive()}))}(e,t)))}))}(e),targetAll:()=>function(e){e.discard();const t=[...gameState.enemies];gameState.enemiesLength=t.length,t.forEach(((a,n)=>{const o=n===t.length-1;S(e,a,o)}))}(e),permanent:()=>z(e),default:()=>{e.discard(),S(e,gameState.player)}};(t[e.typePlayed]||t.default)()}(t)):e.cameras.main.shake(70,.002,!1)}async function S(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];gameConfig.targetingCursor.setVisible(!1),t.fadeOut(e,200),gameState.actionTextObjects.forEach((e=>e.destroy()));const o=function(t,a,n){!function(t,a){const n={dBeat:()=>function(){const t=gameState.discardPile.filter((e=>"dBeat"!=e.key));if(!t.length)return;const a=[],n=t.length,o=n>32?10:n>24?8:n>12?6:4,r=158,s=n>32?117:n>24?275:n>12?431:590,i=225,l=(t,n)=>{gameState.player.stancePoints>0&&(t.dBeat=!0),q(n,300),e.time.delayedCall(400,(()=>{a.forEach((e=>e.destroy())),gameState.discardPile.splice(gameState.discardPile.indexOf(t),1),gameState.drawPile.push(t),N(1)}))};t.forEach(((t,n)=>{let m=s+n%o*r,d=i+1.5*Math.floor(n/o)*r,g=e.add.image(m,d,t.key).setScale(.41).setDepth(200).setInteractive();a.push(g),g.on("pointerover",(()=>g.setScale(.43).setDepth(201))),g.on("pointerout",(()=>g.setScale(.41).setDepth(200))),g.on("pointerup",(()=>{l(t,g)}))}))}(),bassSolo:()=>function(){if(!gameState.currentCards.length||gameState.bassSoloPlayed)return;gameState.bassSoloPlayed=!0;const e=Math.floor(Math.random()*gameState.currentCards.length),t=gameState.currentCards[e];q(t.sprite,250),gameState.currentCards=gameState.currentCards.filter((e=>e!=t)),t.isType("debuff")||gameState.discardPile.push(t);gameState.player.gainMana(t.cost)}(),nenguStyle:()=>F(1),coverCharge:()=>{gameState.player.stancePoints>1&&F(1)},pissDrunkBastards:()=>function(e){if(e.health>=18)return;gameState.score.damageDealt+=e.health,e.health=0}(t),canibalize:()=>(gameState.player.lifeStealThisTurn+=.2,gameConfig.powerUpSound.play({volume:.15}),void gameState.player.powerUpTweens()),zenZine:()=>gameState.player.increaseHealthMax(2*a.costPlayed),bloodOath:()=>(gameState.player.manaMax++,gameState.player.manaBase++,gameState.player.health-=6,gameState.player.updateManaBar(),void(gameState.player.health&&(gameConfig.powerUpSound.play({volume:.15}),gameState.player.powerUpTweens()))),libertySpikes:()=>function(){if(gameState.player.stancePoints<=0)return;gameState.player.mana++,gameState.player.manaMax++,gameConfig.powerUpSound.play({volume:.15}),gameState.player.updateManaBar(),gameState.player.powerUpTweens()}(),noFuture:()=>(gameState.noFutureCondition=!0,void gameState.player.increaseHealthMax(5)),riotRonin:()=>function(e,t){e.goldCost++,t.chosenAction=new Action({enemy:t,skip:!0}).setKey("Intends to\nSkip a Turn")}(a,t),hellFire:()=>gameState.player.sufferDebuffDamage(2),circlePit:()=>{a.fire=4*a.costPlayed},satomiSubterfuge:()=>function(e){if(!gameState.bonusPermanentSlots.length)return G("Maximum number of Permanent Slots Reached"),gameState.player.gold+=e.goldCost,void gameState.goldCounter.setText(gameState.player.gold);e.goldCost++;const t=gameState.bonusPermanentSlots.shift();t.singleFight=!0,gameState.permanentSlots.push(t),G("Gained 1 Permanent Slot this fight")}(a)};a.key in n&&n[a.key]();if(a.usesTillDepletion>=0){G(a.usesTillDepletion>0?"Remaining uses: ".concat(a.usesTillDepletion):"Card depleted!")}}(a,t);const o=function(t,a){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=gameState.player.stancePoints,r="moshpitMassacre"===t.key&&o>0&&a.poison>0,s="scorchedSoul"===t.key&&a.poison>0,i="bladesBlight"===t.key&&a.poison>0,l="rottenResonance"===t.key&&0===a.poison,m="roninsRot"===t.key&&a.poison>0,d="kabutu"===t.key&&gameState.edoEruption&&o>0,g="combatBoots"===t.key&&gameState.steelToeCount,c="knuckleFist"===t.key&&gameState.edoEruption&&o<0;gameState.troopsOfTakamoriCondition="troopsOfTakamori"===t.key;const u=o>0?gameState.steelToeCount+o+1:gameState.steelToeCount+1,S=l?1:0;(c||d)&&e.animatePermanent("edoEruption");g&&e.animatePermanent("steelToe");return{damagePlayed:r?11:p(t.damage),firePlayed:d?3:s?10:p(t.fire),stancePointsPlayed:d&&n?-1:d&&!n?0:p(t.stancePoints),poisonPlayed:i?a.poison:p(t.poison)+S,healPlayed:p(t.heal),strengthPlayed:p(t.strength),armorPlayed:c?2:p(t.armor),reduceTargetArmorPlayed:g?u:p(t.reduceTargetArmor),reduceTargetStrengthPlayed:m?a.poison:p(t.reduceTargetStrength),drawCardPlayed:p(t.drawCard),poisonRemovePlayed:p(t.poisonRemove),lifeStealPlayed:gameState.player.lifeStealBase+gameState.player.lifeStealThisTurn}}(t,a,n);o.damageModifier=(1+.1*gameState.player.strength)*(1-a.armor/20);const r=o.firePlayed+o.damagePlayed*o.damageModifier;o.damageTotal=Math.round(Math.max(0,r));const{isBuffPlayed:s,isAttackPlayed:i}=function(e,t){const a=e,n=a.healPlayed||a.strengthPlayed||a.armorPlayed||a.poisonRemovePlayed,o=t===gameState.player,r=!o&&(a.damageTotal||a.reduceTargetStrengthPlayed||a.reduceTargetArmorPlayed||a.poisonPlayed);return{isBuffPlayed:n,isAttackPlayed:r}}(o,a);s&&function(e,t){const{strengthPlayed:a,armorPlayed:n,poisonRemovePlayed:o,healPlayed:r}=e;gameState.player.powerUpTweens(),gameState.player.heal(r,o),gameState.player.buff(t.key,a,n);const s=o||r?.5:.15;gameConfig[o||r?"healSound":"powerUpSound"].play({volume:s})}(o,t);i&&function(t,a){e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8}),gameState.player.attackTweens(60),gameState.score.damageDealt+=t.damageTotal,console.log("".concat(t.damagePlayed," Physical Damage and ").concat(t.firePlayed," Fire Damage was dealt to ").concat(a.name)),a.sufferAttackEffect(t),gameState.player.incrementLifeStealCounter(t)}(o,a);return function(t,a){const n={fontSize:"48px",fill:"#ff0000"};let o=e.add.text(825,450,"",n).setOrigin(.5).setDepth(21),r=e.add.graphics();const s=[];gameState.actionTextObjects.push(o,r);const{damageTotal:i,poisonPlayed:l,strengthPlayed:m,armorPlayed:d,poisonRemovePlayed:g,healPlayed:c}=a;t.text&&s.push(t.text);i&&s.push("Deals ".concat(i," damage"));l&&s.push("Deals ".concat(l," Poison"));m&&s.push("Gains ".concat(m," Strength"));d&&s.push("Gains ".concat(d," Armor"));c&&s.push("Heals ".concat(c," HP"));g&&s.push("Heals ".concat(g," Poison"));s.length||s.push("Card activated");e.updateTextAndBackground(o,r,s.join("\n"))}(t,o),a.updateStats(),a.updateHealthBar(),gameState.player.updateStanceAfterCard(o),gameState.player.updateStats(),o}(t,a,n);if(a.removeIfDead(Y),y())return;N(o.drawCardPlayed),gameState.enemies.forEach((e=>e.updateIntention())),await e.delay(260);const r=[...gameState.actionTextObjects];e.time.delayedCall(1200,(()=>{r.forEach((e=>{q(e)}))}))}function p(e){return"function"==typeof e?e():e}function h(){0!==gameState.enemies.length&&(gameState.enemies[gameState.currentEnemyIndex].alive?async function(t){if(gameState.playersTurn){gameState.playersTurn=!1;const t={x:825,y:450,z:21},a={fontSize:"90px",fill:"#ff0000"};gameState.enemyTurnText=new TextBox(e,"Enemy's turn!",t,a),e.time.delayedCall(1500,(()=>gameState.enemyTurnText.fadeOut(50))),function(){if(!gameState.player.lifeStealCounter)return;const t=gameState.player,a=()=>{const e=Math.floor(t.lifeStealCounter);return t.health+e<t.healthMax?e:t.healthMax-t.health};if(!a())return;t.heal(a()),gameConfig.healSound.play({volume:.5}),e.animatePermanent("soulSquatter");const n="You stole ".concat(a()," HP"),o={fontSize:"45px",fill:"#ff0000"},r={x:825,y:570,z:21},s=new TextBox(e,n,r,o);e.time.delayedCall(1500,(()=>s.fadeOut(50)))}(),gameState.player.lifeStealCounter=0,gameState.player.updateStats()}t.turnComplete=!1,W(t,1500),function(){const t={fontSize:"48px",fill:"#ff0000"};gameState.actionText=e.add.text(825,450,"",t).setOrigin(.5).setDepth(21),gameState.actionTextBackground=e.add.graphics(),gameState.actionTextObjects.push(gameState.actionText,gameState.actionTextBackground)}(),async function(t){await e.delay(function(){let e=gameState.enemyTurnText&&gameState.enemyTurnText.isDisplayed?1500:350;return gameState.debuffCardPlayed?e+=1e3:e}()),t.chosenAction.updateDamage();const a=t.chosenAction;gameState.player.poison+=a.poison,a.teamEffect?gameState.enemies.forEach((e=>{e.heal(a.heal),e.gainStrengthAndArmor(a.strength,a.armor),e.updateStats()})):(t.heal(a.heal),t.gainStrengthAndArmor(a.strength,a.armor),t.updateStats());const{attackConditions:n,healConditions:o,buffConditions:r,stealCondition:s}=function(e){const t=e.damage>0||e.fire>0||e.poison>0,a=e.heal>0,n=e.strength>0||e.armor>0,o=e.stealArmor||e.stealStrength;return{attackConditions:t,healConditions:a,buffConditions:n,stealCondition:o}}(a);n?function(t,a){e.cameras.main.shake(120,.005,!1),gameConfig.attackSound.play({volume:.8}),t.damageTotal=Math.round(Math.max(0,a.fire+a.damage)),console.log("enemy.damageTotal: ".concat(t.damageTotal)),gameState.player.health-=t.damageTotal,gameState.score.damageTaken+=t.damageTotal;let n=a.poison>0?a.text:"Deals ".concat(t.damageTotal," damage");e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,n);const o=-60;t.attackTweens(o)}(t,a):o?(gameConfig.healSound.play({volume:.5}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):r?(gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.powerUpTweens()):s?function(t,a){gameConfig.powerUpSound.play({volume:.2}),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text),t.gainStrengthAndArmor(a.stealStrength,a.stealArmor),t.powerUpTweens(),a.stealStrength?gameState.player.strengthBase-=a.stealStrength:a.stealArmor&&(gameState.player.armorBase-=a.stealArmor)}(t,a):a.skip?e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,a.text):a.summonEnemy&&function(t){const{x:a,y:n,health:o,name:r,ID:s}=t,i=r.charAt(0).toUpperCase()+r.slice(1);gameState[s]=new Enemy(i,o,0,0,"hellFire"),gameState[s].sprite=e.add.image(a,n,r).setScale(.45).setAlpha(0).setFlipX(!1),gameState[s].actions=[new Action({enemy:2,debuffCard:"draw",pattern:"odd"}).setKey("Intends to\nApply a debuff"),new Action({enemy:2,fire:5,pattern:"even"}).setKey("Intends to\nDeal 5 Fire Damage")];let l="Summons a ".concat(r);e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,l),function(t,a){e.tweens.add({targets:t.sprite,alpha:1,ease:"Power1",duration:a,onComplete:function(){console.log("fade-in complete"),t.setScene(e).setSpriteAttributes().addHealthBar().addStatsDisplay(705),e.describeCharacter(t),gameState.summonedEnemies.push(t)}},e)}(gameState[s],500)}(a.summonEnemy);(function(t,a){"doubleDiscard"===a.debuffCard?async function(t,a){a.debuffCard="discard",f(t,a),a.debuffCard="doubleDiscard",await e.delay(2200),e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,""),e.time.delayedCall(400,(()=>{a.debuffCard="discard",f(t,a)}))}(t,a):a.debuffCard?f(t,a):gameState.debuffCardPlayed=!1})(t,a),t.strengthTurn=0,async function(t){[gameState.player,t].forEach((e=>{const a=()=>e===t?Y:X;e.updateHealthBar(),e.removeIfDead(a),e.updateStats()}));let a="doubleDiscard"===t.chosenAction.debuffCard?4200:gameState.debuffCardPlayed?1800:900;t.chosenAction.teamEffect&&(a+=500);if(await e.delay(a),gameState.actionTextObjects.forEach((e=>q(e,50))),t.turnComplete=!0,y())return;!gameState.enemies[gameState.currentEnemyIndex].turnComplete&&gameState.enemies[gameState.currentEnemyIndex].alive||(gameState.currentEnemyIndex++,gameState.currentEnemyIndex<gameState.enemies.length?h():(gameState.currentEnemyIndex=0,gameState.summonedEnemies.forEach((e=>{e.alive&&!gameState.enemies.includes(e)&&(gameState.enemies.unshift(e),gameState.characters.unshift(e))})),await e.delay(150),gameState.debuffCardPlayed=!1,l()))}(t)}(t)}(gameState.enemies[gameState.currentEnemyIndex]):(gameState.currentEnemyIndex++,h()))}function f(t,a){return new Promise((async n=>{t.attackTweens(-60),gameConfig.attackSound.play({volume:.8}),gameState.debuffCardPlayed=!0,console.log("insertDebuffCard called");const o=t.debuffKey,r=gameConfig.debuffCards[o];let s=0;const i="draw"===a.debuffCard?gameState.drawPile:gameState.discardPile,l="draw"===a.debuffCard?"Draw pile":"Discard Pile",m=[new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0}),new Card({key:o,type:"debuff",cost:r.cost,strength:-1,armor:-2,reUseable:!0,drawCard:()=>gameState.player.stancePoints>0?1:0})];m.forEach((t=>t.sprite=e.add.image(675+300*s++,675,o).setOrigin(.5))),m.forEach((e=>e.configure(.68,450))),i.push(...m);let d="Adds 2 ".concat(r.name," to your ").concat(l);gameState.actionText.y=225,e.updateTextAndBackground(gameState.actionText,gameState.actionTextBackground,d);let g=0;const c="draw"===a.debuffCard?180:1470;await e.delay(2300),m.forEach((t=>{e.tweens.add({targets:t.sprite,x:c,y:900,scaleX:0,scaleY:0,ease:"Cubic",duration:600,onComplete:function(){t.fadeOut(e,100),gameState.discardPileText.setText(gameState.discardPile.length),gameState.drawPileText.setText(gameState.drawPile.length),g++,g===m.length&&n()}})}))}))}function y(){return gameState.player.alive?!gameState.enemies.some((e=>e.alive))&&(gameState.playersTurn=!1,async function(){gameState.score.numberOfTurns+=gameState.turn,gameState.score.levelsCompleted++,gameConfig.music.stop(),gameState.player.updateManaBar(),e.addTokensToDeck(),K(),gameState.deck.forEach((e=>e.reset())),gameState.actionText&&q(gameState.actionText,200);gameState.actionTextBackground&&q(gameState.actionTextBackground,200);gameState.actionTextObjects.forEach((e=>q(e,200))),gameState.enemies.forEach((e=>q(e.sprite,200))),e.time.delayedCall(250,(()=>e.clearBoard())),await e.delay(400),gameConfig.attackSound.isPlaying&&gameConfig.attackSound.stop();await e.delay(200),gameConfig.victorySound.play({volume:.8,rate:1,seek:.05}),await e.delay(750),gameConfig.musicTheme.play({loop:!0,volume:.6,seek:44.4}),await e.delay(300);const t=await async function(){let t=0;gameState.gundanSeizai&&(F(1),e.animatePermanent("gundanSeizai"),t=200);await e.delay(t);const a=Math.floor(.15*gameState.player.gold),n=gameState.zaibatsuMax?Math.min(gameState.zaibatsuMax,a):0;n&&(F(n),e.animatePermanent("zaibatsuU"));return gameState.gundanSeizai||n}(),a={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};let n=e.add.text(825,450,"Victory!",a).setOrigin(.5).setDepth(21);const{level:o,fight:r}=e.extractLevelFightFromName(e.scene.key),s=3===r?"You have completed Level ".concat(o,"\nHealth is resorted to ").concat(gameState.player.healthMax,"/").concat(gameState.player.healthMax):"",i=t?1500:1200;await e.delay(i),n.setText(s),n.setStyle({fontSize:"90px"});const l=3===r?3e3:100;await e.delay(l),n.destroy(),function(){const t=e.extractLevelFightFromName(e.scene.key);t.goldAmount=3===t.fight?5:3,gameState.goldCollected=!1,function(t){const{level:a,fight:n}=t,o="Collect loot and get\nready for Level ".concat(a+1,"!"),r="  Collect loot and get\nready for your next fight!",s=3===n?o:r,i={fontSize:"60px",fill:"#ff0000"},l={x:825,y:180,z:103};t.gameOverText=new TextBox(e,s,l,i)}(t);const a="Collect ".concat(t.goldAmount," Gold"),n=gameState.deck.length<gameConfig.maxDeckSize?"Collect free card\n  and continue":"Maximum deck size\n    continue",o=825,r=375,s=150;let i=0;t.rewardCollectGoldButton=new Button(e,a,C,o,r+s*i++,103),t.enterShopButton=new Button(e,"Enter Shop",x,o,r+s*i++,103),t.rewardAddCardsButton=new Button(e,n,k,o,r+s*i++,103),t.rewardButtons=[t.rewardCollectGoldButton,t.enterShopButton,t.rewardAddCardsButton],t.rewardButtons.forEach((e=>{e.activate().setScale(1.3,1).updateFont(24).setHandlerArg(t)})),t.gameOverObjects=[...t.rewardButtons,t.gameOverText]}()}(),!0):(gameState.playersTurn=!1,async function(){gameState.player.health=0,gameState.player.updateManaBar(),K(),q(gameState.actionText,200),q(gameState.actionTextBackground,200),gameState.actionTextObjects.forEach((e=>q(e,200))),gameConfig.music.stop(),gameState.buttons.forEach((e=>e.destroy())),gameState.score.numberOfTurns+=gameState.turn;const t={fontSize:"150px",fill:"#ff0000",fontFamily:"Rock Kapak"};gameState.gameOverText=e.add.text(825,450,"Defeat!",t).setOrigin(.5),gameState.gameOverText.setInteractive();let a=!1;await e.delay(400),gameConfig.musicTheme.play({loop:!0,volume:.3});const n=()=>{a||(a=!0,e.scene.start("Endscene"))};gameState.gameOverText.on("pointerup",(()=>n())),e.time.delayedCall(2400,(()=>n()))}(),!0)}function C(t){gameState.goldCollected?e.cameras.main.shake(50,.0015,!1):(gameState.goldCollected=!0,F(t.goldAmount),t.rewardCollectGoldButton.setPointerText("Gold has allready been collected"))}function x(t){t.rewardButtons.forEach((e=>e.disable())),async function(t){e.cameras.main.shake(100,.0015,!1),e.cameras.main.flash(350),gameState.shopButtonPressed=!1;const a={victoryElements:t,buyTexts:[],shopSprites:[]};await e.delay(150),gameState.shopBackground=e.add.image(0,0,"shop1").setScale(1.275).setInteractive().setOrigin(.02,0).setDepth(200),function(t){t.healAmount=8,t.healCost=e.adjustForDifficulty(1,2,2),t.addCardCost=2,t.removeCardCost=2,t.textConfig={fontSize:"75px",fill:"#ff0000"};const a=" Gain ".concat(t.healAmount," HP\nCost: ").concat(t.healCost," Gold"),n=" Buy 1 Card\nCost: ".concat(t.addCardCost," Gold"),o="Deplete 1 card\n Cost: ".concat(t.removeCardCost," Gold"),r=255,s=410,i=130;let l=0;t.shopHealButton=new Button(e,a,P,r,s+i*l++),t.shopAddCardButton=new Button(e,n,B,r,s+i*l++),t.shopRemoveCardButton=new Button(e,o,E,r,s+i*l++),t.shopExitButton=new Button(e,"Exit Shop",D,r,s+i*l++),t.shopButtons=[t.shopHealButton,t.shopExitButton,t.shopAddCardButton,t.shopRemoveCardButton],t.shopButtons.forEach((e=>{e.activate().setScale(1.35,.9).setHandlerArg(t)})),t.shopSprites.push(...t.shopButtons,...t.buyTexts);const{level:m,fight:d}=e.extractLevelFightFromName(e.scene.key);"3"===d&&(shopHealButton.diable(),t.levelComplete=!0,shopHealButton.on("pointerover",(function(){const{level:t,_:a}=e.extractLevelFightFromName(e.scene.key),n={fontSize:"38px",fill:"#000000"},o={x:855,y:420,z:26},r="Health was reset to Max Health\n  Upon completion of Level ".concat(t);gameState.healthResetText=new TextBox(e,r,o,n)})),shopHealButton.on("pointerout",(()=>{shopHealButton.setTexture("rectangularButton"),gameState.healthResetText&&gameState.healthResetText.destroy()})),t.shopButtons.shift())}(a),function(){const t="Welcome to my shop,\n".concat(gameState.player.name,"!"),a={fontSize:"60px",fill:"#000000"};let n="";const o=50;gameState.shopWelcomeText=e.add.text(825,90,n,a).setOrigin(.5),gameState.shopTextBackground=e.add.graphics();for(let a=0;a<t.length;a++)e.time.delayedCall(a*o,(()=>{try{if(!gameState.shopWelcomeText)return;n+=t.charAt(a),gameState.shopWelcomeText.setText(n),e.updateTextAndBackground(gameState.shopWelcomeText,gameState.shopTextBackground,n,7,201)}catch(e){return}}))}(),a.shopSprites.push(gameState.shopWelcomeText,gameState.shopTextBackground,gameState.shopBackground)}(t)}function k(t){gameState.endGameMenyExited=!0,t.rewardButtons.forEach((e=>e.setDepth(1))),t.gameOverObjects.forEach((e=>e.destroy())),gameState.deck.length<gameConfig.maxDeckSize?T():(e.input.on("pointerup",(()=>w())),e.time.delayedCall(2500,(()=>w())))}function T(){var t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:102;e.shuffleDeck(gameState.bonusCards);let n=gameState.bonusCards.splice(0,3);null===(t=gameState.latestDraw)||void 0===t||t.forEach((e=>{gameState.bonusCards.push(e)})),gameState.latestDraw=[...n],n.forEach(((t,o)=>{t.sprite=e.add.image(510+315*o,510,t.key),function(t,a,n){const o=.68,r=.87,s=200;a.activate().configure(o,n),a.sprite.on("pointerover",(()=>{a.resize(e,r,s)}),e),a.sprite.on("pointerout",(()=>{a.resize(e,o,2*s)}),e),a.sprite.on("pointerup",(()=>{!function(t,a){gameState.nextlevelstarting=!1,a.center(e);const n=new Card(a);gameState.deck.push(n),t.forEach((t=>{t.disable(),t!==a&&t.fadeOut(e,200)}));const o=gameState.deck.filter((e=>e.key===a.key)).length>=gameConfig.maxCardExemplars,r="permanent"===a.type;(o||r)&&(gameState.latestDraw=gameState.latestDraw.filter((e=>e!==a)));gameState.redrawCardsButton&&gameState.redrawCardsButton.destroy();const s=new TextBox(e,"Gained 1 card",{x:825,y:270,z:211},{fontSize:"60px",fill:"#000000"});if(!gameState.endGameMenyExited)return void async function(t,a){t.fadeOut(),e.time.delayedCall(1e3,(()=>a.fadeOut(e,500))),await e.delay(1500),gameState.shopButtonPressed&&(gameState.shopButtonPressed=!1)}(s,a);e.input.on("pointerup",(()=>w())),e.time.delayedCall(2500,(()=>w()))}(t,a)}))}(n,t,a)})),function(t,a,n){const o=202,r={y:t,redrawCost:a,bonusCards:n,depth:o},s="   Redraw\nCost: ".concat(a," Gold");gameState.redrawCardsButton=new Button(e,s,b,825,t+330,o),gameState.redrawCardsButton.activate().setScale(1.6,1.2).updateFont(35).setHandlerArg(r)}(510,1,n)}function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:220;const a=gameState.deck.length<12?4:6,n=gameState.deck.length<12?600:375;gameState.deck.forEach(((o,r)=>{let s=n+r%a*180,i=375+180*Math.floor(r/a),l=t+r;o.sprite=e.add.image(s,i,o.key),o.isActive&&o.disable(),o.configure(.38,l).activate(),o.sprite.on("pointerover",(function(){gameConfig.cardsDealtSound.play({volume:.6}),e.cardTweens(o.sprite,.55,200),o.sprite.setDepth(250)}),this),o.sprite.on("pointerout",(function(){e.cardTweens(o.sprite,.38,400),o.sprite.setDepth(l)}),this),o.sprite.on("pointerup",(function(){!function(t){console.log("Deck length before removal: ".concat(gameState.deck.length)),gameState.deck=gameState.deck.filter((e=>e!==t)),t.center(e).disable(),e.time.delayedCall(600,(()=>t.fadeOut(e))),gameState.deck.forEach((t=>{t.disable().fadeOut(e)}));const a=new TextBox(e,"Removed 1 card",{x:825,y:270,z:210},{fontSize:"60px",fill:"#000000"});gameState.shopButtonPressed=!1,e.time.delayedCall(1e3,(()=>a.destroy()))}(o)}))}))}function b(t){gameState.player.gold<t.redrawCost?e.cameras.main.shake(50,.0015,!1):(I(t.redrawCost),gameState.redrawCardsButton.destroy(),t.bonusCards.forEach((t=>t.fadeOut(e,50))),T(t.depth))}function w(){if(gameState.nextlevelstarting)return;let t;gameState.nextlevelstarting=!0,e.updatePermanentSlots();for(let a=0;a<gameConfig.levels.length;a++)if(e.scene.key===gameConfig.levels[a]){t=a+1<gameConfig.levels.length?gameConfig.levels[a+1]:"Endscene";break}t?(e.cameras.main.fadeOut(1e3),e.time.delayedCall(1e3,(()=>{e.scene.start(t)}))):console.error("Current level not found in gameConfig.levels")}function P(t){const{isHealEnabled:a}=A(t.healCost,t.levelComplete);if(!a)return void e.cameras.main.shake(50,.0015,!1);let{shopButtons:n,healCost:o,healAmount:r,textConfig:s,buyTexts:i,shopSprites:l}=t;M(o,t),gameState.player.health=Math.min(gameState.player.healthMax,gameState.player.health+r);const m="".concat(gameState.player.health,"/").concat(gameState.player.healthMax),d="    You bought ".concat(r," HP\nTotal health: ").concat(m),g=new TextBox(e,d,{x:825,y:225,z:205},s);i.push(g),l.push(g),e.time.delayedCall(2e3,(()=>{g&&(i=i.filter((e=>e!=g)),l=l.filter((e=>e!=g)),g.fadeOut())})),gameState.shopButtonPressed=!1,O(n)}function B(t){const{isAddCardEnabled:a}=A(t.addCardCost);a?(M(t.addCardCost,t),T(210),O(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}function E(t){const{isRemoveCardEnabled:a}=A(t.removeCardCost);a?(M(t.removeCardCost,t),v(210),O(t.shopButtons)):e.cameras.main.shake(50,.0015,!1)}async function D(t){gameState.shopButtonPressed?e.cameras.main.shake(50,.0015,!1):(gameState.shopButtonPressed=!0,t.shopButtons.forEach((e=>e.disable())),e.cameras.main.shake(100,.001,!1),e.cameras.main.flash(300),t.redrawCardsButton&&t.redrawCardsButton.destroy(),await e.delay(250),t.shopSprites.forEach((e=>{e&&e.destroy()})),e.time.delayedCall(100,(()=>{t.victoryElements.rewardButtons.forEach((e=>e.activate()))})))}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=gameState.player.gold>=e,n=!gameState.shopButtonPressed,o=gameState.deck.length>gameConfig.minDeckSize,r=gameState.deck.length<gameConfig.maxDeckSize,s=gameState.player.health<gameState.player.healthMax&&!t;return{isAddCardEnabled:a&&n&&r,isRemoveCardEnabled:a&&n&&o,isHealEnabled:a&&n&&s}}function M(e,t){const{shopButtons:a,buyTexts:n}=t;gameState.shopButtonPressed=!0,a.forEach((e=>e.disable())),I(e),n.forEach((e=>{e&&e.destroy()}))}function O(t){e.time.delayedCall(200,(()=>{t.forEach((e=>e.activate()))}))}function F(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold=Math.min(gameState.player.gold+1,gameState.player.goldMax),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02})}))}function I(t){for(let a=1;a<=t;a++)e.time.delayedCall(75*a,(()=>{gameState.player.gold-=1,gameState.goldCounter.setText(gameState.player.gold)}))}function z(t){let a=gameState.permanentSlots.find((e=>e.available));if(!a)return void function(t){e.cameras.main.shake(70,.002,!1),t.isBeingPlayed=!1;G("No slots available. Depletion activated.");let a="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);a=a.replace(/\d+$/,""),"function"==typeof H[a]?H[a](t):console.log("Unknown card key: ".concat(t.key))}(t);var n;(function(e){const t=gameConfig.tokenCardNames.find((t=>t.key===e.key));if(!t)return;let a=new Card(t);gameState.deck.push(a),gameState.discardPile.push(a),gameState.discardPileText.setText(gameState.discardPile.length)}(t),gameState.deck=gameState.deck.filter((e=>e!==t)),"steelToe2"===t.key&&(a=function(e){const t=gameState.permanents.find((e=>"steelToe"===e.card.key));if(t){const e=t.slot;return H.depleteSteelToe(t,!1),e}return console.error("Error: steelToe token not found for depletion."),e}(a)),gameState.fightStarted)&&(t.slot.available=!0,null===(n=t.sprite)||void 0===n||n.destroy());t.tokenSprite=e.add.image(a.x,a.y,t.token),t.tokenSprite.setScale(.8).setDepth(210).setInteractive(),a.available=!1,t.tokenSlot=a;const o={card:t,slot:a,tokenSprite:t.tokenSprite};gameState.permanents.some((e=>e.card.key===o.card.key))||gameState.permanents.push(o);const r=t.tokenSprite,s=t.tokenSlot;!function(t){t.tokenSprite.on("pointerover",(function(){const a=gameState.permanentSlots.length,n=gameState.permanentSlots.filter((e=>!0===e.available)).length;G("Available Permanent Slots: ".concat(n," / ").concat(a),2e3),gameConfig.cardsDealtSound.play({volume:1.5,seek:.1}),t.permanentCardSprite=e.add.image(825,450,t.key).setScale(.83).setDepth(220)})),t.tokenSprite.on("pointerout",(function(){t.permanentCardSprite.destroy()}))}(t),function(t){if(!t.freePermanent){G("Permanent activated.")}const a={foreverTrue:()=>{gameState.foreverTrue=!0},rebelSpirit:()=>{gameState.rebelSpirit=!0},rebelHeart:()=>{gameState.rebelHeart=!0},bushido:()=>{gameState.bushido=!0,gameState.player.updateStats()},toxicAvenger:()=>{gameState.toxicAvenger=!0,gameState.enemies.forEach((e=>e.updateStats()))},kirisuteGomen:()=>{gameState.player.strengthMax+=5,gameState.player.updateStats()},toxicFrets:()=>{gameState.toxicFrets=!0},ashenEncore:()=>{gameState.ashenEncore=!0},edoEruption:()=>{gameState.edoEruption=!0},steelToe:()=>R(1),steelToe2:()=>R(2),gundanSeizai:()=>{gameState.gundanSeizai=!0},deadTokugawas:()=>function(){gameState.redrawPrice=Math.max(0,gameState.redrawPrice-1);const e="Redraw your hand\n Cost: ".concat(gameState.redrawPrice," gold");gameState.redrawButton.setPointerText(e)}(),lustForLife:()=>function(t){gameState.lustForLifeCounter++,gameState.lustForLifeButton=new Button(e,"Heal",U,1350,195,8),gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold")),1===gameState.lustForLifeCounter&&e.time.delayedCall(100,(()=>gameState.lustForLifeButton.activate()));gameState.buttons.push(gameState.lustForLifeButton),gameState.lustForLifeCounter>=5&&j(t)}(t),punksNotDead:()=>{gameState.punksNotDeadCondition=!0,gameState.punksNotDeadCard=t},soulSquatter:()=>{gameState.player.lifeStealBase+=.15},enduringSpirit:()=>function(e){if(gameState.fightStarted)return;if(gameState.player.healthMax+=4,gameState.player.updateHealthBar(),gameState.enduringSpiritCounter++,gameState.enduringSpiritCounter<8)return;j(e)}(t),shogunsShell:()=>{gameState.shogunsShellCounter=2},zaibatsuU:()=>(gameState.zaibatsuMax=3,void(gameState.zaibatsuCards.length&&gameState.extraCards.push(gameState.zaibatsuCards.shift()))),kamishimoUberAlles:()=>{gameState.kamishimoUberAlles++,gameState.player.updateStats()},hollidayInKamakura:()=>function(t){let a=t.tokenSprite,n=t.tokenSlot;const o=gameState.turn,r=gameState.score.levelsCompleted;a.on("pointerup",(()=>{const s=()=>o!==gameState.turn||r!==gameState.score.levelsCompleted;gameState.playersTurn&&s()?H.depleteHollidayInKamakura(t,a,n):e.cameras.main.shake(70,.002,!1)}))}(t),chemicalWarfare:()=>function(e){gameState.chemicalWarfare+=2,gameState.activeChemicalWarfares.push({card:e,turnPlayed:gameState.turn,tokenSprite:e.tokenSprite,tokenSlot:e.tokenSlot})}(t),stageInvasion:()=>null,laidoSoho:()=>null,chintaiShunyu:()=>{gameState.zaibatsuMax&&(gameState.zaibatsuMax+=2)}};a[t.key]?a[t.key]():(e.cameras.main.shake(70,.002,!1),console.log("unable to activate ${card.key}"))}(t),t.tokenSprite.on("pointerup",(()=>{gameState.playersTurn?L(t,r,s):e.cameras.main.shake(70,.002,!1)}))}r();const H={depleteForeverTrue:e=>function(e){gameState.foreverTrue=!1,j(e),N(8)}(e),depleteRebelSpirit:e=>function(e){gameState.rebelSpirit=!1,j(e),gameState.player.mana+=3,gameState.player.manaMax+=3,gameState.player.updateManaBar()}(e),depleteRebelHeart:e=>function(e){gameState.rebelHeart=!1,j(e);const t=gameState.player;t.health=Math.min(t.healthMax,t.health+12),gameConfig.healSound.play({volume:.5}),t.updateHealthBar(),t.powerUpTweens()}(e),depleteBushido:e=>function(e){gameState.bushido=!1,j(e),gameState.player.strengthBase+=6,gameState.player.updateStats()}(e),depleteToxicAvenger:t=>function(t){gameState.toxicAvenger=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 4 Poison\nto all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison+=4,e.updateStats()}))}(t),depleteKirisuteGomen:t=>function(t){if(!gameState.enemies.some((e=>e.health<30)))return void function(t){e.cameras.main.shake(70,.002,!1),t.slot.available=!1,gameState.currentCards.some((e=>"kirisuteGomen"===e.key))||(gameState.currentCards.push(t),gameState.player.mana++,gameState.player.updateManaBar());G("No viable target")}(t);gameState.deck=gameState.deck.filter((e=>e!==t)),gameConfig.targetingCursor.setVisible(!0);let a=!0;gameState.enemies.forEach((n=>{n.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),n.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),n.sprite.on("pointerup",(function(){n.health<=30&&a?function(t,a){t.health=0,gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.025,!1),gameConfig.targetingCursor.setVisible(!1),G("Enemy killed!"),a.tokenSlot&&(a.tokenSlot.available=!0,gameState.player.strengthMax-=5,gameState.player.strengt=Math.min(gameState.player.strengt,gameState.player.strengthMax));a.sprite&&a.sprite.destroy();a.tokenSprite&&a.tokenSprite.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.card!==a)),t.removeIfDead(Y),y())return;gameState.player.updateStats()}(n,t):(a=!1,function(){e.cameras.main.shake(70,.002,!1),G("Inviable target");const t=new TextBox(e,"Target is not valid",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>t.fadeOut()))}())}))}))}(t),depleteToxicFrets:t=>function(t){gameState.toxicFrets=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"   Damage all\npoisoned enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.poison>0&&(e.health-=2*e.poison,e.updateHealthBar(),e.removeIfDead(Y),y())}))}(t),depleteAshenEncore:t=>function(t){gameState.ashenEncore=!1,j(t),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const a=new TextBox(e,"Deals 12 fire damage\n   to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1600,(()=>a.destroy())),gameState.enemies.forEach((e=>{e.health-=12,e.updateHealthBar(),e.removeIfDead(Y),y()}))}(t),depleteEdoEruption:e=>function(e){gameState.edoEruption=!1,j(e)}(e),depleteSteelToe:t=>function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(j(t),function(){gameState.currentCards.forEach((e=>{"steelToe2"===e.key&&q(e.sprite)}));["currentCards","deck","drawPile","discardPile","bonusCards","extraCards"].forEach((t=>e.removeCardFromDeck(t,"steelToe2"))),gameState.drawPileText.setText(gameState.drawPile.length),gameState.discardPileText.setText(gameState.discardPile.length)}(),gameState.steelToeCount=0,!a)return;let n=!0;gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((a=>{a.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),a.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),a.sprite.on("pointerup",(function(){if(gameConfig.targetingCursor.setVisible(!1),!n)return;const o="steelToe"===t.key?7:9;a.armorBase-=o,a.updateStats(),gameConfig.attackSound.play({volume:.6}),e.cameras.main.shake(100,.012,!1),n=!1}))}))}(t),depleteDeadTokugawas:e=>function(e){gameState.redrawPrice+=1,j(e)}(e),depleteGundanSeizai:e=>function(e){gameState.gundanSeizai=!1,F(3),j(e)}(e),depleteLustForLife:e=>function(e){if(j(e),gameState.lustForLifeCounter>=5)return;gameState.lustForLifeCounter=0;q(gameState.buttons.find((e=>"Heal"===e.key)),200),gameState.buttons=gameState.buttons.filter((e=>"Heal"!==e.key))}(e),depletePunksNotDead:e=>function(e){if(gameState.punksNotDeadCondition=!1,j(e),!gameState.player.resurrected)return;gameState.player.alive=!0,gameState.player.name+=" The Undead",gameState.player.heal(Math.round(.2*gameState.player.healthMax)),gameConfig.healSound.play({volume:.5})}(e),depleteSoulSquatter:e=>function(e){gameState.player.lifeStealBase-=.15,gameState.player.lifeStealThisTurn+=.3,gameState.player.powerUpTweens(),j(e)}(e),depleteBouncingSoles:e=>function(e){gameState.bonusPermanentSlots.length&&gameState.permanentSlots.push(gameState.bonusPermanentSlots.shift());gameState.bouncingSolesCards.length&&(gameState.extraCards.push(gameState.bouncingSolesCards.shift()),gameState.extraCards.forEach((e=>console.log(e.key))));j(e)}(e),depleteEnduringSpirit:e=>j(e),depleteShogunsShell:e=>function(e){gameState.shogunsShellCounter=0,gameState.player.armorCard=15,gameState.player.powerUpTweens(),gameState.player.updateStats(),j(e)}(e),depleteZaibatsuU:e=>function(e){gameState.zaibatsuMax=0,j(e)}(e),depleteKamishimoUberAlles:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.kamishimoUberAlles-=1,gameState.player.updateStats()},depleteHollidayInKamakura:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.player.manaMax+=1,gameState.player.mana+=1,gameState.player.updateManaBar(),N(1)},depleteChemicalWarfare:function(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))},depleteChintaiShunyu:function(e,t,a){a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.zaibatsuMax=Math.max(0,gameState.zaibatsuMax-1)},depleteStageInvasion:function(t,a,n){n&&(n.available=!0),a&&a.destroy(),t.permanentCardSprite&&t.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==a)),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});const o=new TextBox(e,"Damages to all enemies",{x:825,y:525,z:201},{fontSize:"48px",fill:"#ff0000"});e.time.delayedCall(1800,(()=>o.destroy())),gameState.enemies.forEach((e=>{const t=(1+.1*gameState.player.strength)*(1-e.armor/20),a=Math.round(2*gameState.currentCards.length*t);e.takeDamage(a),e.removeIfDead(Y)})),y()},depleteLaidoSoho:function(t,a,n){console.log("laido soho token clicked"),gameConfig.targetingCursor.setVisible(!0),gameState.enemies.forEach((o=>{o.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),o.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")})),o.sprite.on("pointerup",(function(){gameState.enemies.forEach((e=>e.sprite.off("pointerup"))),function(t,a,n,o){const r=Math.round(gameState.player.armor*(1+.1*gameState.player.strength)*(1-t.armor/20));gameConfig.targetingCursor.setVisible(!1),gameConfig.attackSound.play({volume:1}),e.cameras.main.shake(120,.02,!1),a.sprite&&a.sprite.destroy();o&&(o.available=!0);n&&n.destroy();a.permanentCardSprite&&a.permanentCardSprite.destroy();if(gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==n)),t.takeDamage(r).removeIfDead(Y),G("Dealt ".concat(r," Physical Damage!")),y());}(o,t,a,n)}))}))}};function L(t,a,n){let o="deplete"+t.key.charAt(0).toUpperCase()+t.key.slice(1);o=o.replace(/\d+$/,"");const r="function"==typeof H[o];!t.specialDepletion&&r?("kirisuteGomen"!==t.key&&"laidoSoho"!==t.key&&G("Permanent depleted."),H[o](t,a,n)):e.cameras.main.shake(70,.002,!1),gameState.permanentSlots.forEach((e=>console.log("slot available: "+e.available)))}function R(e){gameState.steelToeCount=e,gameState.steelToeCards.length&&gameState.extraCards.push(gameState.steelToeCards.shift())}function j(e){e.tokenSlot&&(e.tokenSlot.available=!0),e.sprite&&e.sprite.destroy(),e.tokenSprite&&e.tokenSprite.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((t=>t.card!==e)),gameState.deck=gameState.deck.filter((t=>t!==e))}function U(){const t=gameState.lustForLifeCost,a=gameState.player.gold>=t,n=gameState.player.health<gameState.player.healthMax;if(!a||!n||!gameState.playersTurn)return void e.cameras.main.shake(70,.002,!1);I(t),gameState.player.heal(7),gameState.lustForLifeCost++,gameState.lustForLifeButton.setPointerText(" Heal 7 HP\nCost: ".concat(gameState.lustForLifeCost," gold"));G("Bought ".concat(7," HP"))}function K(){for(;gameState.currentCards.length;){let e=gameState.currentCards.pop();e.slot.available||(e.slot.available=!0),e.dBeat&&delete e.dBeat,gameState.discardPile.push(e),gameState.discardPileText.setText(gameState.discardPile.length),q(e.sprite,200)}}function G(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1700;gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.infoBoxElements=[];const n=new TextBox(e,t,{x:825,y:150,z:21},{fontSize:"30px",fill:"#000000"});gameState.infoBoxElements.push(n),gameState.textBoxDepletionTimer&&gameState.textBoxDepletionTimer.remove(),gameState.textBoxDepletionTimer=e.time.delayedCall(a,(()=>{gameState.infoBoxElements.forEach((e=>{e&&e.destroy()})),gameState.textBoxDepletionTimer=null}))}function W(e,t){if(!e.poison)return;const a=e.updatePoison();G("".concat(e.name," takes ").concat(a," damage from Poison"),t)}function N(t){const a=Math.min(gameState.deck.length,8),n=gameState.slots.filter((e=>e.available)).length;t=n<t?n:t;for(let n=0;n<t;n++)e.time.delayedCall(75*n,(()=>{if(gameState.currentCards.length>=a)return void e.cameras.main.shake(70,.002,!1);gameState.drawPile.length||g();let t=gameState.drawPile.pop();t.sprite=e.add.image(0,0,t.key).setScale(.53).setInteractive(),t.usedOneShot&&t.sprite.setTint(8421504),console.log("card added: ".concat(t.key)),t.activate(),t.isBeingPlayed=!1,gameState.currentCards.push(t);let n=gameState.slots.filter((e=>e.available)),o=n[Math.floor(n.length/2)];if(o){t.sprite.x=o.x,t.sprite.y=o.y,t.startHeight=t.sprite.y,t.angle=o.angle,t.sprite.setAngle(t.angle),o.available=!1,t.slot=o;let a=10+o.index;t.sprite.setDepth(a),t.animatePointer(e,a)}gameConfig.cardsDealtSound.play({volume:2.2,seek:.1}),gameState.drawPileText.setText(gameState.drawPile.length),gameState.ashenEncore&&!t.dBeat&&V(),gameState.playersTurn&&t.sprite.on("pointerup",(function(){u(t)}))}))}async function V(){e.animatePermanent("ashenEncore"),e.cameras.main.shake(100,.003,!1),gameConfig.attackSound.play({volume:.8});G("Deals ".concat(4," fire damage to all enemies")),gameState.enemies.forEach((e=>{e.health-=4,e.updateHealthBar(),e.removeIfDead(Y)})),await e.delay(100),y()}function Y(){gameState.player.gold=Math.min(gameState.player.goldMax,gameState.player.gold+1),gameState.goldCounter.setText(gameState.player.gold),gameConfig.coinSound.play({volume:.8,seek:.02}),gameState.troopsOfTakamoriCondition=!1}function X(){e.animatePermanent("punksNotDead");const t=gameState.punksNotDeadCard;L(t,t.tookenSprite,t.tokenSlot)}function q(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;t&&e.tweens.add({targets:t,alpha:0,ease:"Power1",duration:a,onComplete:()=>{t.destroy()}},e)}function $(t){gameState.stanceText.setAlpha(0);const a=gameState[t].length,n=a>32?10:a>24?8:a>12?6:4,o=a>32?117:a>24?275:a>12?431:590,r=e.camelCaseToTitle(t),s={x:825,y:60,z:200};gameState.pileTitle=new TextBox(e,r,s,{fontSize:"90px",fill:"#000000"},.9),gameState[t].length&&gameState[t].forEach(((t,a)=>{let r=o+a%n*158,s=225+1.5*Math.floor(a/n)*158,i=e.add.image(r,s,t.key).setScale(.4).setDepth(200);gameState.cardImages.push(i)}))}function Z(){gameState.pileTitle.fadeOut(),gameState.cardImages.forEach((e=>q(e))),gameState.cardImages=[],gameState.stanceText.setAlpha(1)}"admin"===gameState.playerName&&function(){const t={fontSize:"23px",fill:"#ff0000"};gameState.getManaButton=e.add.image(825,300,"rectangularButton"),gameState.getManaButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.getManaText=e.add.text(825,300,"Get Mana",t).setOrigin(.5),gameState.getManaButton.on("pointerup",(()=>{gameState.playersTurn&&(gameState.player.mana=gameState.player.manaMax,gameState.player.updateManaBar(),console.log("mana gained"))})),gameState.drawCardButton=e.add.image(825,450,"rectangularButton"),gameState.drawCardButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.drawCardText=e.add.text(825,450,"Draw Card",t).setOrigin(.5),gameState.drawCardButton.on("pointerup",(()=>{gameState.playersTurn&&(N(1),console.log("card drawn"))})),gameState.killEnemyButton=e.add.image(825,600,"rectangularButton"),gameState.killEnemyButton.setScale(.68).setOrigin(.5).setInteractive(),gameState.killEnemyText=e.add.text(825,600,"Kill Enemy",t).setOrigin(.5),gameState.killEnemyButton.on("pointerup",(()=>{if(gameState.enemies.some((e=>e.health>0&&gameState.playersTurn))){const e=gameState.enemies.find((e=>e.health>0));e.health=0,e.removeIfDead(Y),y(),console.log("".concat(e.name," killed"))}}))}()}update(){gameConfig.targetingCursor.visible&&(gameConfig.targetingCursor.x=this.input.mousePointer.x,gameConfig.targetingCursor.y=this.input.mousePointer.y,gameState.enemies.forEach((e=>{e.sprite.on("pointerover",(function(){gameConfig.targetingCursor.setTexture("targetingCursorReady")})),e.sprite.on("pointerout",(function(){gameConfig.targetingCursor.setTexture("targetingCursor")}))})));for(let t=gameState.activeChemicalWarfares.length-1;t>=0;t--){const a=gameState.activeChemicalWarfares[t];gameState.turn===a.turnPlayed+3&&(e(a.card,a.tokenSprite,a.tokenSlot),gameState.activeChemicalWarfares.splice(t,1))}function e(e,t,a){e.isDepleted||(e.isDepleted=!0,a&&(a.available=!0),t&&t.destroy(),e.permanentCardSprite&&e.permanentCardSprite.destroy(),gameState.permanents=gameState.permanents.filter((e=>e.tokenSprite!==t)),gameState.chemicalWarfare-=2,console.log("depleteChemicalWarfare called"))}}}function updateLeaderboard(e,t){let a="https://www.dreamlo.com/lb/CBGhFikNak2i8KjH3UPThAfGJFnWo9A0O8mjvU19hS2Q/add/".concat(e,"/").concat(t);fetch(a).then((e=>e.text())).then((e=>console.log(e))).catch((e=>{console.error("Error:",e)}))}class Endscene extends Phaser.Scene{constructor(){super("Endscene")}async getTopScores(){try{const e=await fetch("https://www.dreamlo.com/lb/64c442f28f40bb8380e27ce7/json");if(!e.ok)throw new Error("Failed to fetch leaderboard data");let t=(await e.json()).dreamlo.leaderboard.entry;return t.sort(((e,t)=>t.score-e.score)),t.slice(0,5)}catch(e){return console.error(e),null}}preload(){this.load.image("endscene","../assets/images/backgrounds/endscene.jpg")}create(){const e=this;this.cameras.main.fadeIn(800,0,0,0),this.input.keyboard.createCursorKeys(),this.add.image(825,480,"endscene").setScale(1.43).setOrigin(.5,.5).on("pointerup",(()=>o())),this.add.text(825,165,"Thanks for playing\nPunk Rock Samurai",{fontSize:"65px",fill:"#a9a9a9",fontFamily:"Rock Kapak"}).setOrigin(.5,.5),gameState.score.totalScore=gameState.score.levelsCompleted>0?gameState.score.levelsCompleted*(15+Math.max(0,7-gameState.score.numberOfTurns/gameState.score.levelsCompleted)):0;let t={numberOfTurns:"Number of turns played",levelsCompleted:"Number of fights won",damageTaken:"Total damage taken",damageDealt:"Total damage dealt",totalScore:"Your score"},a=375,n=300;function o(){r||(r=!0,console.log("returnto meny called"),gameState.name="",gameState.playerName="",e.cameras.main.shake(1500,.0015,!1),e.cameras.main.flash(500),e.time.delayedCall(500,(()=>{e.cameras.main.fadeOut(1e3),gameState.restartGame=!0,gameConfig.levels.forEach((t=>{"Endscene"!==t&&e.scene.stop(t)})),gameConfig.preLevelsScenes.forEach((t=>e.scene.stop(t))),e.scene.start("Preload")})))}if("admin"!=gameState.playerName&&"Cheater"!=gameState.playerName){const e="Easy"===gameState.difficulty?.8:"Medium"===gameState.difficulty?1:1.2;gameState.score.totalScore*=e,updateLeaderboard(gameState.playerName,gameState.score.totalScore)}e.time.delayedCall(600,(async function(){try{console.log("displayLeaderBoard called");let o=await e.getTopScores();const r=e.add.graphics();r.fillStyle(16777215,1).setAlpha(.7),r.fillRect(a,n,900,630),e.add.text(450,n+75,"Your Results",{fontSize:"40px",fill:"#000000"}).setOrigin(0),Object.entries(gameState.score).forEach((a=>{let[o,r]=a;if(console.log("".concat(o,": ").concat(r)),t[o]){let a="".concat(t[o],": ").concat(r);e.add.text(450,n+135,a,{color:"#000",fontSize:"16px"}),n+=30}}));const s={fontSize:"16px",fill:"#000000"};e.add.text(450,n+225,"Leaderboard",{fontSize:"40px",fill:"#000000"}).setOrigin(0),o?o.forEach(((t,a)=>{let o=t.date.split(" ")[0];const r="".concat(a+1,". Name: ").concat(t.name,", Score: ").concat(t.score,", Date: ").concat(o);e.add.text(450,n+285,r,s).setOrigin(0),n+=30})):e.add.text(450,n+285,"Leaderboard is down for maintenance",s).setOrigin(0)}catch(t){console.error("Error in displayLeaderBoard: ",t);const a={fontSize:"25px",fill:"#FF0000"};e.add.text(450,n+285,"Leaderboard is down for maintenance",a).setOrigin(0)}}));let r=!1;this.time.delayedCall(8e3,o),this.input.on("pointerup",o)}}const config={type:Phaser.AUTO,width:1650,height:1020,scene:[BaseScene,Preload,Mainmenu,LoadLazy,Buttons,Characters,Cards,TextBoxes,Actions,Level1Fight1,Level1Fight2,Level1Fight3,Level2Fight1,Level2Fight2,Level2Fight3,Level3Fight1,Level3Fight2,Level3Fight3,Level4Fight1,Level4Fight2,Level4Fight3,Endscene],scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},dom:{createContainer:!0}},game=new Phaser.Game(config);